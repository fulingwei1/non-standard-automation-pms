# WAF环境变量配置示例
# 版本: 1.0.0
# 日期: 2026-02-15
# 说明: 复制此文件为.env.waf并填写实际值

# ============ 域名配置 ============
DOMAIN=pms.example.com
WWW_DOMAIN=www.pms.example.com

# ============ SSL证书配置 ============
# 证书类型: selfsigned (自签名) | letsencrypt (Let's Encrypt)
CERT_TYPE=selfsigned
# Let's Encrypt邮箱（仅letsencrypt类型需要）
LETSENCRYPT_EMAIL=admin@example.com

# ============ ModSecurity配置 ============
# 规则引擎模式: On (拦截) | DetectionOnly (仅检测) | Off (关闭)
MODSEC_RULE_ENGINE=On

# 请求体检测
MODSEC_REQ_BODY_ACCESS=On
MODSEC_REQ_BODY_LIMIT=13107200  # 12.5MB

# 响应体检测
MODSEC_RESP_BODY_ACCESS=On
MODSEC_RESP_BODY_LIMIT=524288  # 512KB

# 审计日志
MODSEC_AUDIT_ENGINE=RelevantOnly  # On | Off | RelevantOnly
MODSEC_AUDIT_LOG=/var/log/nginx/modsec_audit.log

# ============ OWASP CRS配置 ============
# 偏执级别 (1-4)，级别越高规则越严格
PARANOIA=1

# 异常评分阈值
ANOMALY_INBOUND=5
ANOMALY_OUTBOUND=4

# 阻断偏执级别
BLOCKING_PARANOIA=1

# ============ 速率限制配置 ============
# API速率限制（请求/分钟）
API_RATE_LIMIT=100

# 登录速率限制（请求/分钟）
LOGIN_RATE_LIMIT=5

# 通用速率限制（请求/分钟）
GENERAL_RATE_LIMIT=200

# ============ 日志配置 ============
# 日志级别: debug | info | notice | warn | error | crit
LOG_LEVEL=warn

# 访问日志格式: main | json
ACCESS_LOG_FORMAT=main

# WAF拦截日志
WAF_BLOCK_LOG=/var/log/nginx/blocked.log

# ============ 监控与告警配置 ============
# 告警阈值（每分钟拦截次数）
ALERT_THRESHOLD=10

# 告警方式: webhook | email | syslog
ALERT_METHOD=webhook

# Webhook URL（企业微信/钉钉）
ALERT_WEBHOOK_URL=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=your-key

# ============ 性能配置 ============
# Nginx worker进程数（auto = CPU核心数）
WORKER_PROCESSES=auto

# Worker连接数
WORKER_CONNECTIONS=1024

# 客户端最大请求体大小
CLIENT_MAX_BODY_SIZE=10M

# 上传接口最大请求体大小
UPLOAD_MAX_BODY_SIZE=50M

# ============ 缓存配置 ============
# 启用代理缓存
ENABLE_PROXY_CACHE=true

# 缓存大小（磁盘）
CACHE_MAX_SIZE=100m

# 缓存有效期（秒）
CACHE_VALID_TIME=300

# ============ IP白名单配置 ============
# 信任的IP段（逗号分隔）
# TRUSTED_IPS=192.168.1.0/24,10.0.0.0/8

# ============ IP黑名单配置 ============
# 阻止的IP（逗号分隔）
# BLOCKED_IPS=192.0.2.1,198.51.100.0/24

# ============ 后端配置 ============
# FastAPI后端地址
BACKEND_HOST=127.0.0.1
BACKEND_PORT=8000

# ============ 数据库配置（保持与主配置一致） ============
POSTGRES_USER=pms
POSTGRES_PASSWORD=your-secure-password-here
POSTGRES_DB=pms
DATABASE_URL=postgresql://pms:your-secure-password-here@db:5432/pms

# ============ 应用配置（保持与主配置一致） ============
SECRET_KEY=your-secret-key-here-please-change-in-production
DEBUG=false

# ============ 时区配置 ============
TZ=Asia/Shanghai

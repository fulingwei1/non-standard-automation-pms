# 销售月报
# 报告代码: SALES_MONTHLY

meta:
  name: 销售月报
  code: SALES_MONTHLY
  description: 销售部门月度统计报表，包含合同、订单、回款、开票、投标等统计数据
  version: "1.0"

permissions:
  roles:
    - SALES_MANAGER
    - ADMIN
    - FINANCE_MANAGER
  data_scope: global

parameters:
  - name: month
    type: string
    required: false
    description: 月份（YYYY-MM格式），不提供则使用当前月份

cache:
  enabled: true
  ttl: 1800
  key_pattern: "report:SALES_MONTHLY:{month}"

schedule:
  enabled: false

data_sources:
  sales_data:
    type: adapter
    adapter: SalesReportAdapter
    args:
      month: "{{ params.month }}"

sections:
  - id: summary
    title: 销售月报汇总
    type: metrics
    items:
      - label: 统计月份
        value: "{{ sales_data.report_date }}"
      - label: 新签合同数
        value: "{{ sales_data.contract_statistics.new_contracts_count }}"
      - label: 新签合同金额
        value: "{{ sales_data.contract_statistics.new_contracts_amount | currency }}"
      - label: 新订单数
        value: "{{ sales_data.order_statistics.new_orders_count }}"
      - label: 新订单金额
        value: "{{ sales_data.order_statistics.new_orders_amount | currency }}"
      - label: 计划回款
        value: "{{ sales_data.receipt_statistics.planned_receipt_amount | currency }}"
      - label: 实际回款
        value: "{{ sales_data.receipt_statistics.actual_receipt_amount | currency }}"
      - label: 回款完成率
        value: "{{ sales_data.receipt_statistics.receipt_completion_rate | round_num(2) }}%"

  - id: contract_details
    title: 合同统计
    type: table
    source: sales_data.contract_statistics
    columns:
      - field: new_contracts_count
        label: 新签合同数
        format: number
      - field: new_contracts_amount
        label: 新签合同金额
        format: currency
      - field: active_contracts
        label: 执行中合同数
        format: number
      - field: completed_contracts
        label: 已完成合同数
        format: number

  - id: order_details
    title: 订单统计
    type: table
    source: sales_data.order_statistics
    columns:
      - field: new_orders_count
        label: 新订单数
        format: number
      - field: new_orders_amount
        label: 新订单金额
        format: currency

  - id: receipt_details
    title: 回款统计
    type: table
    source: sales_data.receipt_statistics
    columns:
      - field: planned_receipt_amount
        label: 计划回款
        format: currency
      - field: actual_receipt_amount
        label: 实际回款
        format: currency
      - field: receipt_completion_rate
        label: 回款完成率
        format: percentage
      - field: overdue_amount
        label: 逾期金额
        format: currency

  - id: invoice_details
    title: 开票统计
    type: table
    source: sales_data.invoice_statistics
    columns:
      - field: invoices_count
        label: 开票数量
        format: number
      - field: invoices_amount
        label: 开票金额
        format: currency
      - field: invoice_rate
        label: 开票率
        format: percentage

  - id: bidding_details
    title: 投标统计
    type: table
    source: sales_data.bidding_statistics
    columns:
      - field: new_bidding
        label: 新增投标数
        format: number
      - field: won_bidding
        label: 中标数
        format: number
      - field: bidding_win_rate
        label: 中标率
        format: percentage

exports:
  json:
    enabled: true
  pdf:
    enabled: true
    template: sales_monthly.html
    orientation: landscape
  excel:
    enabled: true
    sheets:
      - name: 汇总
        section: summary
      - name: 合同统计
        section: contract_details
      - name: 订单统计
        section: order_details
      - name: 回款统计
        section: receipt_details
      - name: 开票统计
        section: invoice_details
      - name: 投标统计
        section: bidding_details
  word:
    enabled: false

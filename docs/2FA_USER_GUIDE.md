# 双因素认证（2FA）用户使用指南

## 📋 目录

- [什么是双因素认证](#什么是双因素认证)
- [为什么需要2FA](#为什么需要2fa)
- [支持的认证方式](#支持的认证方式)
- [启用2FA](#启用2fa)
- [使用2FA登录](#使用2fa登录)
- [备用恢复码](#备用恢复码)
- [禁用2FA](#禁用2fa)
- [常见问题](#常见问题)

---

## 什么是双因素认证

双因素认证（Two-Factor Authentication，简称2FA）是一种安全机制，要求用户提供两种不同类型的身份验证信息：

1. **你知道的内容**：密码
2. **你拥有的设备**：手机上的认证器应用

即使密码泄露，攻击者也无法登录您的账号，因为他们没有您的手机认证器。

---

## 为什么需要2FA

✅ **显著提升账号安全性**  
✅ **防止密码泄露导致的账号被盗**  
✅ **符合企业安全合规要求**  
✅ **保护敏感项目数据**

---

## 支持的认证方式

### 1. TOTP（基于时间的一次性密码）

系统支持主流认证器应用：

- **Google Authenticator**（推荐）
  - iOS：App Store 搜索 "Google Authenticator"
  - Android：Google Play 搜索 "Google Authenticator"

- **Microsoft Authenticator**
  - iOS：App Store 搜索 "Microsoft Authenticator"
  - Android：Google Play 搜索 "Microsoft Authenticator"

- 其他兼容TOTP的认证器（如Authy、1Password等）

### 2. 备用恢复码

系统会生成10个一次性备用码，用于：

- 手机丢失时的紧急登录
- 认证器应用无法使用时的备选方案

**⚠️ 重要提示：**
- 每个备用码只能使用一次
- 请妥善保管备用码（建议打印并存放在安全位置）
- 备用码泄露可能导致账号被盗

---

## 启用2FA

### 步骤1：进入2FA设置页面

1. 登录系统
2. 点击右上角头像 → "账号设置"
3. 选择"安全设置" → "双因素认证"

### 步骤2：扫描二维码

1. 点击"启用2FA"按钮
2. 系统会生成二维码和密钥（32位字符串）
3. 打开手机上的认证器应用（如Google Authenticator）
4. 扫描二维码，或手动输入密钥

**手动输入密钥步骤（如果二维码扫描失败）：**

1. 在认证器应用中选择"手动输入密钥"
2. 账户名称：填写您的邮箱或用户名
3. 密钥：复制粘贴系统显示的32位密钥
4. 时间类型：选择"基于时间"

### 步骤3：验证并启用

1. 认证器应用会生成6位数字验证码（每30秒更新）
2. 在系统页面输入当前显示的6位验证码
3. 点击"验证并启用"
4. 启用成功后，系统会显示10个备用恢复码

### 步骤4：保存备用码

**必做事项：**

✅ 将10个备用码复制到安全位置  
✅ 建议打印并存放在安全的物理位置  
✅ 不要截图保存在手机相册（手机丢失会同时失去认证器和备用码）

---

## 使用2FA登录

### 正常登录流程

1. 输入用户名和密码
2. 系统提示"需要双因素认证"
3. 打开手机认证器应用
4. 输入当前显示的6位验证码
5. 登录成功

### 使用备用码登录

当您的手机不可用时（丢失、损坏、无法访问认证器）：

1. 输入用户名和密码
2. 在验证码输入框输入任意一个备用码（8位数字）
3. 登录成功

**⚠️ 注意：**
- 每个备用码只能使用一次
- 使用备用码后，建议立即重新生成新的备用码

---

## 备用恢复码

### 查看备用码状态

在"账号设置" → "安全设置" → "双因素认证"页面可以查看：

- 总备用码数量：10个
- 已使用数量
- 剩余可用数量

### 重新生成备用码

**何时需要重新生成：**

- 备用码已全部使用
- 怀疑备用码泄露
- 定期安全维护（建议每季度一次）

**重新生成步骤：**

1. 进入"双因素认证"设置页面
2. 点击"重新生成备用码"
3. 输入账号密码验证
4. 获取10个新的备用码
5. **旧备用码将立即失效**
6. 保存新的备用码

---

## 禁用2FA

**⚠️ 警告：禁用2FA会降低账号安全性！**

### 禁用步骤

1. 进入"双因素认证"设置页面
2. 点击"禁用2FA"按钮
3. 输入账号密码验证
4. 确认禁用

禁用后：

- TOTP密钥将被删除
- 所有备用码将失效
- 登录只需用户名和密码

---

## 常见问题

### Q1：手机丢失了怎么办？

**方案1：使用备用码登录**

1. 使用备用恢复码登录
2. 登录后立即禁用2FA
3. 重新启用2FA并使用新手机扫码

**方案2：联系管理员**

如果备用码也丢失，请联系系统管理员：

- 管理员可以为您禁用2FA
- 重新设置后请立即启用2FA

### Q2：验证码总是错误怎么办？

**可能原因和解决方案：**

1. **手机时间不同步**  
   解决：进入手机设置 → 日期和时间 → 开启"自动设置时间"

2. **输入验证码速度太慢**  
   解决：TOTP码每30秒刷新，请在码刷新前输入

3. **认证器应用故障**  
   解决：尝试卸载并重新安装认证器应用，重新扫码设置

4. **密钥输入错误**  
   解决：检查手动输入的密钥是否正确（区分大小写）

### Q3：可以在多个设备上使用同一个2FA吗？

可以！您可以：

- 在多个手机上扫描同一个二维码
- 或在多个认证器应用中输入相同的密钥

这样可以作为备份，但请确保所有设备都安全保管。

### Q4：更换手机后怎么办？

**推荐方案（提前准备）：**

1. 启用2FA时保存32位密钥
2. 换手机后在新认证器应用中手动输入密钥
3. 或者先添加到新手机，再删除旧手机

**如果没有提前准备：**

1. 使用备用码登录
2. 禁用2FA
3. 重新启用2FA并扫码

### Q5：备用码可以重复使用吗？

**不可以！** 每个备用码只能使用一次。

使用后状态示例：

- 使用前：10个可用
- 使用1个后：9个可用，1个已使用
- 全部使用后：建议重新生成

### Q6：忘记是否启用了2FA怎么办？

登录时系统会自动提示：

- 如果启用了2FA，会要求输入验证码
- 如果没启用，直接登录成功

### Q7：2FA会影响API访问吗？

**不会！** 2FA仅影响网页登录流程：

- API Token仍然正常工作
- API Key认证不受影响
- Refresh Token机制正常

### Q8：管理员可以看到我的2FA密钥吗？

**不能！** 安全机制：

- TOTP密钥使用AES加密存储
- 备用码使用bcrypt哈希存储
- 管理员只能看到您是否启用了2FA
- 管理员可以禁用2FA但看不到密钥

---

## 安全最佳实践

✅ **立即启用2FA**：保护账号安全  
✅ **妥善保管备用码**：打印并安全存放  
✅ **定期检查备用码状态**：及时重新生成  
✅ **不要分享密钥和备用码**：这些信息等同于密码  
✅ **多设备备份**：在多个认证器应用中添加同一密钥  
✅ **手机设置时间自动同步**：确保TOTP码准确

---

## 技术支持

如遇到问题，请联系：

- **技术支持邮箱**：support@example.com
- **系统管理员**：admin@example.com
- **工单系统**：系统内提交工单

---

**最后更新时间**：2026-02-14  
**文档版本**：v1.0

# API端点层重构计划

> 使用CRUD基类和统一响应格式去除重复代码

---

## 🎯 重构目标

### 当前问题

1. **重复的CRUD代码**
   - 每个端点都重复实现相同的CRUD逻辑
   - 分页、筛选、搜索代码重复
   - 错误处理不统一

2. **响应格式不统一**
   - 有些使用字典，有些使用ResponseModel
   - 错误响应格式不一致

3. **验证逻辑分散**
   - 验证代码分散在各个端点
   - 没有统一的验证器

### 重构目标

1. ✅ **使用CRUD基类**
   - 所有CRUD操作通过BaseService
   - 减少90%的重复代码

2. ✅ **统一响应格式**
   - 所有响应使用SuccessResponse/PaginatedResponse
   - 错误使用HTTPException

3. ✅ **统一验证**
   - 使用统一的验证器
   - 在Schema中集中验证

---

## 📋 重构步骤

### 阶段1：分析现有端点（已完成）

- ✅ 识别重复模式
- ✅ 确定重构优先级

### 阶段2：创建通用端点模板

- ⏭️ 创建通用CRUD路由生成器
- ⏭️ 创建通用列表查询端点
- ⏭️ 创建通用详情查询端点

### 阶段3：重构现有端点

- ⏭️ 从简单的端点开始（suppliers, materials）
- ⏭️ 逐步重构其他端点
- ⏭️ 保持向后兼容

### 阶段4：验证和测试

- ⏭️ 运行现有测试
- ⏭️ 修复兼容性问题
- ⏭️ 添加新测试

---

## 🔧 重构方案

### 方案1：通用路由生成器（推荐）

创建一个通用的路由生成器，自动生成CRUD端点。

### 方案2：手动重构（当前采用）

逐个端点手动重构，使用CRUD基类和统一响应格式。

---

## 📊 预期收益

- **代码量减少**：从100行 → 20行（减少80%）
- **开发速度**：从2天 → 0.5天（提升4倍）
- **维护成本**：减少60%维护工作量
- **代码质量**：统一的错误处理、响应格式

---

**创建日期**：2026-01-23  
**状态**：⏭️ 进行中

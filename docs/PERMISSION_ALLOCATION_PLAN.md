# æƒé™åˆ†é…æ–¹æ¡ˆ

> æ›´æ–°æ—¥æœŸï¼š2026-01-20  
> è¯´æ˜ï¼šä¸º29ä¸ªæ–°å¢æƒé™æ¨¡å—åˆ›å»ºè§’è‰²æƒé™åˆ†é…æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†29ä¸ªæ–°å¢æƒé™æ¨¡å—çš„è§’è‰²æƒé™åˆ†é…æ–¹æ¡ˆã€‚æƒé™å·²é€šè¿‡è¿ç§»è„šæœ¬åˆ›å»ºï¼Œç°åœ¨éœ€è¦åˆ†é…ç»™ç›¸åº”çš„è§’è‰²ã€‚

## ğŸ¯ æƒé™åˆ†é…åŸåˆ™

### 1. æœ€å°æƒé™åŸåˆ™
- é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·åªè·å¾—å®Œæˆå·¥ä½œæ‰€éœ€çš„æœ€å°æƒé™
- æ ¹æ®è§’è‰²èŒè´£åˆ†é…æƒé™ï¼Œè€Œä¸æ˜¯å…¨éƒ¨æƒé™

### 2. è§’è‰²èŒè´£æ˜ å°„
- **é¡¹ç›®ç»ç† (pm)** â†’ é¡¹ç›®ç®¡ç†ç›¸å…³æƒé™
- **é‡‡è´­å‘˜ (procurement)** â†’ é‡‡è´­ã€ç‰©æ–™ã€ä¾›åº”å•†æƒé™
- **è´¢åŠ¡ (finance)** â†’ é¢„ç®—ã€æˆæœ¬ã€å¥–é‡‘æƒé™
- **å·¥ç¨‹å¸ˆ (engineer)** â†’ é—®é¢˜ã€å·¥æ—¶ã€æŠ€æœ¯è§„æ ¼æƒé™
- **HR (hr)** â†’ HRç®¡ç†ã€äººå‘˜åŒ¹é…æƒé™
- **é”€å”® (sales)** â†’ å®¢æˆ·ã€å”®å‰é›†æˆæƒé™
- **ç®¡ç†å‘˜ (admin)** â†’ æ‰€æœ‰æƒé™

### 3. æƒé™ç²’åº¦
- **read** - æŸ¥çœ‹æƒé™ï¼ˆæœ€åŸºç¡€ï¼‰
- **create** - åˆ›å»ºæƒé™
- **update** - æ›´æ–°æƒé™
- **delete** - åˆ é™¤æƒé™
- **manage** - å®Œæ•´ç®¡ç†æƒé™ï¼ˆåŒ…å«æ‰€æœ‰æ“ä½œï¼‰
- **approve** - å®¡æ‰¹æƒé™
- **assign** - åˆ†é…æƒé™
- **resolve** - å¤„ç†/è§£å†³æƒé™

## ğŸ“Š è§’è‰²æƒé™åˆ†é…è¡¨

### 1. ä¼˜åŠ¿äº§å“æ¨¡å— (advantage_product)

| è§’è‰² | read | create | update | delete |
|------|------|--------|--------|--------|
| é”€å”® (sales) | âœ… | âœ… | âœ… | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âŒ | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 2. è£…é…å¥—ä»¶æ¨¡å— (assembly_kit)

| è§’è‰² | read | create | update | delete | manage |
|------|------|--------|--------|--------|--------|
| é‡‡è´­å‘˜ (procurement) | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç”Ÿäº§ (production) | âœ… | âœ… | âœ… | âŒ | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âŒ | âŒ | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 3. é¢„ç®—ç®¡ç†æ¨¡å— (budget)

| è§’è‰² | read | create | update | approve | delete |
|------|------|--------|--------|---------|--------|
| è´¢åŠ¡ (finance) | âœ… | âœ… | âœ… | âœ… | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 4. ä¸šåŠ¡æ”¯æŒæ¨¡å— (business_support)

| è§’è‰² | read | create | update | approve | manage |
|------|------|--------|--------|---------|--------|
| ä¸šåŠ¡æ”¯æŒ (business_support) | âœ… | âœ… | âœ… | âŒ | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 5. æˆæœ¬ç®¡ç†æ¨¡å— (cost)

| è§’è‰² | read | create | update | delete | manage |
|------|------|--------|--------|--------|--------|
| è´¢åŠ¡ (finance) | âœ… | âœ… | âœ… | âŒ | âœ… |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 6. å®¢æˆ·ç®¡ç†æ¨¡å— (customer)

| è§’è‰² | read | create | update | delete |
|------|------|--------|--------|--------|
| é”€å”® (sales) | âœ… | âœ… | âœ… | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âŒ | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 7. æ•°æ®å¯¼å…¥å¯¼å‡ºæ¨¡å— (data_import_export)

| è§’è‰² | import | export | manage |
|------|--------|--------|--------|
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… |
| æ•°æ®ç®¡ç†å‘˜ (data_admin) | âœ… | âœ… | âŒ |

### 8. æ–‡æ¡£ç®¡ç†æ¨¡å— (document)

| è§’è‰² | read | create | update | delete | download |
|------|------|--------|--------|--------|----------|
| æ‰€æœ‰ç”¨æˆ· | âœ… | âœ… | âœ… | âŒ | âœ… |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ | âœ… |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 9. å·¥ç¨‹å¸ˆæ¨¡å— (engineer)

| è§’è‰² | read | create | update | manage |
|------|------|--------|--------|--------|
| å·¥ç¨‹å¸ˆ (engineer) | âœ… | âœ… | âœ… | âŒ |
| HR (hr) | âœ… | âœ… | âœ… | âœ… |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 10. å°æ—¶è´¹ç‡æ¨¡å— (hourly_rate)

| è§’è‰² | read | create | update | delete |
|------|------|--------|--------|--------|
| è´¢åŠ¡ (finance) | âœ… | âœ… | âœ… | âŒ |
| HR (hr) | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 11. HRç®¡ç†æ¨¡å— (hr)

| è§’è‰² | read | create | update | manage |
|------|--------|--------|--------|--------|
| HR (hr) | âœ… | âœ… | âœ… | âœ… |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 12. å®‰è£…è°ƒåº¦æ¨¡å— (installation_dispatch)

| è§’è‰² | read | create | update | manage |
|------|------|--------|--------|--------|
| å®‰è£…å·¥ç¨‹å¸ˆ (installation) | âœ… | âœ… | âœ… | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 13. é—®é¢˜ç®¡ç†æ¨¡å— (issue)

| è§’è‰² | read | create | update | resolve | assign | delete |
|------|------|--------|--------|---------|--------|--------|
| å·¥ç¨‹å¸ˆ (engineer) | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |

### 14. è®¾å¤‡/æœºå°æ¨¡å— (machine)

| è§’è‰² | read | create | update | delete |
|------|------|--------|--------|--------|
| å·¥ç¨‹å¸ˆ (engineer) | âœ… | âœ… | âœ… | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 15. ç‰©æ–™ç®¡ç†æ¨¡å— (material)

| è§’è‰² | read | create | update | delete |
|------|------|--------|--------|--------|
| é‡‡è´­å‘˜ (procurement) | âœ… | âœ… | âœ… | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âŒ | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 16. é‡Œç¨‹ç¢‘æ¨¡å— (milestone)

| è§’è‰² | read | create | update | delete |
|------|------|--------|--------|--------|
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 17. é€šçŸ¥æ¨¡å— (notification)

| è§’è‰² | read | create | update | delete |
|------|------|--------|--------|--------|
| æ‰€æœ‰ç”¨æˆ· | âœ… | âœ… | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 18. å”®å‰é›†æˆæ¨¡å— (presales_integration)

| è§’è‰² | read | create | update | manage |
|------|------|--------|--------|--------|
| é”€å”® (sales) | âœ… | âœ… | âœ… | âŒ |
| å”®å‰ (presales) | âœ… | âœ… | âœ… | âœ… |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 19. é¡¹ç›®è¯„ä¼°æ¨¡å— (project_evaluation)

| è§’è‰² | read | create | update | manage |
|------|------|--------|--------|--------|
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 20. é¡¹ç›®è§’è‰²æ¨¡å— (project_role)

| è§’è‰² | read | create | update | delete | assign |
|------|------|--------|--------|--------|--------|
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ | âœ… |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 21. èµ„è´¨æ¨¡å— (qualification)

| è§’è‰² | read | create | update | delete | manage |
|------|------|--------|--------|--------|--------|
| HR (hr) | âœ… | âœ… | âœ… | âŒ | âœ… |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 22. æŠ¥è¡¨ä¸­å¿ƒæ¨¡å— (report)

| è§’è‰² | read | create | export | manage |
|------|------|--------|--------|--------|
| æ‰€æœ‰ç”¨æˆ· | âœ… | âŒ | âœ… | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 23. çŸ­ç¼ºé¢„è­¦æ¨¡å— (shortage_alert)

| è§’è‰² | read | create | update | resolve | manage |
|------|------|--------|--------|---------|--------|
| é‡‡è´­å‘˜ (procurement) | âœ… | âœ… | âœ… | âœ… | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âŒ | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 24. äººå‘˜åŒ¹é…æ¨¡å— (staff_matching)

| è§’è‰² | read | create | update | manage |
|------|------|--------|--------|--------|
| HR (hr) | âœ… | âœ… | âœ… | âœ… |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âŒ | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 25. é˜¶æ®µæ¨¡å— (stage)

| è§’è‰² | read | create | update | delete | manage |
|------|------|--------|--------|--------|--------|
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ | âœ… |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 26. ä¾›åº”å•†æ¨¡å— (supplier)

| è§’è‰² | read | create | update | delete |
|------|------|--------|--------|--------|
| é‡‡è´­å‘˜ (procurement) | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 27. ä»»åŠ¡ä¸­å¿ƒæ¨¡å— (task_center)

| è§’è‰² | read | create | update | assign | manage |
|------|------|--------|--------|--------|--------|
| æ‰€æœ‰ç”¨æˆ· | âœ… | âœ… | âœ… | âŒ | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… |

### 28. æŠ€æœ¯è§„æ ¼æ¨¡å— (technical_spec)

| è§’è‰² | read | create | update | delete |
|------|------|--------|--------|--------|
| å·¥ç¨‹å¸ˆ (engineer) | âœ… | âœ… | âœ… | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âŒ |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… |

### 29. å·¥æ—¶è¡¨æ¨¡å— (timesheet)

| è§’è‰² | read | create | update | approve | delete | manage |
|------|------|--------|--------|---------|--------|--------|
| æ‰€æœ‰ç”¨æˆ· | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| é¡¹ç›®ç»ç† (pm) | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| HR (hr) | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… |
| ç®¡ç†å‘˜ (admin) | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |

## ğŸ”§ æƒé™åˆ†é…SQLè„šæœ¬

### ä¸ºè§’è‰²åˆ†é…æƒé™çš„SQLæ¨¡æ¿

```sql
-- ç¤ºä¾‹ï¼šä¸ºé¡¹ç›®ç»ç†è§’è‰²åˆ†é…å®¢æˆ·æŸ¥çœ‹æƒé™
INSERT INTO role_permissions (role_id, permission_id)
SELECT 
    r.id AS role_id,
    p.id AS permission_id
FROM roles r
CROSS JOIN permissions p
WHERE r.role_code = 'pm'  -- è§’è‰²ç¼–ç 
  AND p.perm_code = 'customer:read'  -- æƒé™ç¼–ç 
ON DUPLICATE KEY UPDATE role_id = role_id;  -- MySQL
-- OR IGNORE;  -- SQLite
```

### æ‰¹é‡åˆ†é…è„šæœ¬

åˆ›å»º `migrations/20260120_role_permissions_allocation.sql` æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰è§’è‰²çš„æƒé™åˆ†é…ã€‚

## ğŸ“ æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤1ï¼šæ‰§è¡Œæƒé™è¿ç§»è„šæœ¬

```bash
# SQLite
sqlite3 data/app.db < migrations/20260120_comprehensive_permissions_sqlite.sql

# MySQL
mysql -u user -p database < migrations/20260120_comprehensive_permissions_mysql.sql
```

### æ­¥éª¤2ï¼šä¸ºè§’è‰²åˆ†é…æƒé™

å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ†é…ï¼š

1. **é€šè¿‡API**ï¼ˆæ¨èï¼‰
   ```bash
   # ä½¿ç”¨è§’è‰²ç®¡ç†APIåˆ†é…æƒé™
   PUT /api/v1/roles/{role_id}/permissions
   {
     "permission_ids": [1, 2, 3, ...]
   }
   ```

2. **é€šè¿‡SQLè„šæœ¬**
   ```bash
   # æ‰§è¡Œæƒé™åˆ†é…SQLè„šæœ¬
   sqlite3 data/app.db < migrations/20260120_role_permissions_allocation.sql
   ```

3. **é€šè¿‡ç®¡ç†ç•Œé¢**
   - è®¿é—®è§’è‰²ç®¡ç†é¡µé¢
   - é€‰æ‹©è§’è‰²
   - å‹¾é€‰éœ€è¦åˆ†é…çš„æƒé™
   - ä¿å­˜

### æ­¥éª¤3ï¼šéªŒè¯æƒé™åˆ†é…

```sql
-- æŸ¥çœ‹è§’è‰²çš„æ‰€æœ‰æƒé™
SELECT 
    r.role_code,
    r.role_name,
    p.perm_code,
    p.perm_name
FROM roles r
JOIN role_permissions rp ON r.id = rp.role_id
JOIN permissions p ON rp.permission_id = p.id
WHERE r.role_code = 'pm'
ORDER BY p.module, p.perm_code;
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æƒé™ç»§æ‰¿**ï¼šç”¨æˆ·é€šè¿‡è§’è‰²è·å¾—æƒé™ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²ï¼Œæƒé™å–å¹¶é›†
2. **è¶…çº§ç®¡ç†å‘˜**ï¼š`is_superuser=True` çš„ç”¨æˆ·è‡ªåŠ¨æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œæ— éœ€åˆ†é…
3. **æƒé™æ›´æ–°**ï¼šå¦‚æœæƒé™å®šä¹‰å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦é‡æ–°åˆ†é…
4. **æµ‹è¯•éªŒè¯**ï¼šåˆ†é…æƒé™åï¼Œä½¿ç”¨ä¸åŒè§’è‰²çš„ç”¨æˆ·æµ‹è¯•APIè®¿é—®

## ğŸ”— ç›¸å…³æ–‡æ¡£

- `migrations/20260120_comprehensive_permissions_sqlite.sql` - æƒé™å®šä¹‰
- `docs/PERMISSION_IMPLEMENTATION_GUIDE.md` - æƒé™æ£€æŸ¥æ·»åŠ æŒ‡å—
- `app/api/v1/endpoints/customers.py` - å‚è€ƒå®ç°

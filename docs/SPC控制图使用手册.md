# SPC统计过程控制 - 使用手册

## 1. SPC简介

### 1.1 什么是SPC？

SPC (Statistical Process Control，统计过程控制) 是一种使用统计方法监控和控制生产过程的质量管理工具。通过控制图实时监测过程变异，及时发现异常并采取措施，实现预防性质量管理。

### 1.2 为什么使用SPC？

- **预防而非检验**: 在问题发生前发现过程异常
- **量化管理**: 用数据和统计方法代替主观判断
- **持续改进**: 识别过程能力，推动质量提升
- **降低成本**: 减少废品和返工

## 2. 基本概念

### 2.1 控制限 vs 规格限

| 概念 | 英文 | 含义 | 来源 |
|------|------|------|------|
| 规格限 | Specification Limit | 产品设计要求 | 技术图纸、客户要求 |
| 上规格限 | USL (Upper Spec Limit) | 允许的最大值 | 产品标准 |
| 下规格限 | LSL (Lower Spec Limit) | 允许的最小值 | 产品标准 |
| 控制限 | Control Limit | 过程稳定性边界 | 统计计算 |
| 上控制限 | UCL (Upper Control Limit) | 过程上限 | μ + 3σ |
| 下控制限 | LCL (Lower Control Limit) | 过程下限 | μ - 3σ |
| 中心线 | CL (Center Line) | 过程均值 | μ |

**关键区别**:
- 规格限是"死"的 (产品设计规定)
- 控制限是"活"的 (过程数据计算)

### 2.2 3σ原则

正态分布下:
- μ ± 1σ 覆盖 68.27% 数据
- μ ± 2σ 覆盖 95.45% 数据
- **μ ± 3σ 覆盖 99.73% 数据**

因此，如果过程稳定且服从正态分布，数据落在控制限外的概率仅为 0.27%。

## 3. SPC控制图类型

本系统主要实现 **X̄-R控制图** (均值-极差控制图)，适用于计量数据。

### 3.1 控制图组成

```
  UCL ────────────────────────────  (上控制限)
       *   *     *   *   *
  CL  ─────────*───*───────*──────  (中心线)
           *           *
  LCL ────────────────────────────  (下控制限)
```

### 3.2 控制限计算公式

#### X̄图 (均值图)

```
UCL = X̄̄ + A₂R̄
CL  = X̄̄
LCL = X̄̄ - A₂R̄
```

本系统简化为3σ方法:
```
UCL = μ + 3σ
CL  = μ
LCL = μ - 3σ
```

其中:
- μ = 样本均值
- σ = 样本标准差

## 4. 使用步骤

### 4.1 数据准备

**要求**:
1. 至少收集 **20-25组** 数据 (最少5组)
2. 每组数据来自 **同一批次、同一操作者、同一设备**
3. 测量数据真实准确

### 4.2 API调用

#### 请求示例

```bash
GET /production/quality/spc?material_id=123&start_date=2026-02-01T00:00:00&end_date=2026-02-16T23:59:59
```

#### 响应示例

```json
{
  "data_points": [
    {
      "inspection_no": "QI202602010001",
      "inspection_date": "2026-02-01T08:00:00",
      "measured_value": 25.3,
      "spec_upper_limit": 30.0,
      "spec_lower_limit": 20.0
    },
    ...
  ],
  "control_limits": {
    "ucl": 27.5,
    "cl": 25.0,
    "lcl": 22.5,
    "spec_upper_limit": 30.0,
    "spec_lower_limit": 20.0
  },
  "out_of_control_points": ["QI202602150003"],
  "process_capability_index": 1.25
}
```

### 4.3 控制图绘制

**建议工具**: 
- Excel / Power BI
- Python matplotlib
- 前端 ECharts / Chart.js

**绘图要点**:
1. X轴: 时间或样本序号
2. Y轴: 测量值
3. 绘制控制限线 (UCL, CL, LCL)
4. 绘制规格限线 (虚线)
5. 标注失控点 (红色)

## 5. 判稳准则

### 5.1 失控信号 (8大判异准则)

| 准则 | 描述 | 含义 |
|------|------|------|
| 1 | 1点落在A区外 | 单点超出3σ |
| 2 | 连续9点在中心线同一侧 | 过程偏移 |
| 3 | 连续6点递增或递减 | 趋势性变化 |
| 4 | 连续14点交替上下 | 系统性波动 |
| 5 | 3点中有2点落在A区 | 接近失控 |
| 6 | 5点中有4点落在B区 | 过程波动增大 |
| 7 | 连续15点在C区 | 过程过于稳定 |
| 8 | 连续8点在C区外 | 层别混杂 |

**本系统实现**: 准则1 (点超出3σ)

### 5.2 分区定义

```
A区: 2σ ~ 3σ
B区: 1σ ~ 2σ
C区: 0  ~ 1σ
```

## 6. 过程能力分析

### 6.1 过程能力指数 (Cpk)

**公式**:
```
Cpu = (USL - μ) / (3σ)   # 上侧能力
Cpl = (μ - LSL) / (3σ)   # 下侧能力
Cpk = min(Cpu, Cpl)       # 取较小值
```

**判定标准**:

| Cpk值 | 等级 | 过程能力 | 建议 |
|-------|------|----------|------|
| ≥ 1.67 | A | 特级 | 维持现状 |
| 1.33 ~ 1.67 | B | 一级 | 可接受 |
| 1.00 ~ 1.33 | C | 二级 | 需改进 |
| < 1.00 | D | 不足 | 必须改进 |

### 6.2 Cpk实例

**场景**: 轴径测量
- USL = 30.0mm
- LSL = 20.0mm
- μ = 25.0mm
- σ = 1.5mm

**计算**:
```
Cpu = (30 - 25) / (3 × 1.5) = 5 / 4.5 = 1.11
Cpl = (25 - 20) / (3 × 1.5) = 5 / 4.5 = 1.11
Cpk = 1.11
```

**结论**: 过程能力二级，需要改进。

## 7. 实战案例

### 7.1 案例背景

**产品**: 精密轴零件  
**关键尺寸**: 直径 φ25 ± 0.3mm  
**规格限**: 
- USL = 25.3mm
- LSL = 24.7mm

### 7.2 数据收集

| 日期 | 测量值 (mm) |
|------|-------------|
| 2/1  | 25.05 |
| 2/2  | 25.12 |
| 2/3  | 25.08 |
| 2/4  | 25.15 |
| 2/5  | 25.10 |
| 2/6  | 25.20 | ⚠️
| 2/7  | 25.18 |
| 2/8  | 25.25 | ⚠️
| 2/9  | 25.30 | 🚨 (达到上限)
| 2/10 | 25.28 | ⚠️

### 7.3 SPC分析

**统计量**:
- μ = 25.171
- σ = 0.088

**控制限**:
- UCL = 25.171 + 3×0.088 = 25.435
- CL = 25.171
- LCL = 25.171 - 3×0.088 = 24.907

**Cpk**:
```
Cpu = (25.3 - 25.171) / (3×0.088) = 0.488
Cpl = (25.171 - 24.7) / (3×0.088) = 1.783
Cpk = min(0.488, 1.783) = 0.488
```

### 7.4 结论与改善

**问题**:
1. 过程均值偏上 (25.171 > 25.0)
2. Cpk = 0.488 < 1.0，能力不足
3. 有上升趋势

**改善措施**:
1. 调整设备参数，降低加工尺寸
2. 检查刀具磨损情况
3. 加强首件检验

**预期效果**:
- 目标均值: 25.0mm
- 目标Cpk: > 1.33

## 8. 常见问题

### Q1: 样本数量不足怎么办？

**A**: SPC至少需要5个样本，建议20-25个。如果数据不足:
1. 继续收集数据
2. 使用其他质量工具 (如趋势分析)

### Q2: 数据不服从正态分布？

**A**: 
1. 检查是否有异常值
2. 数据转换 (如对数转换)
3. 使用非参数控制图

### Q3: 所有点都在控制限内，是否代表过程OK？

**A**: 不一定！还需要检查:
1. 是否有趋势
2. 是否有周期性波动
3. Cpk是否合格

### Q4: 控制限内但超出规格限？

**A**: 
- **过程稳定但能力不足**
- 需要降低过程波动 (减小σ)
- 或调整过程均值 (调整μ)

### Q5: 规格限内但超出控制限？

**A**:
- **过程不稳定**
- 查找特殊原因并消除
- 重新计算控制限

## 9. 最佳实践

### 9.1 实施建议

1. **选择关键特性**: 从影响产品功能的尺寸开始
2. **培训操作员**: 确保测量方法一致
3. **定期校准**: 测量仪器每月校准
4. **及时响应**: 发现失控立即停机检查
5. **持续改进**: 每季度回顾Cpk，设定改进目标

### 9.2 控制图维护

- **每班更新**: 将当班数据添加到控制图
- **每周回顾**: 质量工程师审查趋势
- **每月重计**: 重新计算控制限 (如果过程改善)

### 9.3 常见错误

❌ 只绘图不分析  
❌ 控制限当规格限用  
❌ 忽略失控信号  
❌ 不更新控制限  

✅ 分析失控原因  
✅ 区分控制限和规格限  
✅ 及时响应异常  
✅ 过程改善后重计算  

## 10. 参考资料

### 10.1 标准文献

- GB/T 4091-2001 《常规控制图》
- GB/T 17989-2000 《控制图 第1部分：通用指南》
- AIAG SPC手册

### 10.2 扩展阅读

- 《统计过程控制》 - Donald J. Wheeler
- 《质量管理统计方法》
- Six Sigma培训教材

## 11. 技术支持

**系统问题**: 
- 邮件: support@pms.com
- 内部工单系统

**质量咨询**: 
- 联系质量部门
- 质量工程师培训课程

---

**版本**: 1.0  
**发布日期**: 2026-02-16  
**编写**: Team 3 - 质量管理增强系统

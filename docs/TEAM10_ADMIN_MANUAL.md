# å”®å‰AIç³»ç»Ÿ - ç³»ç»Ÿç®¡ç†å‘˜æ‰‹å†Œ

## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
2. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
3. [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
4. [ç›‘æ§ä¸ç»´æŠ¤](#ç›‘æ§ä¸ç»´æŠ¤)
5. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
6. [å®‰å…¨ç®¡ç†](#å®‰å…¨ç®¡ç†)
7. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
8. [å¤‡ä»½ä¸æ¢å¤](#å¤‡ä»½ä¸æ¢å¤)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æŠ€æœ¯æ ˆ

**å‰ç«¯**:
- React 19 + TypeScript
- Vite æ„å»ºå·¥å…·
- Tailwind CSS + shadcn/ui
- Zustand çŠ¶æ€ç®¡ç†
- Recharts å›¾è¡¨åº“

**åç«¯**:
- FastAPI (Python 3.9+)
- SQLAlchemy ORM
- MySQL 8.0+
- Redis (å¯é€‰ï¼Œç”¨äºç¼“å­˜)

**AIæœåŠ¡**:
- OpenAI GPT-4 (æˆ–å…¶ä»–LLM)
- è‡ªå®šä¹‰AIå¾®æœåŠ¡

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯åº”ç”¨                       â”‚
â”‚         (React + Vite + Tailwind)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ HTTP/HTTPS
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                FastAPIåº”ç”¨                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ APIè·¯ç”±  â”‚  â”‚  æœåŠ¡å±‚  â”‚  â”‚  æ¨¡å‹å±‚  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MySQL  â”‚ â”‚ Redis  â”‚ â”‚ AI API â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å‰ç½®è¦æ±‚

- Python 3.9+
- Node.js 18+
- MySQL 8.0+
- Redis 6.0+ (å¯é€‰)
- 2GB+ RAM
- 10GB+ ç£ç›˜ç©ºé—´

### æ•°æ®åº“åˆå§‹åŒ–

1. **åˆ›å»ºæ•°æ®åº“**:
```sql
CREATE DATABASE presale_ai CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'presale_user'@'localhost' IDENTIFIED BY 'secure_password';
GRANT ALL PRIVILEGES ON presale_ai.* TO 'presale_user'@'localhost';
FLUSH PRIVILEGES;
```

2. **è¿è¡Œè¿ç§»**:
```bash
cd /path/to/project
alembic upgrade head
```

3. **åˆå§‹åŒ–AIé…ç½®**:
```bash
python scripts/init_ai_config.py
```

### åç«¯éƒ¨ç½²

1. **å®‰è£…ä¾èµ–**:
```bash
cd backend
pip install -r requirements.txt
```

2. **é…ç½®ç¯å¢ƒå˜é‡**:
```bash
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œè®¾ç½®ï¼š
# - DATABASE_URL
# - SECRET_KEY
# - OPENAI_API_KEY
# - REDIS_URL (å¯é€‰)
```

3. **å¯åŠ¨æœåŠ¡**:
```bash
# å¼€å‘ç¯å¢ƒ
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# ç”Ÿäº§ç¯å¢ƒ
gunicorn app.main:app \
  --workers 4 \
  --worker-class uvicorn.workers.UvicornWorker \
  --bind 0.0.0.0:8000 \
  --access-logfile access.log \
  --error-logfile error.log
```

### å‰ç«¯éƒ¨ç½²

1. **å®‰è£…ä¾èµ–**:
```bash
cd frontend
npm install
```

2. **æ„å»ºç”Ÿäº§ç‰ˆæœ¬**:
```bash
npm run build
```

3. **éƒ¨ç½²åˆ°Nginx**:
```nginx
server {
    listen 80;
    server_name your-domain.com;

    root /path/to/frontend/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

---

## âš™ï¸ é…ç½®ç®¡ç†

### AIåŠŸèƒ½é…ç½®

**ä½ç½®**: ç³»ç»Ÿç®¡ç† â†’ AIé…ç½®

å¯é…ç½®å‚æ•°ï¼š

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | èŒƒå›´ |
|------|------|--------|------|
| enabled | æ˜¯å¦å¯ç”¨ | true | true/false |
| model_name | æ¨¡å‹åç§° | gpt-4 | - |
| temperature | æ¸©åº¦å‚æ•° | 0.7 | 0.0-2.0 |
| max_tokens | æœ€å¤§tokens | 2000 | 1-8000 |
| timeout_seconds | è¶…æ—¶æ—¶é—´ | 30 | 1-300 |

**é€šè¿‡APIé…ç½®**:
```bash
curl -X POST "http://localhost:8000/api/v1/presale/ai/config/update?ai_function=requirement" \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "enabled": true,
    "temperature": 0.7,
    "max_tokens": 2000
  }'
```

**é€šè¿‡æ•°æ®åº“é…ç½®**:
```sql
UPDATE presale_ai_config 
SET temperature = 0.8, max_tokens = 3000 
WHERE ai_function = 'requirement';
```

### ç³»ç»Ÿå‚æ•°é…ç½®

**æ–‡ä»¶**: `app/core/config.py`

```python
class Settings(BaseSettings):
    # åº”ç”¨é…ç½®
    APP_NAME: str = "å”®å‰AIç³»ç»Ÿ"
    APP_VERSION: str = "1.0.0"
    DEBUG: bool = False
    
    # æ•°æ®åº“é…ç½®
    DATABASE_URL: str
    
    # AIé…ç½®
    OPENAI_API_KEY: str
    OPENAI_MODEL: str = "gpt-4"
    OPENAI_TIMEOUT: int = 30
    
    # Redisé…ç½®
    REDIS_URL: Optional[str] = None
    
    # å®‰å…¨é…ç½®
    SECRET_KEY: str
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
```

---

## ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤

### å¥åº·æ£€æŸ¥

**æ‰‹åŠ¨æ£€æŸ¥**:
```bash
curl http://localhost:8000/api/v1/presale/ai/health-check
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "healthy",
  "services": {
    "database": {"status": "healthy"},
    "ai_functions": {"status": "healthy", "enabled_count": 9},
    "recent_activity": {"status": "healthy", "usage_count_24h": 145}
  }
}
```

**è‡ªåŠ¨ç›‘æ§è„šæœ¬**:
```bash
#!/bin/bash
# health_monitor.sh

while true; do
    STATUS=$(curl -s http://localhost:8000/api/v1/presale/ai/health-check | jq -r '.status')
    
    if [ "$STATUS" != "healthy" ]; then
        echo "$(date): System unhealthy!" | tee -a health.log
        # å‘é€å‘Šè­¦é‚®ä»¶/çŸ­ä¿¡
    fi
    
    sleep 60
done
```

### æ—¥å¿—ç®¡ç†

**æ—¥å¿—ä½ç½®**:
- åº”ç”¨æ—¥å¿—: `/var/log/presale-ai/app.log`
- è®¿é—®æ—¥å¿—: `/var/log/presale-ai/access.log`
- é”™è¯¯æ—¥å¿—: `/var/log/presale-ai/error.log`
- AIè°ƒç”¨æ—¥å¿—: `/var/log/presale-ai/ai.log`

**æ—¥å¿—è½®è½¬é…ç½®** (`/etc/logrotate.d/presale-ai`):
```
/var/log/presale-ai/*.log {
    daily
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 www-data www-data
    sharedscripts
    postrotate
        systemctl reload presale-ai
    endscript
}
```

**æŸ¥çœ‹å®æ—¶æ—¥å¿—**:
```bash
tail -f /var/log/presale-ai/app.log
```

**æœç´¢é”™è¯¯**:
```bash
grep "ERROR" /var/log/presale-ai/app.log | tail -n 50
```

### æ€§èƒ½æŒ‡æ ‡

**å…³é”®æŒ‡æ ‡**:
- APIå“åº”æ—¶é—´ (ç›®æ ‡: <500ms)
- AIå¤„ç†æ—¶é—´ (ç›®æ ‡: <30s)
- æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ (ç›®æ ‡: <100ms)
- ç³»ç»Ÿå¯ç”¨æ€§ (ç›®æ ‡: >99.9%)

**ç›‘æ§å·¥å…·**:
- Prometheus + Grafana
- New Relic
- Datadog

**è‡ªå®šä¹‰æŒ‡æ ‡**:
```python
# app/utils/metrics.py
from prometheus_client import Counter, Histogram

ai_requests_total = Counter('ai_requests_total', 'Total AI requests', ['function'])
ai_request_duration = Histogram('ai_request_duration_seconds', 'AI request duration', ['function'])
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. AIå¤„ç†å¤±è´¥

**ç—‡çŠ¶**: AIåŠŸèƒ½è¿”å›é”™è¯¯

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥AIé…ç½®æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
3. æµ‹è¯•APIè¿æ¥
4. æ£€æŸ¥é…é¢å’Œé™åˆ¶

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥AIé…ç½®
curl http://localhost:8000/api/v1/presale/ai/config

# æµ‹è¯•OpenAIè¿æ¥
python scripts/test_ai_connection.py

# æŸ¥çœ‹é”™è¯¯è¯¦æƒ…
grep "OpenAI" /var/log/presale-ai/error.log
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: åº”ç”¨æ— æ³•å¯åŠ¨æˆ–æŸ¥è¯¢å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥MySQLæ˜¯å¦è¿è¡Œ
2. éªŒè¯æ•°æ®åº“å‡­æ®
3. æµ‹è¯•ç½‘ç»œè¿æ¥
4. æ£€æŸ¥è¿æ¥æ± é…ç½®

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥MySQLçŠ¶æ€
systemctl status mysql

# æµ‹è¯•è¿æ¥
mysql -u presale_user -p -h localhost presale_ai

# æ£€æŸ¥è¿æ¥æ•°
mysql> SHOW PROCESSLIST;
```

#### 3. æ€§èƒ½é—®é¢˜

**ç—‡çŠ¶**: å“åº”ç¼“æ…¢

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨
2. åˆ†ææ…¢æŸ¥è¯¢
3. æŸ¥çœ‹å¹¶å‘è¿æ¥æ•°
4. æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# å¯ç”¨MySQLæ…¢æŸ¥è¯¢æ—¥å¿—
mysql> SET GLOBAL slow_query_log = 'ON';
mysql> SET GLOBAL long_query_time = 1;

# åˆ†ææ…¢æŸ¥è¯¢
mysqldumpslow /var/log/mysql/slow.log
```

### è°ƒè¯•æ¨¡å¼

**å¯ç”¨è°ƒè¯•æ—¥å¿—**:
```bash
# .envæ–‡ä»¶
DEBUG=true
LOG_LEVEL=DEBUG
```

**Pythonè°ƒè¯•å™¨**:
```python
# åœ¨ä»£ç ä¸­æ·»åŠ æ–­ç‚¹
import pdb; pdb.set_trace()
```

---

## ğŸ” å®‰å…¨ç®¡ç†

### è®¿é—®æ§åˆ¶

**ç”¨æˆ·æƒé™ç®¡ç†**:
```sql
-- æŸ¥çœ‹ç”¨æˆ·æƒé™
SELECT u.username, r.name as role, p.name as permission
FROM users u
JOIN user_roles ur ON u.id = ur.user_id
JOIN roles r ON ur.role_id = r.id
JOIN role_permissions rp ON r.id = rp.role_id
JOIN permissions p ON rp.permission_id = p.id
WHERE u.username = 'admin';

-- æˆäºˆAIç®¡ç†æƒé™
INSERT INTO user_permissions (user_id, permission_id)
SELECT u.id, p.id
FROM users u, permissions p
WHERE u.username = 'admin' 
  AND p.name = 'ai:manage';
```

### APIå¯†é’¥ç®¡ç†

**ç”ŸæˆAPIå¯†é’¥**:
```bash
python scripts/generate_api_key.py
```

**è½®æ¢å¯†é’¥**:
```bash
# æ›´æ–°.envæ–‡ä»¶
SECRET_KEY=$(openssl rand -hex 32)
OPENAI_API_KEY=sk-new-key-here

# é‡å¯æœåŠ¡
systemctl restart presale-ai
```

### å®¡è®¡æ—¥å¿—

**æŸ¥çœ‹å®¡è®¡æ—¥å¿—**:
```sql
SELECT * FROM presale_ai_audit_log
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 24 HOUR)
ORDER BY created_at DESC;
```

**å¯¼å‡ºå®¡è®¡æ—¥å¿—**:
```bash
mysql -u root -p presale_ai -e "
SELECT * FROM presale_ai_audit_log 
WHERE created_at >= '2026-02-01'
" > audit_export.csv
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

**æ·»åŠ ç´¢å¼•**:
```sql
-- AIä½¿ç”¨ç»Ÿè®¡ç´¢å¼•
CREATE INDEX idx_usage_stats_lookup 
ON presale_ai_usage_stats(user_id, ai_function, date);

-- å·¥ä½œæµæ—¥å¿—ç´¢å¼•
CREATE INDEX idx_workflow_ticket 
ON presale_ai_workflow_log(presale_ticket_id, workflow_step);
```

**æŸ¥è¯¢ä¼˜åŒ–**:
```sql
-- ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢
EXPLAIN SELECT * FROM presale_ai_usage_stats 
WHERE user_id = 10 AND date >= '2026-02-01';
```

### åº”ç”¨ä¼˜åŒ–

**å¯ç”¨ç¼“å­˜**:
```python
# app/core/cache.py
from functools import lru_cache

@lru_cache(maxsize=128)
def get_ai_config(ai_function: str):
    # ç¼“å­˜AIé…ç½®
    pass
```

**å¼‚æ­¥å¤„ç†**:
```python
# app/services/ai_async.py
import asyncio

async def process_workflow_async(ticket_id: int):
    # å¼‚æ­¥å¤„ç†å·¥ä½œæµ
    pass
```

### è´Ÿè½½å‡è¡¡

**Nginxé…ç½®**:
```nginx
upstream presale_ai {
    server 127.0.0.1:8001;
    server 127.0.0.1:8002;
    server 127.0.0.1:8003;
}

server {
    location /api {
        proxy_pass http://presale_ai;
    }
}
```

---

## ğŸ’¾ å¤‡ä»½ä¸æ¢å¤

### æ•°æ®åº“å¤‡ä»½

**è‡ªåŠ¨å¤‡ä»½è„šæœ¬**:
```bash
#!/bin/bash
# backup_db.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/var/backups/presale-ai"
MYSQL_USER="root"
MYSQL_PASS="password"
DATABASE="presale_ai"

mysqldump -u $MYSQL_USER -p$MYSQL_PASS $DATABASE | \
  gzip > $BACKUP_DIR/presale_ai_$DATE.sql.gz

# ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql.gz" -mtime +30 -delete
```

**å®šæ—¶ä»»åŠ¡** (`crontab -e`):
```cron
# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /path/to/backup_db.sh
```

### æ•°æ®æ¢å¤

**æ¢å¤æ•°æ®åº“**:
```bash
# è§£å‹å¤‡ä»½
gunzip presale_ai_20260215.sql.gz

# æ¢å¤æ•°æ®
mysql -u root -p presale_ai < presale_ai_20260215.sql
```

### æ–‡ä»¶å¤‡ä»½

**å¤‡ä»½ä¸Šä¼ æ–‡ä»¶**:
```bash
# ä½¿ç”¨rsyncåŒæ­¥
rsync -avz /var/www/presale-ai/uploads/ \
  backup-server:/backups/uploads/
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- ğŸ“§ æŠ€æœ¯æ”¯æŒ: tech-support@example.com
- ğŸš¨ ç´§æ€¥çƒ­çº¿: 400-XXX-XXXX (24/7)
- ğŸ’¬ Slacké¢‘é“: #presale-ai-support

### å‡çº§è¯´æ˜
- ç³»ç»Ÿå‡çº§è¯·æå‰å¤‡ä»½
- éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬å·
- æŸ¥çœ‹CHANGELOGäº†è§£å˜æ›´

---

**æœ€åæ›´æ–°**: 2026-02-15  
**ç‰ˆæœ¬**: v1.0.0

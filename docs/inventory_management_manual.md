# 库存管理系统 - 操作手册

**Team 2 交付文档**  
**版本**: 1.0  
**日期**: 2026-02-16

---

## 📖 目录

1. [系统概述](#系统概述)
2. [入库管理](#入库管理)
3. [出库管理](#出库管理)
4. [物料预留](#物料预留)
5. [库存转移](#库存转移)
6. [库存查询](#库存查询)
7. [库存分析](#库存分析)
8. [常见问题](#常见问题)

---

## 系统概述

### 功能模块

```
库存管理系统
├── 入库管理 (采购入库、退料入库、调拨入库)
├── 出库管理 (领料出库、报废出库)
├── 物料预留 (项目预留、工单预留)
├── 库存转移 (仓库间调拨)
├── 库存查询 (实时库存、交易记录)
├── 库存盘点 (详见盘点指南)
└── 库存分析 (周转率、库龄分析)
```

### 角色权限

| 角色 | 入库 | 出库 | 预留 | 转移 | 盘点 | 查询 |
|------|------|------|------|------|------|------|
| 仓库管理员 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 采购员 | ✓ | × | × | × | × | ✓ |
| 生产主管 | × | ✓ | ✓ | × | × | ✓ |
| 财务人员 | × | × | × | × | × | ✓ |

---

## 入库管理

### 1. 采购入库

**操作场景**: 采购的物料到货,需要办理入库

**操作步骤**:

1. **准备工作**
   - 确认采购订单号
   - 准备到货单/送货单
   - 进行质量检验

2. **录入入库信息**

   **API调用**:
   ```bash
   POST /api/v1/inventory/purchase-in
   ```

   **请求示例**:
   ```json
   {
     "material_id": 101,
     "quantity": 500,
     "unit_price": 58.50,
     "location": "仓库A-01货架",
     "batch_number": "BATCH-20260216-001",
     "purchase_order_id": 2001,
     "purchase_order_no": "PO-2026021601",
     "production_date": "2026-02-10",
     "expire_date": "2027-02-10",
     "remark": "质检合格,全部入库"
   }
   ```

3. **确认入库**
   - 系统自动生成入库单号
   - 更新库存数量
   - 创建交易记录

4. **打印入库单**
   - 仓管员签字
   - 供应商签字
   - 存档备查

**注意事项**:
- ✅ 批次号必须唯一
- ✅ 单价需与采购订单一致
- ✅ 有效期物料必须填写生产日期和失效日期
- ⚠️ 质检不合格物料应单独入库并标记

### 2. 退料入库

**操作场景**: 生产车间退回多领的物料

**操作步骤**:

1. **确认退料信息**
   - 退料单号
   - 物料编码
   - 退料数量
   - 退料原因

2. **办理退料入库**

   **API调用**:
   ```bash
   POST /api/v1/inventory/return
   ```

   **请求示例**:
   ```json
   {
     "material_id": 101,
     "quantity": 20,
     "location": "仓库A-01货架",
     "batch_number": "BATCH-20260216-001",
     "work_order_id": 3001,
     "remark": "工单完成,余料退回"
   }
   ```

3. **检查物料状态**
   - 完好无损 → 正常入库
   - 已开封/部分使用 → 标记批次
   - 损坏 → 单独处理

**注意事项**:
- ✅ 退料数量不能超过原领料数量
- ✅ 退料物料应检查质量状况
- ⚠️ 不同批次应分别退料

---

## 出库管理

### 1. 领料出库

**操作场景**: 生产车间领取生产物料

**操作步骤**:

1. **准备领料单**
   - 工单号
   - 物料清单
   - 领料数量

2. **选择成本核算方法**

   **FIFO (先进先出)** - 推荐用于:
   - 有保质期的物料
   - 电子元器件
   - 化工原料

   **LIFO (后进先出)** - 推荐用于:
   - 价格波动较大的物料
   - 金属材料

   **加权平均** - 推荐用于:
   - 通用标准件
   - 价格稳定的物料

3. **办理领料**

   **API调用**:
   ```bash
   POST /api/v1/inventory/issue
   ```

   **请求示例**:
   ```json
   {
     "material_id": 101,
     "quantity": 150,
     "location": "仓库A-01货架",
     "work_order_id": 3001,
     "work_order_no": "WO-2026021601",
     "project_id": 5,
     "cost_method": "FIFO",
     "reservation_id": 1001,
     "remark": "工单3001生产领料"
   }
   ```

4. **确认领料**
   - 车间主管签字
   - 仓管员签字
   - 系统自动扣减库存

**注意事项**:
- ✅ 优先使用预留库存
- ✅ FIFO方法下,系统自动从最早批次出库
- ⚠️ 库存不足时会提示错误
- ⚠️ 预留库存不能被其他项目领用

### 2. 报废出库

**操作场景**: 物料过期、损坏需要报废

**操作步骤**:

1. **提交报废申请**
   - 填写报废原因
   - 拍照留存
   - 提交审批

2. **审批通过后办理报废**

   **API调用**:
   ```bash
   POST /api/v1/inventory/issue
   ```

   **请求示例**:
   ```json
   {
     "material_id": 101,
     "quantity": 10,
     "location": "仓库A-01货架",
     "transaction_type": "SCRAP",
     "remark": "物料过期报废,批准人:张经理"
   }
   ```

3. **财务处理**
   - 计入损失
   - 调整成本

**注意事项**:
- ⚠️ 报废需要审批
- ⚠️ 报废物料应单独存放
- ⚠️ 定期统计报废率

---

## 物料预留

### 功能说明

物料预留用于确保项目/工单有充足的物料供应,防止被其他项目挪用。

### 操作步骤

1. **创建预留**

   **API调用**:
   ```bash
   POST /api/v1/inventory/reserve
   ```

   **请求示例**:
   ```json
   {
     "material_id": 101,
     "quantity": 200,
     "project_id": 5,
     "work_order_id": null,
     "expected_use_date": "2026-03-01",
     "remark": "项目X 二期预留"
   }
   ```

2. **系统处理**
   - 检查可用库存
   - 扣减可用数量
   - 增加预留数量
   - 生成预留单号

3. **使用预留**
   - 领料时指定 `reservation_id`
   - 系统自动释放预留

4. **取消预留**

   **API调用**:
   ```bash
   POST /api/v1/inventory/reservation/{id}/cancel
   ```

   **请求示例**:
   ```json
   {
     "cancel_reason": "项目延期,取消预留"
   }
   ```

**使用场景**:
- ✅ 大型项目启动前预留关键物料
- ✅ 重要客户订单优先预留
- ✅ 长周期项目分阶段预留

**注意事项**:
- ⚠️ 预留会占用可用库存
- ⚠️ 预留后其他项目无法领用
- ⚠️ 及时取消不需要的预留

---

## 库存转移

### 功能说明

库存转移用于在不同仓库/货位之间调拨物料。

### 操作步骤

1. **发起转移申请**

   **API调用**:
   ```bash
   POST /api/v1/inventory/transfer
   ```

   **请求示例**:
   ```json
   {
     "material_id": 101,
     "quantity": 100,
     "from_location": "仓库A-01货架",
     "to_location": "仓库B-05货架",
     "batch_number": "BATCH-20260216-001",
     "remark": "平衡库存,调拨至生产车间"
   }
   ```

2. **系统处理**
   - 从源位置出库
   - 向目标位置入库
   - 保持批次号不变
   - 保持单价不变

3. **物理移库**
   - 打印调拨单
   - 搬运物料
   - 确认到位

**使用场景**:
- ✅ 平衡各仓库库存
- ✅ 优化存储空间
- ✅ 调拨至生产线边仓

**注意事项**:
- ⚠️ 转移数量不能超过源位置库存
- ⚠️ 物理移库应与系统操作同步
- ⚠️ 贵重物料转移需要审批

---

## 库存查询

### 1. 实时库存查询

**API调用**:
```bash
GET /api/v1/inventory/stocks?material_id=101&location=仓库A
```

**响应示例**:
```json
[
  {
    "id": 1,
    "material_code": "MAT-101",
    "material_name": "电阻 10KΩ",
    "location": "仓库A-01货架",
    "batch_number": "BATCH-20260216-001",
    "quantity": 4850.0,
    "available_quantity": 4650.0,
    "reserved_quantity": 200.0,
    "unit": "只",
    "unit_price": 0.15,
    "total_value": 727.50,
    "status": "NORMAL",
    "last_update": "2026-02-16T10:30:00"
  }
]
```

**查询参数**:
- `material_id`: 物料ID (精确匹配)
- `location`: 仓库位置 (模糊匹配)
- `status`: 库存状态 (NORMAL/LOW/EXPIRED)

### 2. 交易记录查询

**API调用**:
```bash
GET /api/v1/inventory/stocks/101/transactions?transaction_type=PURCHASE_IN&limit=20
```

**响应示例**:
```json
[
  {
    "id": 1001,
    "material_code": "MAT-101",
    "transaction_type": "PURCHASE_IN",
    "quantity": 5000.0,
    "unit_price": 0.15,
    "total_amount": 750.00,
    "target_location": "仓库A-01货架",
    "batch_number": "BATCH-20260216-001",
    "transaction_date": "2026-02-16T09:00:00",
    "remark": "采购订单 PO-2026021601"
  }
]
```

**查询参数**:
- `transaction_type`: 交易类型
- `start_date`: 开始日期
- `end_date`: 结束日期
- `limit`: 返回数量 (默认100)

---

## 库存分析

### 1. 库存周转率

**定义**: 库存周转率 = 出库总额 / 平均库存

**API调用**:
```bash
GET /api/v1/inventory/analysis/turnover?material_id=101&start_date=2026-02-01&end_date=2026-02-16
```

**响应示例**:
```json
{
  "period": {
    "start_date": "2026-02-01",
    "end_date": "2026-02-16"
  },
  "total_issue_value": 12500.00,
  "avg_stock_value": 5000.00,
  "turnover_rate": 2.5,
  "turnover_days": 146
}
```

**分析指标**:
- 周转率 > 6: 库存周转很快,可能存在缺货风险
- 周转率 3-6: 正常范围
- 周转率 < 3: 库存周转慢,可能存在呆滞库存

### 2. 库龄分析

**定义**: 分析物料在库时间,识别呆滞库存

**API调用**:
```bash
GET /api/v1/inventory/analysis/aging?location=仓库A
```

**响应示例**:
```json
{
  "aging_summary": {
    "0-30天": {
      "count": 15,
      "total_quantity": 5000,
      "total_value": 75000.00
    },
    "31-90天": {
      "count": 8,
      "total_quantity": 2000,
      "total_value": 30000.00
    },
    "91-180天": {
      "count": 3,
      "total_quantity": 500,
      "total_value": 7500.00
    },
    "181-365天": {
      "count": 1,
      "total_quantity": 100,
      "total_value": 1500.00
    },
    "365天以上": {
      "count": 0,
      "total_quantity": 0,
      "total_value": 0
    }
  },
  "details": [...]
}
```

**处理建议**:
- **0-90天**: 正常周转
- **91-180天**: 关注是否需求下降
- **181-365天**: 考虑促销或内部消化
- **365天以上**: 建议报废或降价处理

---

## 常见问题

### Q1: 库存不足时如何处理?

**A**: 系统会自动检查库存,不足时会提示错误:
```json
{
  "error": "库存不足: 需要 500, 可用 300"
}
```

**解决方案**:
1. 检查是否有预留占用
2. 检查其他仓库是否有库存
3. 紧急采购或调拨
4. 调整工单计划

### Q2: 如何选择成本核算方法?

**A**: 根据物料特性选择:

| 物料类型 | 推荐方法 | 原因 |
|---------|---------|------|
| 有保质期物料 | FIFO | 避免过期 |
| 价格波动大 | LIFO | 成本接近市场价 |
| 通用标准件 | 加权平均 | 简单稳定 |

### Q3: 预留的物料可以被其他项目领用吗?

**A**: 不可以。预留后:
- `reserved_quantity` 增加
- `available_quantity` 减少
- 其他项目无法领用预留数量

### Q4: 批次号有什么作用?

**A**: 批次号用于:
- 质量追溯
- 成本核算
- 有效期管理
- 问题物料召回

### Q5: 如何处理盘点差异?

**A**: 详见 [库存盘点指南](./stock_count_guide.md)

---

## 联系支持

如有问题,请联系:
- **技术支持**: tech-support@example.com
- **业务咨询**: business@example.com
- **紧急热线**: 400-XXX-XXXX

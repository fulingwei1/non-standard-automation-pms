# 项目评价配置管理说明

> ⚠️ 说明：本文件记录的是已移除的历史接口（兼容层）。  
> 兼容层已于 2026-01-31 清理移除，当前不再提供独立的“评价维度配置”API。

## 概述

项目评价体系的所有配置都可以在后台由管理员进行设置和管理，无需修改代码。这包括：

1. **评价维度配置**：维度名称、权重、评分规则、计算方式等
2. **权重配置**：各维度的权重百分比
3. **评分规则**：每个维度的评分标准和范围

---

## 一、评价维度配置管理

### 1.1 获取维度配置列表

**接口**: `GET （已移除）/dimensions`

**参数**:
- `page`: 页码（默认1）
- `page_size`: 每页数量（默认100）
- `is_active`: 是否启用（可选，true/false）

**响应示例**:
```json
{
  "items": [
    {
      "id": 1,
      "dimension_code": "NOVELTY",
      "dimension_name": "项目新旧",
      "dimension_type": "NOVELTY",
      "default_weight": 15.00,
      "calculation_method": "HYBRID",
      "scoring_rules": {
        "ranges": [
          {"min": 1, "max": 3, "label": "全新项目", "description": "从未做过类似项目"},
          {"min": 4, "max": 6, "label": "类似项目", "description": "做过类似项目"},
          {"min": 7, "max": 9, "label": "标准项目", "description": "做过多次"},
          {"min": 10, "max": 10, "label": "完全标准", "description": "完全标准项目"}
        ]
      },
      "is_active": true,
      "sort_order": 1
    }
  ],
  "total": 5,
  "page": 1,
  "page_size": 100
}
```

### 1.2 创建维度配置

**接口**: `POST （已移除）/dimensions`

**请求体**:
```json
{
  "dimension_code": "CUSTOM_DIMENSION",
  "dimension_name": "自定义维度",
  "dimension_type": "CUSTOM",
  "default_weight": 10.00,
  "calculation_method": "MANUAL",
  "scoring_rules": {
    "ranges": [
      {"min": 1, "max": 5, "label": "低", "description": "..."},
      {"min": 6, "max": 10, "label": "高", "description": "..."}
    ]
  },
  "is_active": true,
  "sort_order": 6
}
```

### 1.3 更新维度配置

**接口**: `PUT （已移除）/dimensions/{dim_id}`

**请求体**（所有字段可选）:
```json
{
  "dimension_name": "项目新旧（更新）",
  "default_weight": 20.00,
  "scoring_rules": {
    "ranges": [
      {"min": 1, "max": 3, "label": "全新", "description": "..."}
    ]
  },
  "is_active": false
}
```

### 1.4 删除维度配置

**接口**: `DELETE （已移除）/dimensions/{dim_id}`

### 1.5 启用/停用维度配置

**接口**: `POST （已移除）/dimensions/{dim_id}/toggle`

---

## 二、权重配置管理

### 2.1 获取权重配置摘要

**接口**: `GET （已移除）/dimensions/weights/summary`

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "weights": {
      "novelty": 15.0,
      "new_tech": 20.0,
      "difficulty": 30.0,
      "workload": 20.0,
      "amount": 15.0
    },
    "total": 100.0,
    "is_valid": true,
    "dimensions": [
      {
        "type": "novelty",
        "weight": 0.15,
        "weight_percent": 15.0
      }
    ]
  }
}
```

**说明**:
- `total`: 权重总和（应该为100）
- `is_valid`: 权重是否有效（总和是否为100，允许0.01的误差）
- `dimensions`: 各维度的详细权重信息

### 2.2 修改权重配置

通过更新维度配置的 `default_weight` 字段来修改权重：

```json
PUT （已移除）/dimensions/1
{
  "default_weight": 25.00  // 将项目新旧权重从15%改为25%
}
```

**注意**: 修改权重后，系统会自动归一化，确保权重总和为100%。

---

## 三、评分规则配置

### 3.1 评分规则格式

评分规则存储在 `scoring_rules` 字段中，格式为JSON：

```json
{
  "ranges": [
    {
      "min": 1,
      "max": 3,
      "label": "极高难度",
      "description": "技术挑战极大，需要大量创新"
    },
    {
      "min": 4,
      "max": 6,
      "label": "高难度",
      "description": "技术挑战大，有一定创新"
    },
    {
      "min": 7,
      "max": 8,
      "label": "中等难度",
      "description": "技术挑战一般"
    },
    {
      "min": 9,
      "max": 10,
      "label": "低难度",
      "description": "技术挑战小，成熟技术"
    }
  ]
}
```

### 3.2 更新评分规则

通过更新维度配置的 `scoring_rules` 字段：

```json
PUT （已移除）/dimensions/3
{
  "scoring_rules": {
    "ranges": [
      {"min": 1, "max": 2, "label": "极高", "description": "..."},
      {"min": 3, "max": 5, "label": "高", "description": "..."},
      {"min": 6, "max": 8, "label": "中", "description": "..."},
      {"min": 9, "max": 10, "label": "低", "description": "..."}
    ]
  }
}
```

---

## 四、系统自动使用配置

### 4.1 权重配置自动应用

当创建项目评价时，系统会自动从数据库读取权重配置：

```python
# 服务层自动从数据库读取权重
eval_service = ProjectEvaluationService(db)
weights = eval_service.get_dimension_weights()  # 从数据库读取

# 计算综合得分时使用数据库配置
total_score = eval_service.calculate_total_score(
    novelty_score, new_tech_score, difficulty_score,
    workload_score, amount_score, weights  # 使用数据库配置
)
```

### 4.2 权重归一化

如果权重总和不为100%，系统会自动归一化：

```python
# 例如：配置的权重为 10%, 20%, 30%, 20%, 15% (总和95%)
# 系统会自动归一化为：10.5%, 21.1%, 31.6%, 21.1%, 15.8% (总和100%)
```

### 4.3 停用维度处理

停用的维度不会参与权重计算，系统会自动重新分配权重。

---

## 五、配置管理最佳实践

### 5.1 权重配置建议

1. **权重总和必须为100%**
   - 系统会自动归一化，但建议手动确保总和为100%
   - 可以通过 `/dimensions/weights/summary` 接口验证

2. **权重调整影响**
   - 修改权重会影响所有新创建的评价
   - 已创建的评价记录中的权重不会改变（历史记录保持不变）

3. **权重分配原则**
   - 难度权重通常最高（30%）
   - 新技术权重次之（20%）
   - 其他维度根据业务需求调整

### 5.2 评分规则配置建议

1. **评分范围**
   - 建议使用 1-10 分制
   - 每个范围应该清晰明确

2. **规则描述**
   - `label`: 简短标签（用于显示）
   - `description`: 详细描述（用于指导评价）

3. **规则更新**
   - 更新规则不会影响已创建的评价
   - 新评价会使用新规则

### 5.3 维度管理建议

1. **不要删除核心维度**
   - 核心维度（NOVELTY, NEW_TECH, DIFFICULTY, WORKLOAD, AMOUNT）建议停用而非删除
   - 删除维度可能导致历史数据不一致

2. **新增维度**
   - 可以添加自定义维度
   - 需要确保 `dimension_type` 唯一
   - 需要更新前端界面以支持新维度

3. **维度排序**
   - 使用 `sort_order` 控制维度显示顺序
   - 数值越小，排序越靠前

---

## 六、前端集成示例

### 6.1 获取配置

```javascript
// 获取维度配置列表
const dimensions = await api.get('（已移除）/dimensions', {
  params: { is_active: true }
})

// 获取权重摘要
const weightsSummary = await api.get('（已移除）/dimensions/weights/summary')
```

### 6.2 更新配置

```javascript
// 更新维度权重
await api.put(`（已移除）/dimensions/${dimId}`, {
  default_weight: 25.00
})

// 更新评分规则
await api.put(`（已移除）/dimensions/${dimId}`, {
  scoring_rules: {
    ranges: [
      { min: 1, max: 3, label: "高", description: "..." },
      { min: 4, max: 6, label: "中", description: "..." },
      { min: 7, max: 10, label: "低", description: "..." }
    ]
  }
})
```

---

## 七、API端点总结

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/dimensions` | 获取维度配置列表 |
| GET | `/dimensions/{id}` | 获取维度配置详情 |
| POST | `/dimensions` | 创建维度配置 |
| PUT | `/dimensions/{id}` | 更新维度配置 |
| DELETE | `/dimensions/{id}` | 删除维度配置 |
| POST | `/dimensions/{id}/toggle` | 启用/停用维度 |
| GET | `/dimensions/weights/summary` | 获取权重配置摘要 |

---

## 八、注意事项

1. **权限控制**: 所有配置管理接口需要管理员权限
2. **数据一致性**: 修改配置后，新评价会使用新配置，历史评价保持不变
3. **权重验证**: 系统会自动验证权重总和，但建议在前端也进行验证
4. **配置备份**: 重要配置修改前建议备份数据库

---

## 九、总结

✅ **已实现**:
- 所有评价配置都可以在后台管理
- 权重配置从数据库动态读取
- 支持维度配置的完整CRUD操作
- 支持权重自动归一化
- 支持配置启用/停用

✅ **优势**:
- 无需修改代码即可调整评价标准
- 配置变更立即生效（新评价）
- 历史评价数据保持不变
- 支持灵活的评分规则配置

现在，管理员可以通过后台界面或API直接管理项目评价的所有配置，无需开发人员介入！





# 渐进式重构执行清单

> **创建日期**: 2026-01-24  
> **预计总时长**: 11周  
> **当前阶段**: Phase 1 - 基础设施适配

---

## Phase 1: 基础设施适配和验证 (Week 1-2)

### Week 1

- [ ] **Day 1-3**: 创建同步CRUD基类适配器
  - [ ] `app/common/crud/sync_repository.py` - 同步Repository基类
  - [ ] `app/common/crud/sync_service.py` - 同步Service基类
  - [ ] `app/common/crud/sync_filters.py` - 同步查询构建器
  - [ ] 单元测试
  - [ ] 使用示例

- [ ] **Day 4-5**: 创建项目中心CRUD路由基类
  - [ ] `app/api/v1/core/crud_base.py` - ProjectCRUDRouter
  - [ ] 支持标准CRUD操作
  - [ ] 支持项目权限检查
  - [ ] 支持关键词搜索
  - [ ] 单元测试

### Week 2

- [x] **Day 6-7**: 试点迁移里程碑模块
  - [x] 创建 `MilestoneService`
  - [x] 重构API端点
  - [x] 运行测试
  - [x] 对比代码行数

- [x] **Day 8**: 创建迁移指南
  - [x] `docs/guides/crud-base-migration-guide.md`
  - [x] 包含步骤、示例、FAQ

**Phase 1 验收**:
- [x] 同步CRUD基类可用
- [x] 试点迁移成功
- [x] 代码行数减少50%+ (实际67%)
- [x] 文档完成

---

## Phase 2: API层重构 (Week 3-4)

### Week 3

- [ ] **Day 9-10**: 迁移里程碑模块
  - [ ] 使用CRUD基类重构
  - [ ] 保留自定义端点
  - [ ] 测试通过

- [x] **Day 11-12**: 迁移成本模块
  - [x] 使用CRUD基类重构
  - [x] 测试通过

- [x] **Day 13**: 迁移机器模块
  - [x] 使用CRUD基类重构（基类 + 覆盖端点）
  - [x] 测试通过

### Week 4

- [x] **Day 14**: 迁移成员模块
  - [x] 使用CRUD基类重构（覆盖所有端点以填充用户信息）
  - [x] 测试通过

- [x] **Day 15**: 迁移评价模块
  - [x] 使用CRUD基类重构（覆盖创建/更新端点使用服务层）
  - [x] 测试通过

- [x] **Day 16**: 迁移资源计划模块
  - [x] 使用CRUD基类重构（覆盖创建/删除端点使用服务层）
  - [x] 测试通过

- [x] **Day 17**: 迁移工时模块
  - [x] 使用CRUD基类重构（覆盖所有端点填充用户信息和任务名称）
  - [x] 测试通过

- [ ] **Day 15**: 废弃全局API端点
  - [ ] 标记deprecated
  - [ ] 添加重定向
  - [ ] 更新文档

- [ ] **Day 16-17**: 更新前端API调用
  - [ ] 更新 `milestoneApi`
  - [ ] 更新其他相关API
  - [ ] 前端功能测试

**Phase 2 验收**:
- [x] 4个模块迁移完成 (7/7: 里程碑✅, 成本✅, 机器✅, 成员✅, 评价✅, 资源计划✅, 工时✅)
- [ ] 全局API废弃
- [ ] 前端功能正常
- [x] 代码重复率降低60%+ (里程碑67%, 成本81%, 机器结构优化, 成员功能增强, 评价功能增强, 资源计划结构优化, 工时功能增强)

**不适合迁移的模块**:
- [x] 阶段模块（主要是自定义端点，无标准CRUD）
- [x] 工作日志模块（只读查询，通过关联表查询）
- [x] 工作量模块（统计查询，无标准CRUD）

---

## Phase 3: 服务层重构 (Week 5-6)

### Week 5

- [ ] **Day 18-20**: 统一奖金服务
  - [ ] 创建 `UnifiedBonusService`
  - [ ] 整合所有奖金计算逻辑
  - [ ] 测试通过
  - [ ] 标记旧服务为deprecated

- [ ] **Day 21-22**: 创建分析服务基类
  - [ ] `app/services/analysis/base_analysis_service.py`
  - [ ] 采购分析服务使用基类
  - [ ] 测试通过

### Week 6

- [ ] **Day 23-24**: 统一绩效服务
  - [ ] 创建 `UnifiedPerformanceService`
  - [ ] 整合所有绩效逻辑
  - [ ] 测试通过

**Phase 3 验收**:
- [ ] 服务层代码重复率降低50%+
- [ ] 所有测试通过
- [ ] 性能无退化

---

## Phase 4: 前端组件重构 (Week 7-8)

### Week 7

- [ ] **Day 25-26**: 创建通用StatCard组件
  - [ ] `frontend/src/components/common/StatCard.jsx`
  - [ ] 支持多种格式
  - [ ] 支持趋势显示
  - [ ] 在3个页面使用验证

- [ ] **Day 27-28**: 创建DashboardLayout模板
  - [ ] `frontend/src/components/common/DashboardLayout.jsx`
  - [ ] 支持统计卡片、标签页
  - [ ] 在2个工作台使用验证

### Week 8

- [ ] **Day 29-31**: 迁移现有页面
  - [ ] 项目经理工作台
  - [ ] 工程师工作台
  - [ ] 统一工作台

**Phase 4 验收**:
- [ ] 组件复用率提升
- [ ] UI风格统一
- [ ] 代码行数减少40%+

---

## Phase 5: Schema层优化 (Week 9-10)

### Week 9

- [ ] **Day 32-33**: 统一PaginatedResponse使用
  - [ ] 检查所有分页响应
  - [ ] 统一使用 `PaginatedResponse`
  - [ ] 移除重复定义

### Week 10

- [ ] **Day 34-36**: 创建Schema工厂（可选）
  - [ ] `app/schemas/factory.py`
  - [ ] 在1-2个模块使用验证
  - [ ] 如果过于复杂，可以跳过

**Phase 5 验收**:
- [ ] 分页响应统一
- [ ] Schema重复减少（如果实施工厂）

---

## Phase 6: 测试、文档、总结 (Week 11)

### Week 11

- [ ] **Day 37-38**: 完整测试验证
  - [ ] 单元测试
  - [ ] 集成测试
  - [ ] API测试
  - [ ] 前端功能测试
  - [ ] 性能测试

- [ ] **Day 39**: 文档更新
  - [ ] API文档
  - [ ] 开发指南
  - [ ] 迁移指南
  - [ ] 架构文档

- [ ] **Day 40**: 总结报告
  - [ ] 完成情况统计
  - [ ] 代码量减少统计
  - [ ] 性能对比
  - [ ] 经验总结

**Phase 6 验收**:
- [ ] 所有测试通过
- [ ] 文档更新完成
- [ ] 总结报告完成

---

## 总体进度跟踪

### 完成度统计

| 阶段 | 任务数 | 已完成 | 进行中 | 待开始 | 完成度 |
|------|--------|--------|--------|--------|--------|
| Phase 1 | 4 | 0 | 0 | 4 | 0% |
| Phase 2 | 6 | 0 | 0 | 6 | 0% |
| Phase 3 | 3 | 0 | 0 | 3 | 0% |
| Phase 4 | 3 | 0 | 0 | 3 | 0% |
| Phase 5 | 2 | 0 | 0 | 2 | 0% |
| Phase 6 | 3 | 0 | 0 | 3 | 0% |
| **总计** | **21** | **0** | **0** | **21** | **0%** |

### 关键指标

| 指标 | 目标 | 当前 | 状态 |
|------|------|------|------|
| 代码重复率降低 | 70%+ | - | ⏳ |
| API端点代码减少 | 60%+ | - | ⏳ |
| 服务层代码减少 | 50%+ | - | ⏳ |
| 前端组件代码减少 | 40%+ | - | ⏳ |
| 测试覆盖率 | 保持 | - | ⏳ |

---

## 每日进度记录

### Week 1 (2026-01-24 ~ 2026-01-30)

- [ ] Day 1 (01-24): 
- [ ] Day 2 (01-25): 
- [ ] Day 3 (01-26): 
- [ ] Day 4 (01-27): 
- [ ] Day 5 (01-28): 

### Week 2 (2026-01-31 ~ 2026-02-06)

- [ ] Day 6 (01-31): 
- [ ] Day 7 (02-01): 
- [ ] Day 8 (02-02): 

---

## 阻塞问题记录

| 日期 | 问题 | 影响 | 解决方案 | 状态 |
|------|------|------|----------|------|
| - | - | - | - | - |

---

## 经验总结

### 最佳实践

- [ ] 待补充

### 遇到的问题

- [ ] 待补充

### 改进建议

- [ ] 待补充

---

**最后更新**: 2026-01-24

# 生产排程最佳实践

## 1. 排程原则

### 1.1 核心原则
1. **交期优先**: 严格交期订单优先排程
2. **技能匹配**: 工人技能与工序要求匹配
3. **负荷均衡**: 避免资源过载或闲置
4. **柔性灵活**: 保留15%缓冲应对变化
5. **持续优化**: 定期评估和调整排程

### 1.2 优先级设定

**优先级矩阵**:
```
        紧急程度
         高 |  中 |  低
重  高 |  9 |  7 |  5
要      ─────────────
性  中 |  8 |  6 |  4
      ─────────────
    低 |  6 |  4 |  2
```

**优先级因素**:
- 客户级别 (VIP/普通)
- 合同金额
- 交期紧迫度
- 技术难度
- 库存压力

---

## 2. 排程策略

### 2.1 滚动排程法

**适用场景**: 订单波动大，变更频繁

**操作方法**:
```
固定排程期: 3天 (不允许变更)
滚动排程期: 7天 (可调整)
计划排程期: 30天 (粗排程)

示例:
├─ Day 1-3: 固定排程 (执行中)
├─ Day 4-10: 滚动排程 (每日微调)
└─ Day 11-30: 粗排程 (产能预估)
```

**优势**:
- ✅ 稳定性与灵活性兼顾
- ✅ 减少频繁变更
- ✅ 便于物料准备

### 2.2 瓶颈驱动排程 (DBR)

**TOC理论应用**:
```
识别瓶颈
    ↓
瓶颈工序满负荷排程
    ↓
非瓶颈工序服从瓶颈
    ↓
设置缓冲保护瓶颈
```

**案例**:
```
瓶颈: 激光切割机 (利用率98%)

排程策略:
1. 切割机全天满负荷
2. 焊接工序提前准备 (缓冲2小时)
3. 组装工序跟随切割进度
4. 测试工序批量处理

结果:
- 总产能提升15%
- 在制品减少30%
- 交期准时率提升到95%
```

### 2.3 混合流水线排程

**适用场景**: 多品种小批量生产

**策略**:
1. **按族排程**: 相似产品成组排程
2. **快速切换**: 优化换型顺序
3. **单件流**: 减少批量，加快流转

**示例**:
```
产品族A (焊接参数相似):
├─ 产品A1: 50件
├─ 产品A2: 30件
└─ 产品A3: 20件

排程顺序: A1 → A2 → A3 (一次设置,连续生产)
换型时间: 10分钟/次
总时间节省: 40分钟
```

---

## 3. AI排程应用

### 3.1 何时使用AI排程

**推荐使用**:
- ✅ 订单数量 > 10个
- ✅ 资源约束复杂
- ✅ 多目标优化需求
- ✅ 时间充裕(有1-2分钟计算时间)

**不推荐使用**:
- ❌ 订单简单(<5个)
- ❌ 紧急插单(来不及计算)
- ❌ 资源单一无约束

### 3.2 算法选择

**遗传算法**:
- 适用: 复杂场景，多目标优化
- 优点: 全局最优，适应性强
- 缺点: 计算时间长(1-2分钟)
- 参数: 种群100，迭代200代

**贪心算法**:
- 适用: 简单场景，紧急排程
- 优点: 速度快(<1秒)
- 缺点: 可能非最优解
- 策略: 优先级优先，就近分配

**对比**:
```
测试场景: 15个订单，5个资源

遗传算法:
├─ 计算时间: 1.5分钟
├─ 总完工时间: 8.5小时
└─ 利用率: 87%

贪心算法:
├─ 计算时间: 0.5秒
├─ 总完工时间: 9.2小时
└─ 利用率: 81%

改善: 遗传算法优化8.2%
```

### 3.3 参数调优

```python
# 推荐参数配置

# 简单场景 (订单<10)
simple_config = {
    'algorithm': 'GREEDY',
    'priority_weight': 0.7,
    'balance_weight': 0.3
}

# 中等复杂 (订单10-30)
medium_config = {
    'algorithm': 'GENETIC',
    'population_size': 50,
    'max_generations': 100,
    'crossover_rate': 0.8,
    'mutation_rate': 0.1
}

# 高度复杂 (订单>30)
complex_config = {
    'algorithm': 'GENETIC',
    'population_size': 100,
    'max_generations': 200,
    'crossover_rate': 0.9,
    'mutation_rate': 0.15,
    'elite_size': 10
}
```

---

## 4. 产能管理

### 4.1 产能计算

```python
# 有效产能 = 理论产能 × 综合效率

def calculate_effective_capacity(resource):
    """计算有效产能"""
    # 理论产能
    theoretical_capacity = (
        resource.working_hours_per_day *  # 8小时
        resource.working_days_per_week *  # 5天
        resource.quantity                 # 数量
    )
    
    # 综合效率 = 时间效率 × 性能效率 × 质量效率
    time_efficiency = 0.85   # 15%停机损失
    performance_efficiency = 0.90  # 10%速度损失
    quality_efficiency = 0.95      # 5%质量损失
    
    OEE = time_efficiency * performance_efficiency * quality_efficiency
    # OEE = 0.73 (73%)
    
    effective_capacity = theoretical_capacity * OEE
    
    return {
        'theoretical': theoretical_capacity,
        'effective': effective_capacity,
        'OEE': OEE
    }
```

**示例**:
```
激光切割机:
├─ 理论产能: 160h/周
├─ 时间效率: 85% (计划停机/故障)
├─ 性能效率: 90% (速度损失)
├─ 质量效率: 95% (返工)
├─ OEE: 73%
└─ 有效产能: 117h/周

建议:
1. 减少计划外停机 → 时间效率提升至90%
2. 优化切割参数 → 性能效率提升至95%
3. 提升首件合格率 → 质量效率提升至98%
目标OEE: 84% (+11%)
```

### 4.2 产能平衡

**瓶颈识别**:
```
工序产能分析:
工序      产能    需求    利用率  状态
切割      120h    118h    98%    🔴 瓶颈
焊接      160h    110h    69%    🟢 富裕
组装      180h    115h    64%    🟢 富裕
测试      140h     95h    68%    🟢 富裕

问题: 切割是瓶颈(利用率98%)
```

**解决方案**:
1. **增加资源**: 购置第2台切割机
2. **延长工时**: 切割机加班2h/天
3. **外协加工**: 20%工作量外包
4. **工艺优化**: 提升切割速度10%

**效果对比**:
| 方案 | 投资 | 产能提升 | ROI |
|------|------|---------|-----|
| 增加设备 | 50万 | 100% | 18个月 |
| 延长工时 | 0.5万/月 | 25% | 立即见效 |
| 外协加工 | 2万/月 | 20% | 灵活调整 |
| 工艺优化 | 5万 | 10% | 6个月 |

**推荐**: 短期外协+长期增设备

---

## 5. 变更管理

### 5.1 插单处理

**紧急插单流程**:
```
接到紧急订单
    ↓
评估影响 (AI模拟)
    ↓
方案对比
├─ 方案A: 延后3个低优先级订单
├─ 方案B: 周六加班2小时
└─ 方案C: 外协部分工序
    ↓
选择最优方案
    ↓
通知受影响方
    ↓
调整排程
```

**评估模板**:
```python
def evaluate_urgent_order(order):
    """评估紧急订单影响"""
    impact = {
        'delayed_orders': [],
        'extra_cost': 0,
        'delivery_risk': 'LOW'
    }
    
    # 模拟插单
    new_schedule = simulate_insert(order)
    
    # 分析影响
    for wo in new_schedule:
        if wo.new_completion > wo.original_completion:
            impact['delayed_orders'].append(wo)
            if wo.deadline < wo.new_completion:
                impact['delivery_risk'] = 'HIGH'
    
    # 计算额外成本
    if need_overtime:
        impact['extra_cost'] += overtime_cost
    
    return impact
```

### 5.2 异常调整

**异常类型**:
1. **设备故障**: 转移工单到备用设备
2. **物料短缺**: 调整工单顺序
3. **人员缺勤**: 延后或重新分配
4. **质量问题**: 插入返工单

**调整原则**:
- 最小化影响范围
- 优先保证高优先级订单
- 及时通知相关方
- 记录变更原因

---

## 6. 绩效评估

### 6.1 排程指标

**核心KPI**:
```
1. 计划准确率
   = 实际执行的工单数 / 计划工单数
   目标: ≥90%

2. 准时完工率
   = 按时完成的工单数 / 总完成工单数
   目标: ≥85%

3. 产能利用率
   = 实际使用工时 / 可用工时
   目标: 75-85% (过高/过低都不好)

4. 排程变更率
   = 排程变更次数 / 总排程次数
   目标: ≤10%

5. 负荷均衡度
   = 1 - (资源利用率方差 / 平均利用率)
   目标: ≥0.8
```

### 6.2 持续改进

**PDCA循环**:
```
Plan (计划)
├─ 分析上周排程问题
├─ 识别改进机会
└─ 制定优化方案

Do (执行)
├─ 实施新排程策略
└─ 收集数据

Check (检查)
├─ 对比关键指标
└─ 评估改善效果

Act (行动)
├─ 固化有效经验
└─ 持续优化流程
```

**案例**:
```
问题: 周三产能利用率低(60%)

分析:
- 周一周二订单集中
- 周三周四订单较少
- 周五加班赶工

改进:
- 实施滚动排程
- 将部分周一订单移至周三
- 平衡每日负荷

结果:
- 周三利用率提升至75%
- 周五加班减少50%
- 准时率提升5%
```

---

## 7. 工具与技术

### 7.1 甘特图使用技巧

**颜色管理**:
```
🟢 绿色: 正常进行
🟡 黄色: 轻微延迟(<4小时)
🔴 红色: 严重延迟(>4小时)
⚪ 灰色: 未开始
🔵 蓝色: 已完成
```

**视图切换**:
- 日视图: 精细调整
- 周视图: 全局把控
- 月视图: 长期规划

### 7.2 快捷操作

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| 拖拽调整 | 鼠标拖动 | 调整工单时间 |
| 批量选择 | Shift+点击 | 选择多个工单 |
| 复制排程 | Ctrl+C/V | 复用成功方案 |
| 保存快照 | Ctrl+S | 保存当前版本 |

### 7.3 模板应用

**创建排程模板**:
```
标准5日排程模板:
├─ 周一: 启动新批次
├─ 周二-周四: 正常生产
├─ 周五: 收尾+清理
└─ 预留15%缓冲时间

适用: 重复性订单，相似工序
优势: 快速创建排程,减少变更
```

---

## 8. 常见误区

### 8.1 误区1: 追求100%利用率

**错误做法**: 将所有资源排满，不留缓冲

**后果**:
- 任何异常都导致延期
- 无法应对插单
- 工人疲劳，质量下降

**正确做法**: 保持75-85%利用率，预留缓冲

### 8.2 误区2: 只看交期不看能力

**错误做法**: 承诺交期时不评估产能

**后果**:
- 产能不足，必然延期
- 加班频繁，成本上升

**正确做法**: 排程前先做产能评估

### 8.3 误区3: 频繁变更排程

**错误做法**: 每个插单都打乱排程

**后果**:
- 工人无所适从
- 物料准备混乱
- 效率大幅下降

**正确做法**: 固定排程期+滚动排程期

---

## 9. 成功案例

### 案例1: 产能提升20%

**背景**: 
某车间月产能1200台，无法满足1500台需求

**分析**:
- 瓶颈: 组装工序利用率98%
- 问题: 换型时间长，批量过大

**改进措施**:
1. 实施单件流，减少批量
2. 优化换型流程(30分钟→10分钟)
3. 增加1名组装工

**结果**:
- 月产能提升至1520台 (+26.7%)
- 在制品减少40%
- 交期缩短3天

### 案例2: 准时率从70%提升到90%

**背景**:
多品种小批量生产，交期准时率仅70%

**分析**:
- 排程混乱，频繁调整
- 物料准备不及时
- 缺乏优先级管理

**改进措施**:
1. 实施滚动排程(3+7+20)
2. 建立优先级矩阵
3. 物料提前3天备料
4. 使用AI智能排程

**结果**:
- 准时率提升至90%
- 排程变更率从30%降至8%
- 加班减少50%

---

## 10. 检查清单

### 每日检查
- [ ] 查看今日排程是否合理
- [ ] 确认物料齐套
- [ ] 检查设备状态
- [ ] 评估是否有延期风险

### 每周检查
- [ ] 分析本周完成情况
- [ ] 评估下周产能负荷
- [ ] 优化排程参数
- [ ] 更新标准工时

### 每月检查
- [ ] 统计关键指标
- [ ] 瓶颈分析
- [ ] 改进措施跟踪
- [ ] 模板更新

---

## 11. 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2026-02-16 | 初始版本 |

# çº¿ç´¢è¯„ä¼°ç®¡ç† - å‰åç«¯é›†æˆè®¡åˆ’

## æ‰§è¡Œæ—¥æœŸ: 2026-01-13

## æ¦‚è¿°

å…¨é¢å¯ç”¨çº¿ç´¢è¯„ä¼°åŠŸèƒ½ï¼ˆLead Assessment Managementï¼‰ï¼Œå°†å‰ç«¯ç®€åŒ–çš„è¯„ä¼°ç³»ç»Ÿä¸åç«¯å®Œå–„çš„æŠ€æœ¯è¯„ä¼°ç³»ç»Ÿæ·±åº¦é›†æˆï¼Œå¹¶å¢åŠ å…¬å¸ä¼˜åŠ¿äº§å“é€‰æ‹©åŠŸèƒ½ã€‚

---

## ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“å‡†å¤‡ - å¯¼å…¥ä¼˜åŠ¿äº§å“æ•°æ®

### ç›®æ ‡
- å°†å·²å‘é€çš„ä¼˜åŠ¿äº§å“åˆ—è¡¨å¯¼å…¥æ•°æ®åº“
- åˆå§‹åŒ–äº§å“ç±»åˆ«å’Œäº§å“æ•°æ®

### ä»»åŠ¡æ¸…å•

#### 1.1 åˆ›å»ºä¼˜åŠ¿äº§å“æ•°æ®åº“è¡¨ï¼ˆå·²å®Œæˆâœ“ï¼‰
- [x] `advantage_product_categories` è¡¨å·²åˆ›å»º
- [x] `advantage_products` è¡¨å·²åˆ›å»º
- [x] è¡¨å…³ç³»å’Œç´¢å¼•å·²å»ºç«‹

#### 1.2 å¯¼å…¥äº§å“æ•°æ®
**æ–¹å¼1: ä½¿ç”¨ç°æœ‰çš„ Excel å¯¼å…¥åŠŸèƒ½**
```bash
# åç«¯å·²æä¾› Excel å¯¼å…¥ API
POST /api/v1/advantage-products/import
```

**æ–¹å¼2: ä½¿ç”¨ SQL è„šæœ¬å¯¼å…¥**
```sql
-- åˆ›å»ºè¿ç§»è„šæœ¬: migrations/20260113_import_advantage_products.sql

-- 1. åˆå§‹åŒ–ç±»åˆ«ï¼ˆä½¿ç”¨ DEFAULT_CATEGORIESï¼‰
INSERT INTO advantage_product_categories (code, name, description, sort_order, is_active) VALUES
('HOME_APPLIANCE', 'ç™½è‰²å®¶ç”µ', 'å®¶ç”¨ç”µå™¨æµ‹è¯•è®¾å¤‡', 1, 1),
('AUTOMOTIVE', 'æ±½è½¦ç”µå­', 'æ±½è½¦ç”µå­æµ‹è¯•ç³»ç»Ÿ', 2, 1),
('NEW_ENERGY', 'æ–°èƒ½æº', 'æ–°èƒ½æºç”µæ± æµ‹è¯•è®¾å¤‡', 3, 1),
('SEMICONDUCTOR', 'åŠå¯¼ä½“', 'åŠå¯¼ä½“æµ‹è¯•ä¸è€åŒ–è®¾å¤‡', 4, 1),
('POWER_TOOL', 'ç”µåŠ¨å·¥å…·', 'ç”µåŠ¨å·¥å…·æµ‹è¯•ç³»ç»Ÿ', 5, 1),
('AUTOMATION_LINE', 'è‡ªåŠ¨åŒ–çº¿ä½“', 'è‡ªåŠ¨åŒ–ç”Ÿäº§çº¿ä½“', 6, 1),
('OTHER_EQUIPMENT', 'å…¶ä»–è®¾å¤‡', 'å…¶ä»–æµ‹è¯•è®¾å¤‡', 7, 1),
('EDUCATION', 'æ•™è‚²å®è®­', 'æ•™è‚²å®è®­è®¾å¤‡', 8, 1);

-- 2. å¯¼å…¥ä¼˜åŠ¿äº§å“æ•°æ®
-- ç™½è‰²å®¶ç”µ (KC2700 ç³»åˆ—)
INSERT INTO advantage_products (product_code, product_name, category_id, series_code, is_active) VALUES
('KC2701', 'ç¦»çº¿åŒå·¥ä½FCT', 1, 'KC2700', 1),
('KC2702', 'ç¦»çº¿æ˜¾ç¤ºåŒå·¥ä½FCT', 1, 'KC2700', 1),
('KC2703', 'ç¦»çº¿åŒå·¥ä½FCT+3D SPI', 1, 'KC2700', 1),
-- ... æ›´å¤šäº§å“

-- æ±½è½¦ç”µå­ (KC2100 ç³»åˆ—)
-- æ–°èƒ½æº (KC2900 ç³»åˆ—)
-- åŠå¯¼ä½“ (KC3100 ç³»åˆ—)
-- ... å…¶ä»–ç±»åˆ«
```

**è¾“å‡º**:
- 8ä¸ªäº§å“ç±»åˆ«
- çº¦100+ä¸ªä¼˜åŠ¿äº§å“è®°å½•

---

## ç¬¬äºŒé˜¶æ®µï¼šåç«¯é›†æˆ - å¢å¼º Lead æ¨¡å‹

### ç›®æ ‡
- ä¸º Lead è¡¨å¢åŠ ä¼˜åŠ¿äº§å“é€‰æ‹©å­—æ®µ
- å…³è”ä¼˜åŠ¿äº§å“æ•°æ®ï¼Œæ”¯æŒäº§å“åŒ¹é…æ£€æŸ¥

### ä»»åŠ¡æ¸…å•

#### 2.1 ä¿®æ”¹ Lead æ•°æ®æ¨¡å‹
**æ–‡ä»¶**: `/app/models/sales.py`

```python
class Lead(Base, TimestampMixin):
    # ... ç°æœ‰å­—æ®µ

    # æ–°å¢å­—æ®µ
    selected_advantage_products = Column(Text, comment="é€‰æ‹©çš„ä¼˜åŠ¿äº§å“åˆ—è¡¨(JSON Array)")
    product_match_type = Column(String(20), comment="äº§å“åŒ¹é…ç±»å‹: ADVANTAGE/NEW/UNKNOWN")
    is_advantage_product = Column(Boolean, default=False, comment="æ˜¯å¦ä¼˜åŠ¿äº§å“")
```

**è¿ç§»è„šæœ¬**: `migrations/20260113_add_advantage_product_to_lead_sqlite.sql`
```sql
-- ä¸º Lead è¡¨æ·»åŠ ä¼˜åŠ¿äº§å“å­—æ®µ
ALTER TABLE leads ADD COLUMN selected_advantage_products TEXT;
ALTER TABLE leads ADD COLUMN product_match_type VARCHAR(20) DEFAULT 'UNKNOWN';
ALTER TABLE leads ADD COLUMN is_advantage_product BOOLEAN DEFAULT 0;

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_lead_advantage_product ON leads(is_advantage_product);
CREATE INDEX idx_lead_product_match_type ON leads(product_match_type);
```

#### 2.2 æ›´æ–° Lead Schema
**æ–‡ä»¶**: `/app/schemas/sales.py`

```python
class LeadCreate(BaseModel):
    # ... ç°æœ‰å­—æ®µ
    selected_advantage_products: Optional[List[int]] = Field(
        default=None,
        description="é€‰æ‹©çš„ä¼˜åŠ¿äº§å“IDåˆ—è¡¨"
    )

class LeadResponse(TimestampSchema):
    # ... ç°æœ‰å­—æ®µ
    selected_advantage_products: Optional[str] = None
    product_match_type: Optional[str] = None
    is_advantage_product: bool = False
    # æ‰©å±•å­—æ®µ
    advantage_products: Optional[List[AdvantageProductSimple]] = None
```

#### 2.3 å¢å¼º Lead API ç«¯ç‚¹
**æ–‡ä»¶**: `/app/api/v1/endpoints/sales/leads.py`

**åŠŸèƒ½å¢å¼º**:
1. **åˆ›å»ºçº¿ç´¢æ—¶è‡ªåŠ¨æ£€æŸ¥äº§å“åŒ¹é…**
```python
@router.post("", response_model=LeadResponse)
def create_lead(...):
    # 1. åˆ›å»ºçº¿ç´¢
    lead = Lead(**lead_in.model_dump())

    # 2. å¦‚æœé€‰æ‹©äº†ä¼˜åŠ¿äº§å“ï¼Œä¿å­˜å¹¶æ ‡è®°
    if lead_in.selected_advantage_products:
        lead.selected_advantage_products = json.dumps(lead_in.selected_advantage_products)
        lead.is_advantage_product = True
        lead.product_match_type = "ADVANTAGE"

    # 3. å¦‚æœæ²¡æœ‰é€‰æ‹©ï¼Œå°è¯•ä»éœ€æ±‚æ‘˜è¦ä¸­åŒ¹é…
    elif lead_in.demand_summary:
        match_result = check_product_match(lead_in.demand_summary, db)
        lead.product_match_type = match_result["match_type"]
        lead.is_advantage_product = (match_result["match_type"] == "ADVANTAGE")

    db.add(lead)
    db.commit()
```

2. **è·å–çº¿ç´¢æ—¶è¿”å›ä¼˜åŠ¿äº§å“è¯¦æƒ…**
```python
@router.get("/{lead_id}", response_model=LeadResponse)
def get_lead(...):
    lead = db.query(Lead).filter(...).first()

    # æ„é€ å“åº”ï¼Œé™„åŠ ä¼˜åŠ¿äº§å“è¯¦æƒ…
    response = LeadResponse.from_orm(lead)

    if lead.selected_advantage_products:
        product_ids = json.loads(lead.selected_advantage_products)
        products = db.query(AdvantageProduct).filter(
            AdvantageProduct.id.in_(product_ids)
        ).all()
        response.advantage_products = [
            AdvantageProductSimple(...) for p in products
        ]

    return response
```

---

## ç¬¬ä¸‰é˜¶æ®µï¼šåç«¯é›†æˆ - åˆ›å»ºæŠ€æœ¯è¯„ä¼°æœåŠ¡å±‚

### ç›®æ ‡
- å°è£…æŠ€æœ¯è¯„ä¼°ä¸šåŠ¡é€»è¾‘
- æä¾›ç»Ÿä¸€çš„è¯„ä¼°æœåŠ¡æ¥å£

### ä»»åŠ¡æ¸…å•

#### 3.1 åˆ›å»ºæŠ€æœ¯è¯„ä¼°æœåŠ¡
**æ–‡ä»¶**: `/app/services/technical_assessment_service.py` (æ–°å»º)

```python
"""
æŠ€æœ¯è¯„ä¼°æœåŠ¡å±‚

æä¾›ç»Ÿä¸€çš„æŠ€æœ¯è¯„ä¼°ä¸šåŠ¡é€»è¾‘
"""
from typing import Dict, Any, List, Optional
from sqlalchemy.orm import Session

class TechnicalAssessmentService:
    """æŠ€æœ¯è¯„ä¼°æœåŠ¡"""

    def __init__(self, db: Session):
        self.db = db

    def create_assessment_from_lead_data(
        self,
        lead_id: int,
        assessment_data: Dict[str, Any],
        evaluator_id: int
    ) -> TechnicalAssessment:
        """
        ä»çº¿ç´¢è¯„ä¼°æ•°æ®åˆ›å»ºæŠ€æœ¯è¯„ä¼°è®°å½•

        Args:
            lead_id: çº¿ç´¢ID
            assessment_data: å‰ç«¯æäº¤çš„è¯„ä¼°æ•°æ®
                {
                    "dimensions": {
                        "demandClarity": 4,
                        "budget": 3,
                        "authority": 5,
                        "timeline": 4,
                        "productFit": 5
                    },
                    "totalScore": 85,
                    "grade": "A"
                }
            evaluator_id: è¯„ä¼°äººID

        Returns:
            TechnicalAssessment: æŠ€æœ¯è¯„ä¼°è®°å½•
        """
        # 1. è·å–æ´»è·ƒçš„è¯„åˆ†è§„åˆ™
        scoring_rule = self._get_active_scoring_rule()

        # 2. è½¬æ¢å‰ç«¯è¯„ä¼°æ•°æ®ä¸ºåç«¯æ ¼å¼
        dimension_scores = self._convert_dimensions(
            assessment_data["dimensions"],
            scoring_rule
        )

        # 3. æ£€æŸ¥ä¸€ç¥¨å¦å†³è§„åˆ™
        veto_check = self._check_veto_rules(dimension_scores, scoring_rule)

        # 4. æŸ¥æ‰¾ç›¸ä¼¼å¤±è´¥æ¡ˆä¾‹
        similar_cases = self._find_similar_failure_cases(lead_id)

        # 5. ç”Ÿæˆå†³ç­–å»ºè®®
        decision = self._generate_decision(
            assessment_data["totalScore"],
            veto_check["veto_triggered"],
            similar_cases
        )

        # 6. è¯†åˆ«é£é™©
        risks = self._identify_risks(dimension_scores, similar_cases)

        # 7. åˆ›å»ºæŠ€æœ¯è¯„ä¼°è®°å½•
        assessment = TechnicalAssessment(
            source_type="LEAD",
            source_id=lead_id,
            evaluator_id=evaluator_id,
            status="COMPLETED",
            total_score=assessment_data["totalScore"],
            dimension_scores=json.dumps(dimension_scores),
            veto_triggered=veto_check["veto_triggered"],
            veto_rules=json.dumps(veto_check["veto_rules"]) if veto_check["veto_triggered"] else None,
            decision=decision,
            risks=json.dumps(risks),
            similar_cases=json.dumps(similar_cases),
            evaluated_at=datetime.utcnow()
        )

        self.db.add(assessment)
        self.db.flush()

        # 8. æ›´æ–°çº¿ç´¢çš„è¯„ä¼°çŠ¶æ€
        lead = self.db.query(Lead).filter(Lead.id == lead_id).first()
        lead.assessment_id = assessment.id
        lead.assessment_status = "COMPLETED"
        lead.status = self._map_status_from_decision(decision)

        return assessment

    def _get_active_scoring_rule(self) -> Optional[ScoringRule]:
        """è·å–æ´»è·ƒçš„è¯„åˆ†è§„åˆ™"""
        return self.db.query(ScoringRule).filter(
            ScoringRule.is_active == True
        ).first()

    def _convert_dimensions(
        self,
        dimensions: Dict[str, int],
        scoring_rule: Optional[ScoringRule]
    ) -> Dict[str, Any]:
        """
        è½¬æ¢è¯„ä¼°ç»´åº¦

        å‰ç«¯: { "demandClarity": 4, "budget": 3, ... }
        åç«¯: { "demand_clarity": { "score": 4, "weight": 0.3, "weighted_score": 1.2 }, ... }
        """
        # é»˜è®¤æƒé‡ï¼ˆå¦‚æœæ²¡æœ‰è¯„åˆ†è§„åˆ™ï¼‰
        default_weights = {
            "demand_clarity": 0.30,
            "budget": 0.25,
            "authority": 0.20,
            "timeline": 0.15,
            "product_fit": 0.10
        }

        # ä½¿ç”¨è¯„åˆ†è§„åˆ™çš„æƒé‡ï¼ˆå¦‚æœæœ‰ï¼‰
        weights = default_weights
        if scoring_rule and scoring_rule.rules_json:
            rules = json.loads(scoring_rule.rules_json)
            weights = rules.get("weights", default_weights)

        # è½¬æ¢å­—æ®µåæ˜ å°„
        field_mapping = {
            "demandClarity": "demand_clarity",
            "budget": "budget",
            "authority": "authority",
            "timeline": "timeline",
            "productFit": "product_fit"
        }

        result = {}
        for frontend_key, backend_key in field_mapping.items():
            score = dimensions.get(frontend_key, 0)
            weight = weights.get(backend_key, 0)
            result[backend_key] = {
                "score": score,
                "weight": weight,
                "weighted_score": score * weight * 20  # è½¬æ¢ä¸º100åˆ†åˆ¶
            }

        return result

    def _check_veto_rules(
        self,
        dimension_scores: Dict[str, Any],
        scoring_rule: Optional[ScoringRule]
    ) -> Dict[str, Any]:
        """æ£€æŸ¥ä¸€ç¥¨å¦å†³è§„åˆ™"""
        veto_triggered = False
        veto_rules = []

        # é»˜è®¤ä¸€ç¥¨å¦å†³è§„åˆ™
        default_veto_rules = [
            {"dimension": "demand_clarity", "threshold": 2, "reason": "éœ€æ±‚ä¸æ˜ç¡®ï¼Œæ— æ³•æŠ¥ä»·"},
            {"dimension": "budget", "threshold": 2, "reason": "é¢„ç®—ä¸¥é‡ä¸è¶³"},
        ]

        rules = default_veto_rules
        if scoring_rule and scoring_rule.rules_json:
            rule_config = json.loads(scoring_rule.rules_json)
            rules = rule_config.get("veto_rules", default_veto_rules)

        for rule in rules:
            dimension = rule["dimension"]
            threshold = rule["threshold"]
            if dimension in dimension_scores:
                score = dimension_scores[dimension]["score"]
                if score <= threshold:
                    veto_triggered = True
                    veto_rules.append({
                        "dimension": dimension,
                        "score": score,
                        "threshold": threshold,
                        "reason": rule["reason"]
                    })

        return {
            "veto_triggered": veto_triggered,
            "veto_rules": veto_rules
        }

    def _find_similar_failure_cases(self, lead_id: int) -> List[Dict[str, Any]]:
        """æŸ¥æ‰¾ç›¸ä¼¼å¤±è´¥æ¡ˆä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
        # TODO: å®ç°å¤æ‚çš„ç›¸ä¼¼åº¦åŒ¹é…ç®—æ³•
        return []

    def _generate_decision(
        self,
        total_score: int,
        veto_triggered: bool,
        similar_cases: List[Dict[str, Any]]
    ) -> str:
        """
        ç”Ÿæˆå†³ç­–å»ºè®®

        Returns:
            "RECOMMEND" | "CONDITIONAL" | "DEFER" | "NOT_RECOMMEND"
        """
        if veto_triggered:
            return "NOT_RECOMMEND"

        if total_score >= 80:
            return "RECOMMEND"
        elif total_score >= 60:
            return "CONDITIONAL"
        elif total_score >= 40:
            return "DEFER"
        else:
            return "NOT_RECOMMEND"

    def _identify_risks(
        self,
        dimension_scores: Dict[str, Any],
        similar_cases: List[Dict[str, Any]]
    ) -> List[Dict[str, str]]:
        """è¯†åˆ«é£é™©"""
        risks = []

        # åŸºäºç»´åº¦åˆ†æ•°è¯†åˆ«é£é™©
        for dimension, data in dimension_scores.items():
            score = data["score"]
            if score <= 2:
                risks.append({
                    "level": "HIGH",
                    "dimension": dimension,
                    "description": f"{dimension} è¯„åˆ†è¿‡ä½ ({score}/5)"
                })
            elif score == 3:
                risks.append({
                    "level": "MEDIUM",
                    "dimension": dimension,
                    "description": f"{dimension} è¯„åˆ†ä¸€èˆ¬ ({score}/5)"
                })

        return risks

    def _map_status_from_decision(self, decision: str) -> str:
        """ä»å†³ç­–æ˜ å°„çº¿ç´¢çŠ¶æ€"""
        mapping = {
            "RECOMMEND": "QUALIFIED",
            "CONDITIONAL": "QUALIFIED",
            "DEFER": "EVALUATING",
            "NOT_RECOMMEND": "LOST"
        }
        return mapping.get(decision, "EVALUATING")
```

#### 3.2 ä¿®æ”¹æŠ€æœ¯è¯„ä¼° API ç«¯ç‚¹
**æ–‡ä»¶**: `/app/api/v1/endpoints/sales/assessments.py`

```python
from app.services.technical_assessment_service import TechnicalAssessmentService

@router.post("/leads/{lead_id}/assessments", response_model=TechnicalAssessmentResponse)
def create_lead_assessment(
    lead_id: int,
    assessment_data: Dict[str, Any],
    db: Session = Depends(deps.get_db),
    current_user: User = Depends(security.get_current_user)
):
    """
    ä¸ºçº¿ç´¢åˆ›å»ºæŠ€æœ¯è¯„ä¼°

    æ¥æ”¶å‰ç«¯è¯„ä¼°æ•°æ®ï¼Œè½¬æ¢ä¸ºæŠ€æœ¯è¯„ä¼°è®°å½•
    """
    # éªŒè¯çº¿ç´¢å­˜åœ¨
    lead = db.query(Lead).filter(Lead.id == lead_id).first()
    if not lead:
        raise HTTPException(status_code=404, detail="çº¿ç´¢ä¸å­˜åœ¨")

    # è°ƒç”¨æœåŠ¡å±‚åˆ›å»ºè¯„ä¼°
    service = TechnicalAssessmentService(db)
    assessment = service.create_assessment_from_lead_data(
        lead_id=lead_id,
        assessment_data=assessment_data,
        evaluator_id=current_user.id
    )

    db.commit()
    db.refresh(assessment)

    return assessment
```

---

## ç¬¬å››é˜¶æ®µï¼šå‰ç«¯é›†æˆ - LeadAssessment è°ƒç”¨æŠ€æœ¯è¯„ä¼° API

### ç›®æ ‡
- ä¿®æ”¹å‰ç«¯è¯„ä¼°è¡¨å•ï¼Œè°ƒç”¨æ–°çš„æŠ€æœ¯è¯„ä¼° API
- å±•ç¤ºæŠ€æœ¯è¯„ä¼°ç»“æœï¼ˆå†³ç­–å»ºè®®ã€é£é™©ã€ç›¸ä¼¼æ¡ˆä¾‹ï¼‰

### ä»»åŠ¡æ¸…å•

#### 4.1 åˆ›å»ºæŠ€æœ¯è¯„ä¼° API å®¢æˆ·ç«¯
**æ–‡ä»¶**: `/frontend/src/services/api.js`

```javascript
// æŠ€æœ¯è¯„ä¼° API
export const assessmentApi = {
  // ä¸ºçº¿ç´¢åˆ›å»ºæŠ€æœ¯è¯„ä¼°
  createLeadAssessment: (leadId, assessmentData) =>
    apiClient.post(`/sales/leads/${leadId}/assessments`, assessmentData),

  // è·å–çº¿ç´¢çš„æŠ€æœ¯è¯„ä¼°
  getLeadAssessment: (leadId) =>
    apiClient.get(`/sales/leads/${leadId}/assessments`),

  // è·å–è¯„åˆ†è§„åˆ™
  getScoringRules: () =>
    apiClient.get('/sales/scoring-rules'),

  // è·å–å¤±è´¥æ¡ˆä¾‹
  getFailureCases: (params) =>
    apiClient.get('/sales/failure-cases', { params }),
};
```

#### 4.2 ä¿®æ”¹ LeadAssessment ç»„ä»¶
**æ–‡ä»¶**: `/frontend/src/pages/LeadAssessment.jsx`

**ä¸»è¦ä¿®æ”¹ç‚¹**:

1. **æäº¤è¯„ä¼°æ—¶è°ƒç”¨æ–° API**
```javascript
// åŸä»£ç ï¼ˆç¬¬1195è¡Œï¼‰
await leadApi.update(selectedLead.id, {
  demand_summary: JSON.stringify(assessmentData),
  status: "EVALUATED",
});

// ä¿®æ”¹ä¸º
const response = await assessmentApi.createLeadAssessment(
  selectedLead.id,
  assessmentData
);

// æ›´æ–°çº¿ç´¢çŠ¶æ€
await loadLeads();
```

2. **å±•ç¤ºæŠ€æœ¯è¯„ä¼°ç»“æœ**
```javascript
// æ–°å¢çŠ¶æ€
const [assessmentResult, setAssessmentResult] = useState(null);

// è¯„ä¼°æˆåŠŸåæ˜¾ç¤ºç»“æœ
if (response.data) {
  setAssessmentResult(response.data);
  // æ˜¾ç¤ºå†³ç­–å»ºè®®ã€é£é™©ã€ç›¸ä¼¼æ¡ˆä¾‹
}
```

3. **è¯„ä¼°ç»“æœå±•ç¤ºç»„ä»¶**
```jsx
function AssessmentResultDialog({ result, onClose }) {
  return (
    <Dialog open={!!result} onClose={onClose}>
      <div className="p-6 space-y-4">
        {/* å†³ç­–å»ºè®® */}
        <div>
          <h3>å†³ç­–å»ºè®®</h3>
          <DecisionBadge decision={result.decision} />
        </div>

        {/* ä¸€ç¥¨å¦å†³ */}
        {result.veto_triggered && (
          <Alert variant="error">
            <AlertTitle>ä¸€ç¥¨å¦å†³</AlertTitle>
            {result.veto_rules.map(rule => (
              <p key={rule.dimension}>{rule.reason}</p>
            ))}
          </Alert>
        )}

        {/* é£é™©åˆ—è¡¨ */}
        {result.risks?.length > 0 && (
          <div>
            <h4>è¯†åˆ«çš„é£é™©</h4>
            <ul>
              {result.risks.map(risk => (
                <li key={risk.dimension}>
                  <RiskBadge level={risk.level} />
                  {risk.description}
                </li>
              ))}
            </ul>
          </div>
        )}

        {/* ç›¸ä¼¼å¤±è´¥æ¡ˆä¾‹ */}
        {result.similar_cases?.length > 0 && (
          <div>
            <h4>ç›¸ä¼¼å¤±è´¥æ¡ˆä¾‹</h4>
            <FailureCasesList cases={result.similar_cases} />
          </div>
        )}
      </div>
    </Dialog>
  );
}
```

---

## ç¬¬äº”é˜¶æ®µï¼šå‰ç«¯åŠŸèƒ½ - å¢åŠ ä¼˜åŠ¿äº§å“é€‰æ‹©ç»„ä»¶

### ç›®æ ‡
- åœ¨çº¿ç´¢åˆ›å»º/ç¼–è¾‘æ—¶ï¼Œå¢åŠ ä¼˜åŠ¿äº§å“é€‰æ‹©åŠŸèƒ½
- æ˜¾ç¤ºäº§å“åŒ¹é…çŠ¶æ€
- ä¼˜åŠ¿äº§å“ä½œä¸ºé‡è¦çš„è¯„ä¼°å› å­

### ä»»åŠ¡æ¸…å•

#### 5.1 ä¿®æ”¹çº¿ç´¢åˆ›å»ºå¯¹è¯æ¡†
**æ–‡ä»¶**: `/frontend/src/pages/LeadAssessment.jsx`

**åœ¨ CreateLeadDialog ä¸­å¢åŠ ä¼˜åŠ¿äº§å“é€‰æ‹©**:

```jsx
import { AdvantageProductSelect } from '../components/sales/AdvantageProducts';

function CreateLeadDialog({ open, onClose, onSuccess }) {
  // æ–°å¢çŠ¶æ€
  const [selectedAdvantageProducts, setSelectedAdvantageProducts] = useState([]);
  const [productMatchType, setProductMatchType] = useState('UNKNOWN');

  // äº§å“åŒ¹é…æ£€æŸ¥
  const checkProductMatch = async (productName) => {
    try {
      const response = await advantageProductApi.checkMatch({
        product_name: productName
      });
      setProductMatchType(response.data.match_type);

      // å¦‚æœç²¾ç¡®åŒ¹é…ï¼Œè‡ªåŠ¨é€‰æ‹©è¯¥äº§å“
      if (response.data.matched_product) {
        setSelectedAdvantageProducts([response.data.matched_product.id]);
      }
    } catch (err) {
      console.error('Product match check failed:', err);
    }
  };

  return (
    <Dialog open={open} onClose={onClose}>
      <form onSubmit={handleSubmit}>
        {/* ç°æœ‰å­—æ®µ */}
        <Input
          label="å®¢æˆ·åç§°"
          value={customerName}
          onChange={setCustomerName}
        />

        {/* éœ€æ±‚æ‘˜è¦ - å¢åŠ äº§å“åŒ¹é…æ£€æŸ¥ */}
        <Input
          label="éœ€æ±‚æ‘˜è¦"
          value={demandSummary}
          onChange={(value) => {
            setDemandSummary(value);
            // å½“ç”¨æˆ·è¾“å…¥éœ€æ±‚åï¼Œè‡ªåŠ¨æ£€æŸ¥äº§å“åŒ¹é…
            if (value.length > 10) {
              checkProductMatch(value);
            }
          }}
        />

        {/* äº§å“åŒ¹é…çŠ¶æ€æç¤º */}
        {productMatchType === 'ADVANTAGE' && (
          <Alert variant="success" className="mt-2">
            <CheckCircle className="w-4 h-4" />
            <span>æ£€æµ‹åˆ°ä¼˜åŠ¿äº§å“åŒ¹é…ï¼è¯·åœ¨ä¸‹æ–¹ç¡®è®¤é€‰æ‹©ã€‚</span>
          </Alert>
        )}
        {productMatchType === 'NEW' && (
          <Alert variant="info" className="mt-2">
            <Info className="w-4 h-4" />
            <span>è¿™ä¼¼ä¹æ˜¯æ–°äº§å“çº¿ç´¢ï¼ŒæœªåŒ¹é…åˆ°ä¼˜åŠ¿äº§å“ã€‚</span>
          </Alert>
        )}

        {/* ä¼˜åŠ¿äº§å“é€‰æ‹©ï¼ˆæ–°å¢ï¼‰ */}
        <div className="space-y-2">
          <label className="text-sm font-medium text-slate-300">
            ä¼˜åŠ¿äº§å“é€‰æ‹©ï¼ˆå¤šé€‰ï¼‰
            <span className="ml-2 text-xs text-primary-400">
              * é‡è¦ï¼šä¼˜åŠ¿äº§å“çš„ä¸­æ ‡ç‡æ›´é«˜
            </span>
          </label>

          <AdvantageProductMultiSelect
            value={selectedAdvantageProducts}
            onChange={setSelectedAdvantageProducts}
            placeholder="æœç´¢å¹¶é€‰æ‹©å…¬å¸ä¼˜åŠ¿äº§å“"
            showCategoryFilter={true}
          />

          {/* å·²é€‰äº§å“å±•ç¤º */}
          {selectedAdvantageProducts.length > 0 && (
            <div className="flex flex-wrap gap-2 mt-2">
              {selectedAdvantageProducts.map(productId => (
                <ProductTag
                  key={productId}
                  productId={productId}
                  onRemove={() => {
                    setSelectedAdvantageProducts(prev =>
                      prev.filter(id => id !== productId)
                    );
                  }}
                />
              ))}
            </div>
          )}
        </div>

        {/* æäº¤æ—¶åŒ…å«ä¼˜åŠ¿äº§å“æ•°æ® */}
        <Button type="submit">åˆ›å»ºçº¿ç´¢</Button>
      </form>
    </Dialog>
  );
}
```

#### 5.2 åˆ›å»ºä¼˜åŠ¿äº§å“å¤šé€‰ç»„ä»¶
**æ–‡ä»¶**: `/frontend/src/components/sales/AdvantageProductMultiSelect.jsx` (æ–°å»º)

```jsx
import { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Search, X, Package, Filter } from 'lucide-react';
import { advantageProductApi } from '../../services/api';
import { cn } from '../../lib/utils';

export default function AdvantageProductMultiSelect({
  value = [],
  onChange,
  placeholder = "æœç´¢äº§å“...",
  showCategoryFilter = true,
  maxHeight = "300px"
}) {
  const [isOpen, setIsOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');
  const [groupedData, setGroupedData] = useState([]);
  const [selectedCategory, setSelectedCategory] = useState(null);
  const [loading, setLoading] = useState(false);

  // åŠ è½½æ•°æ®
  useEffect(() => {
    if (isOpen && groupedData.length === 0) {
      loadProducts();
    }
  }, [isOpen]);

  const loadProducts = async () => {
    try {
      setLoading(true);
      const response = await advantageProductApi.getProductsGrouped();
      setGroupedData(response.data || []);
    } catch (err) {
      console.error('Failed to load products:', err);
    } finally {
      setLoading(false);
    }
  };

  // è¿‡æ»¤äº§å“
  const filteredProducts = groupedData
    .filter(group =>
      !selectedCategory || group.category.id === selectedCategory
    )
    .flatMap(group => group.products)
    .filter(product =>
      !searchTerm ||
      product.product_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      product.product_code.toLowerCase().includes(searchTerm.toLowerCase())
    );

  // åˆ‡æ¢é€‰æ‹©
  const toggleProduct = (productId) => {
    if (value.includes(productId)) {
      onChange(value.filter(id => id !== productId));
    } else {
      onChange([...value, productId]);
    }
  };

  // è·å–å·²é€‰äº§å“è¯¦æƒ…
  const selectedProducts = groupedData
    .flatMap(group => group.products)
    .filter(product => value.includes(product.id));

  return (
    <div className="space-y-2">
      {/* å·²é€‰äº§å“æ ‡ç­¾ */}
      {selectedProducts.length > 0 && (
        <div className="flex flex-wrap gap-2">
          {selectedProducts.map(product => (
            <motion.div
              key={product.id}
              initial={{ opacity: 0, scale: 0.8 }}
              animate={{ opacity: 1, scale: 1 }}
              className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-primary-500/10 border border-primary-500/20"
            >
              <span className="text-xs font-mono text-primary-400">
                {product.product_code}
              </span>
              <span className="text-sm text-white">
                {product.product_name}
              </span>
              <button
                type="button"
                onClick={() => toggleProduct(product.id)}
                className="p-0.5 hover:bg-primary-500/20 rounded"
              >
                <X className="w-3 h-3 text-primary-400" />
              </button>
            </motion.div>
          ))}
        </div>
      )}

      {/* æœç´¢æ¡† */}
      <div className="relative">
        <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500" />
        <input
          type="text"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          onFocus={() => setIsOpen(true)}
          placeholder={placeholder}
          className={cn(
            "w-full pl-10 pr-4 py-2 rounded-lg",
            "bg-surface-50 border border-white/10",
            "text-sm text-white placeholder:text-slate-500",
            "focus:outline-none focus:border-primary-500/50"
          )}
        />
      </div>

      {/* ä¸‹æ‹‰é€‰æ‹©é¢æ¿ */}
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
            className="relative z-50 p-3 rounded-lg bg-surface-100 border border-white/10 shadow-xl"
          >
            {/* ç±»åˆ«ç­›é€‰ */}
            {showCategoryFilter && (
              <div className="flex gap-2 mb-3 overflow-x-auto pb-2">
                <button
                  onClick={() => setSelectedCategory(null)}
                  className={cn(
                    "px-3 py-1 rounded-full text-xs whitespace-nowrap transition-colors",
                    !selectedCategory
                      ? "bg-primary-500 text-white"
                      : "bg-surface-50 text-slate-400 hover:text-white"
                  )}
                >
                  å…¨éƒ¨
                </button>
                {groupedData.map(group => (
                  <button
                    key={group.category.id}
                    onClick={() => setSelectedCategory(group.category.id)}
                    className={cn(
                      "px-3 py-1 rounded-full text-xs whitespace-nowrap transition-colors",
                      selectedCategory === group.category.id
                        ? "bg-primary-500 text-white"
                        : "bg-surface-50 text-slate-400 hover:text-white"
                    )}
                  >
                    {group.category.name}
                  </button>
                ))}
              </div>
            )}

            {/* äº§å“åˆ—è¡¨ */}
            <div className="space-y-1 overflow-y-auto" style={{ maxHeight }}>
              {filteredProducts.map(product => (
                <button
                  key={product.id}
                  type="button"
                  onClick={() => toggleProduct(product.id)}
                  className={cn(
                    "w-full flex items-center gap-3 p-2 rounded-lg text-left transition-colors",
                    value.includes(product.id)
                      ? "bg-primary-500/20 border border-primary-500/30"
                      : "bg-surface-50/50 hover:bg-surface-50 border border-transparent"
                  )}
                >
                  <div
                    className={cn(
                      "w-4 h-4 rounded border-2 flex items-center justify-center",
                      value.includes(product.id)
                        ? "border-primary-500 bg-primary-500"
                        : "border-slate-500"
                    )}
                  >
                    {value.includes(product.id) && (
                      <svg className="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                      </svg>
                    )}
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2">
                      <span className="text-xs font-mono text-slate-500">
                        {product.product_code}
                      </span>
                      <span className="text-sm text-white truncate">
                        {product.product_name}
                      </span>
                    </div>
                    <div className="text-xs text-slate-500">
                      {product.category_name}
                    </div>
                  </div>
                </button>
              ))}
            </div>

            {/* æ— ç»“æœ */}
            {filteredProducts.length === 0 && (
              <div className="text-center py-4 text-slate-500 text-sm">
                æœªæ‰¾åˆ°åŒ¹é…çš„äº§å“
              </div>
            )}
          </motion.div>
        )}
      </AnimatePresence>

      {/* ç‚¹å‡»å¤–éƒ¨å…³é—­ */}
      {isOpen && (
        <div
          className="fixed inset-0 z-40"
          onClick={() => setIsOpen(false)}
        />
      )}
    </div>
  );
}
```

#### 5.3 åœ¨è¯„ä¼°è¡¨å•ä¸­æ˜¾ç¤ºä¼˜åŠ¿äº§å“ä¿¡æ¯
**æ–‡ä»¶**: `/frontend/src/pages/LeadAssessment.jsx`

```jsx
// åœ¨è¯„ä¼°è¡¨å•ä¸­ï¼Œå¦‚æœçº¿ç´¢é€‰æ‹©äº†ä¼˜åŠ¿äº§å“ï¼Œç»™äºˆé¢å¤–æç¤º
function AssessmentDialog({ lead }) {
  return (
    <Dialog>
      {/* ä¼˜åŠ¿äº§å“æç¤º */}
      {lead.is_advantage_product && lead.advantage_products?.length > 0 && (
        <Alert variant="success" className="mb-4">
          <Star className="w-4 h-4" />
          <div>
            <AlertTitle>ä¼˜åŠ¿äº§å“çº¿ç´¢ ğŸ¯</AlertTitle>
            <div className="text-sm mt-1">
              è¯¥çº¿ç´¢æ¶‰åŠå…¬å¸ä¼˜åŠ¿äº§å“ï¼Œå»ºè®®é‡ç‚¹è·Ÿè¿›ï¼š
              <ul className="mt-2 space-y-1">
                {lead.advantage_products.map(product => (
                  <li key={product.id} className="flex items-center gap-2">
                    <span className="font-mono text-xs">{product.product_code}</span>
                    <span>{product.product_name}</span>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </Alert>
      )}

      {/* åŸæœ‰è¯„ä¼°è¡¨å• */}
      {/* ... */}
    </Dialog>
  );
}
```

---

## ç¬¬å…­é˜¶æ®µï¼šæ•°æ®è¿ç§» - è¿ç§»ç°æœ‰è¯„ä¼°æ•°æ®

### ç›®æ ‡
- å°†å·²å­˜å‚¨åœ¨ `demand_summary` ä¸­çš„è¯„ä¼°æ•°æ®è¿ç§»åˆ° `TechnicalAssessment` è¡¨

### ä»»åŠ¡æ¸…å•

#### 6.1 åˆ›å»ºæ•°æ®è¿ç§»è„šæœ¬
**æ–‡ä»¶**: `migrations/20260113_migrate_lead_assessment_data.py`

```python
"""
è¿ç§»ç°æœ‰çº¿ç´¢è¯„ä¼°æ•°æ®

å°†å­˜å‚¨åœ¨ lead.demand_summary ä¸­çš„è¯„ä¼°æ•°æ®è¿ç§»åˆ° technical_assessments è¡¨
"""
import json
from sqlalchemy.orm import Session
from app.models.base import get_db_session
from app.models.sales import Lead, TechnicalAssessment
from app.services.technical_assessment_service import TechnicalAssessmentService

def migrate_lead_assessment_data():
    """è¿ç§»çº¿ç´¢è¯„ä¼°æ•°æ®"""
    with get_db_session() as db:
        # æŸ¥æ‰¾æ‰€æœ‰æœ‰è¯„ä¼°æ•°æ®çš„çº¿ç´¢
        leads = db.query(Lead).filter(
            Lead.demand_summary.isnot(None),
            Lead.demand_summary != ''
        ).all()

        migrated_count = 0
        skipped_count = 0
        error_count = 0

        for lead in leads:
            try:
                # å°è¯•è§£æ demand_summary
                assessment_data = json.loads(lead.demand_summary)

                # æ£€æŸ¥æ˜¯å¦æ˜¯è¯„ä¼°æ•°æ®ï¼ˆåŒ…å« dimensions å’Œ totalScoreï¼‰
                if 'dimensions' not in assessment_data or 'totalScore' not in assessment_data:
                    skipped_count += 1
                    continue

                # æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰æŠ€æœ¯è¯„ä¼°è®°å½•
                existing = db.query(TechnicalAssessment).filter(
                    TechnicalAssessment.source_type == "LEAD",
                    TechnicalAssessment.source_id == lead.id
                ).first()

                if existing:
                    print(f"Lead {lead.id} already has assessment, skipping")
                    skipped_count += 1
                    continue

                # åˆ›å»ºæŠ€æœ¯è¯„ä¼°è®°å½•
                service = TechnicalAssessmentService(db)
                assessment = service.create_assessment_from_lead_data(
                    lead_id=lead.id,
                    assessment_data=assessment_data,
                    evaluator_id=lead.owner_id or 1  # é»˜è®¤è¯„ä¼°äºº
                )

                db.commit()
                migrated_count += 1
                print(f"Migrated assessment for Lead {lead.id}")

            except json.JSONDecodeError:
                # demand_summary ä¸æ˜¯ JSONï¼Œè·³è¿‡
                skipped_count += 1
            except Exception as e:
                print(f"Error migrating Lead {lead.id}: {str(e)}")
                error_count += 1
                db.rollback()

        print(f"\nMigration completed:")
        print(f"  Migrated: {migrated_count}")
        print(f"  Skipped: {skipped_count}")
        print(f"  Errors: {error_count}")

if __name__ == "__main__":
    migrate_lead_assessment_data()
```

**æ‰§è¡Œæ–¹å¼**:
```bash
cd /Users/flw/non-standard-automation-pm
python3 migrations/20260113_migrate_lead_assessment_data.py
```

---

## ç¬¬ä¸ƒé˜¶æ®µï¼šæµ‹è¯•éªŒè¯ - ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•

### ç›®æ ‡
- éªŒè¯å®Œæ•´çš„çº¿ç´¢è¯„ä¼°æµç¨‹
- ç¡®ä¿å‰åç«¯é›†æˆæ­£å¸¸å·¥ä½œ

### æµ‹è¯•æ¸…å•

#### 7.1 åç«¯ API æµ‹è¯•

**æµ‹è¯•1: ä¼˜åŠ¿äº§å“ API**
```bash
# è·å–äº§å“åˆ—è¡¨
curl -X GET "http://localhost:8000/api/v1/advantage-products/grouped" \
  -H "Authorization: Bearer $TOKEN"

# äº§å“åŒ¹é…æ£€æŸ¥
curl -X POST "http://localhost:8000/api/v1/advantage-products/check-match" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"product_name": "FCTæµ‹è¯•ç³»ç»Ÿ"}'
```

**æµ‹è¯•2: çº¿ç´¢åˆ›å»ºï¼ˆåŒ…å«ä¼˜åŠ¿äº§å“ï¼‰**
```bash
curl -X POST "http://localhost:8000/api/v1/sales/leads" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "customer_name": "æµ‹è¯•å®¢æˆ·",
    "demand_summary": "éœ€è¦FCTæµ‹è¯•è®¾å¤‡",
    "selected_advantage_products": [1, 2, 3],
    "owner_id": 1
  }'
```

**æµ‹è¯•3: æŠ€æœ¯è¯„ä¼°åˆ›å»º**
```bash
curl -X POST "http://localhost:8000/api/v1/sales/leads/1/assessments" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "dimensions": {
      "demandClarity": 4,
      "budget": 3,
      "authority": 5,
      "timeline": 4,
      "productFit": 5
    },
    "totalScore": 85,
    "grade": "A"
  }'
```

#### 7.2 å‰ç«¯åŠŸèƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯1: åˆ›å»ºçº¿ç´¢å¹¶é€‰æ‹©ä¼˜åŠ¿äº§å“**
1. æ‰“å¼€çº¿ç´¢è¯„ä¼°é¡µé¢
2. ç‚¹å‡»"æ–°å»ºçº¿ç´¢"
3. å¡«å†™å®¢æˆ·ä¿¡æ¯
4. åœ¨éœ€æ±‚æ‘˜è¦ä¸­è¾“å…¥äº§å“å…³é”®è¯
5. è§‚å¯Ÿäº§å“åŒ¹é…æç¤º
6. åœ¨ä¼˜åŠ¿äº§å“é€‰æ‹©å™¨ä¸­é€‰æ‹©äº§å“
7. æäº¤è¡¨å•
8. éªŒè¯çº¿ç´¢åˆ›å»ºæˆåŠŸï¼Œä¼˜åŠ¿äº§å“å·²å…³è”

**æµ‹è¯•åœºæ™¯2: è¿›è¡ŒæŠ€æœ¯è¯„ä¼°**
1. é€‰æ‹©ä¸€ä¸ªçº¿ç´¢
2. ç‚¹å‡»"è¯„ä¼°"æŒ‰é’®
3. å¡«å†™5ä¸ªç»´åº¦è¯„åˆ†
4. æäº¤è¯„ä¼°
5. è§‚å¯Ÿè¯„ä¼°ç»“æœå¯¹è¯æ¡†ï¼š
   - å†³ç­–å»ºè®®
   - é£é™©åˆ—è¡¨
   - ä¸€ç¥¨å¦å†³æç¤ºï¼ˆå¦‚æœæœ‰ï¼‰
6. éªŒè¯è¯„ä¼°æ•°æ®ä¿å­˜æˆåŠŸ

**æµ‹è¯•åœºæ™¯3: æŸ¥çœ‹è¯„ä¼°å†å²**
1. é€‰æ‹©å·²è¯„ä¼°çš„çº¿ç´¢
2. æŸ¥çœ‹çº¿ç´¢è¯¦æƒ…
3. éªŒè¯æŠ€æœ¯è¯„ä¼°è®°å½•æ˜¾ç¤ºæ­£ç¡®
4. éªŒè¯ä¼˜åŠ¿äº§å“ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®

#### 7.3 æ•°æ®å®Œæ•´æ€§éªŒè¯

**æ•°æ®åº“æ£€æŸ¥**:
```sql
-- æ£€æŸ¥çº¿ç´¢æ˜¯å¦æ­£ç¡®å…³è”ä¼˜åŠ¿äº§å“
SELECT
  l.id,
  l.customer_name,
  l.selected_advantage_products,
  l.is_advantage_product,
  l.product_match_type
FROM leads l
WHERE l.selected_advantage_products IS NOT NULL;

-- æ£€æŸ¥æŠ€æœ¯è¯„ä¼°è®°å½•
SELECT
  ta.id,
  ta.source_id AS lead_id,
  ta.total_score,
  ta.decision,
  ta.veto_triggered,
  ta.evaluated_at
FROM technical_assessments ta
WHERE ta.source_type = 'LEAD';

-- æ£€æŸ¥çº¿ç´¢ä¸æŠ€æœ¯è¯„ä¼°çš„å…³è”
SELECT
  l.id AS lead_id,
  l.customer_name,
  l.assessment_id,
  l.assessment_status,
  ta.decision,
  ta.total_score
FROM leads l
LEFT JOIN technical_assessments ta ON l.assessment_id = ta.id
WHERE l.assessment_id IS NOT NULL;
```

---

## å®æ–½æ—¶é—´è¡¨

| é˜¶æ®µ | é¢„è®¡å·¥ä½œé‡ | ä¾èµ–å…³ç³» |
|------|-----------|---------|
| ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“å‡†å¤‡ | 1-2å°æ—¶ | æ—  |
| ç¬¬äºŒé˜¶æ®µï¼šåç«¯ Lead æ¨¡å‹å¢å¼º | 2-3å°æ—¶ | ç¬¬ä¸€é˜¶æ®µ |
| ç¬¬ä¸‰é˜¶æ®µï¼šæŠ€æœ¯è¯„ä¼°æœåŠ¡å±‚ | 4-6å°æ—¶ | ç¬¬äºŒé˜¶æ®µ |
| ç¬¬å››é˜¶æ®µï¼šå‰ç«¯è¯„ä¼° API é›†æˆ | 3-4å°æ—¶ | ç¬¬ä¸‰é˜¶æ®µ |
| ç¬¬äº”é˜¶æ®µï¼šä¼˜åŠ¿äº§å“é€‰æ‹©ç»„ä»¶ | 4-5å°æ—¶ | ç¬¬ä¸€é˜¶æ®µ |
| ç¬¬å…­é˜¶æ®µï¼šæ•°æ®è¿ç§» | 1-2å°æ—¶ | ç¬¬ä¸‰é˜¶æ®µ |
| ç¬¬ä¸ƒé˜¶æ®µï¼šæµ‹è¯•éªŒè¯ | 2-3å°æ—¶ | å…¨éƒ¨å®Œæˆ |
| **æ€»è®¡** | **17-25å°æ—¶** | |

---

## é£é™©ä¸å¯¹ç­–

### é£é™©1: æ•°æ®è¿ç§»å¤±è´¥
**å¯¹ç­–**:
- åœ¨è¿ç§»å‰å¤‡ä»½æ•°æ®åº“
- å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è¿ç§»è„šæœ¬
- ä¿ç•™åŸ `demand_summary` å­—æ®µï¼Œä¸åˆ é™¤åŸæ•°æ®

### é£é™©2: å‰ç«¯ API è°ƒç”¨é”™è¯¯
**å¯¹ç­–**:
- å¢åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- æä¾›é™çº§æ–¹æ¡ˆï¼ˆAPI å¤±è´¥æ—¶ä½¿ç”¨æœ¬åœ°è¯„ä¼°ï¼‰
- å®Œå–„é”™è¯¯æç¤º

### é£é™©3: æ€§èƒ½é—®é¢˜
**å¯¹ç­–**:
- ä¼˜åŠ¿äº§å“åˆ—è¡¨ä½¿ç”¨ç¼“å­˜
- è¯„ä¼° API å¼‚æ­¥å¤„ç†
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆå·²æœ‰ç´¢å¼•ï¼‰

---

## æˆåŠŸæ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… ä¼˜åŠ¿äº§å“æ•°æ®å®Œæ•´å¯¼å…¥æ•°æ®åº“
- âœ… çº¿ç´¢åˆ›å»ºæ—¶å¯é€‰æ‹©ä¼˜åŠ¿äº§å“
- âœ… çº¿ç´¢è¯„ä¼°è°ƒç”¨æŠ€æœ¯è¯„ä¼° API
- âœ… è¯„ä¼°ç»“æœå±•ç¤ºå†³ç­–å»ºè®®å’Œé£é™©

### æ•°æ®ä¸€è‡´æ€§
- âœ… çº¿ç´¢ä¸ä¼˜åŠ¿äº§å“æ­£ç¡®å…³è”
- âœ… çº¿ç´¢ä¸æŠ€æœ¯è¯„ä¼°æ­£ç¡®å…³è”
- âœ… è¯„ä¼°æ•°æ®æ ¼å¼ç»Ÿä¸€

### ç”¨æˆ·ä½“éªŒ
- âœ… ä¼˜åŠ¿äº§å“é€‰æ‹©ä¾¿æ·ï¼ˆæœç´¢ã€åˆ†ç±»ç­›é€‰ï¼‰
- âœ… äº§å“åŒ¹é…è‡ªåŠ¨æç¤º
- âœ… è¯„ä¼°ç»“æœæ¸…æ™°æ˜“æ‡‚
- âœ… ç•Œé¢å“åº”æµç•…

### ç³»ç»Ÿç¨³å®šæ€§
- âœ… æ— æ•°æ®ä¸¢å¤±
- âœ… API å“åº”æ—¶é—´ < 2ç§’
- âœ… é”™è¯¯å¤„ç†å®Œå–„

---

## åç»­ä¼˜åŒ–æ–¹å‘

1. **è¯„åˆ†è§„åˆ™ç®¡ç†ç•Œé¢** - è®©ç®¡ç†å‘˜å¯é…ç½®è¯„åˆ†ç»´åº¦å’Œæƒé‡
2. **å¤±è´¥æ¡ˆä¾‹åº“å»ºè®¾** - ç§¯ç´¯å†å²å¤±è´¥æ¡ˆä¾‹ï¼Œå¢å¼ºé¢„è­¦èƒ½åŠ›
3. **AI è¾…åŠ©è¯„ä¼°** - æ¥å…¥ AI åˆ†æéœ€æ±‚æ–‡æœ¬ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯„ä¼°å»ºè®®
4. **ä¸­æ ‡ç‡é¢„æµ‹æ¨¡å‹** - åŸºäºå†å²æ•°æ®è®­ç»ƒé¢„æµ‹æ¨¡å‹
5. **è¯„ä¼°æµç¨‹ä¼˜åŒ–** - æ”¯æŒå¤šäººè¯„ä¼°ã€è¯„å®¡æµç¨‹

---

## é™„å½•

### A. ä¼˜åŠ¿äº§å“æ•°æ®ç»“æ„
```json
{
  "categories": [
    {
      "code": "HOME_APPLIANCE",
      "name": "ç™½è‰²å®¶ç”µ",
      "products": [
        {
          "product_code": "KC2701",
          "product_name": "ç¦»çº¿åŒå·¥ä½FCT",
          "series_code": "KC2700"
        }
      ]
    }
  ]
}
```

### B. æŠ€æœ¯è¯„ä¼°æ•°æ®ç»“æ„
```json
{
  "source_type": "LEAD",
  "source_id": 1,
  "total_score": 85,
  "dimension_scores": {
    "demand_clarity": {
      "score": 4,
      "weight": 0.3,
      "weighted_score": 24
    }
  },
  "decision": "RECOMMEND",
  "veto_triggered": false,
  "risks": [
    {
      "level": "MEDIUM",
      "dimension": "budget",
      "description": "é¢„ç®—è¯„åˆ†ä¸€èˆ¬ (3/5)"
    }
  ],
  "similar_cases": [],
  "ai_analysis": null
}
```

### C. API ç«¯ç‚¹æ¸…å•
```
# ä¼˜åŠ¿äº§å“
GET  /api/v1/advantage-products/grouped
GET  /api/v1/advantage-products/simple
POST /api/v1/advantage-products/check-match

# çº¿ç´¢ç®¡ç†
POST /api/v1/sales/leads
GET  /api/v1/sales/leads/{id}
PUT  /api/v1/sales/leads/{id}

# æŠ€æœ¯è¯„ä¼°
POST /api/v1/sales/leads/{id}/assessments
GET  /api/v1/sales/leads/{id}/assessments
GET  /api/v1/sales/scoring-rules
GET  /api/v1/sales/failure-cases
```

---

**è®¡åˆ’åˆ¶å®šäºº**: Claude Code
**åˆ¶å®šæ—¥æœŸ**: 2026-01-13
**ç‰ˆæœ¬**: v1.0

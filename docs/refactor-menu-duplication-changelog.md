# 菜单重复项清理与统一重构文档

## 概述

本次重构主要解决前端菜单栏的重复和冗余问题，实现了菜单配置的统一管理，提升了系统的可维护性。

**分支**: `claude/refactor-menu-duplication-l5vi8`

**提交记录**:
1. `refactor: 清理菜单栏重复项`
2. `refactor: 进一步清理菜单功能重复项`
3. `refactor: 整合功能相近的菜单项`
4. `feat: 将工作中心内容整合到统一工作台`
5. `refactor: 统一侧边栏菜单配置`

---

## 一、菜单重复项清理

### 1.1 第一轮清理

**删除的重复菜单项**:
| 菜单名称 | 原路径 | 处理方式 |
|---------|--------|----------|
| 商机看板 | /opportunities | 与"商机管理"重复，删除 |
| 到货跟踪 | /arrival-tracking | 与"收货管理"重复，删除 |
| 待发货/在途订单 | 状态筛选 | 作为筛选条件整合到发货管理页面 |

### 1.2 第二轮清理

**删除的重复/相似菜单项**:
| 菜单名称 | 处理方式 |
|---------|----------|
| CPQ配置器 | 与"模板与CPQ"重复，删除 |
| 线索评估 | 整合到"线索管理" |
| 优先级管理 | 整合到"线索管理" |
| 项目阶段视图 | 保留"项目阶段管理"，删除重复项 |
| 工程师绩效排名 | HR模块已有"绩效排名"，删除 |
| 物料齐套/齐套率看板/缺料预警 | 整合到"齐套分析" |
| 齐套检查/缺料管理看板 | 整合到"齐套分析" |
| 验收订单 | 整合到"验收管理" |

**重命名的菜单项**:
| 原名称 | 新名称 | 原因 |
|--------|--------|------|
| 客户管理（系统管理） | 客户数据维护 | 区分业务模块的客户管理 |
| 供应商管理（系统管理） | 供应商数据维护 | 区分采购模块的供应商管理 |

### 1.3 第三轮清理 - 功能整合

**整合的功能模块**:

| 被删除的菜单 | 整合到 | 说明 |
|-------------|--------|------|
| 工作中心 | 工作台 | 内容整合，不仅仅是重定向 |
| 8个销售分析子菜单 | 销售分析 | 区域/产品/客户/时间/团队/渠道/趋势/预测分析 |
| 风险预警 | 风险管理 | 预警作为风险管理的一部分 |
| 项目周报 | 进度报告 | 周报作为进度报告的一种形式 |
| 到货跟踪 | 收货管理 | 跟踪是收货管理的功能 |
| 服务记录 | 服务工单 | 记录整合到工单系统 |
| 部门管理 | 组织管理 | 部门是组织的一部分 |
| 3个研发成本子菜单 | 研发成本管理 | 预算/核算/分析整合 |

---

## 二、工作中心内容整合到统一工作台

### 2.1 问题背景

原"工作中心"菜单被删除后，仅做了URL重定向到"/dashboard"，但工作中心的特色内容（欢迎卡片、今日进度、工作状态）并未真正整合。

### 2.2 解决方案

创建 `WelcomeCard` 组件，将工作中心的核心功能整合到统一工作台。

**新增文件**: `frontend/src/pages/UnifiedDashboard/widgets/WelcomeCard.jsx`

**组件功能**:
- 渐变背景欢迎横幅
- 用户名和日期问候语
- 工作状态指示器（工作中/休息/离线）
- 今日工时统计（已工作时长/目标时长）
- 今日任务完成进度
- 今日进度条

### 2.3 配置更新

**widgetRegistry.js 新增**:
```javascript
'welcome-card': {
  component: WelcomeCard,
  category: 'common',
  defaultSize: 'full',
  description: '欢迎卡片（整合自工作中心）'
}
```

**roleWidgetConfig.js 更新**:
为所有 27 个角色配置添加 `welcome-card` 作为首个组件：
- 销售系统角色（5个）
- 项目管理角色（3个）
- 工程技术角色（5个）
- 采购角色（3个）
- 生产角色（4个）
- 客服角色（2个）
- 财务角色（2个）
- HR角色（2个）
- 高管角色（3个）
- 管理员角色（2个）
- 默认配置（1个）

---

## 三、侧边栏菜单配置统一

### 3.1 问题背景

原系统为每个角色维护独立的菜单配置文件，导致：
- 配置分散，难以维护
- 存在大量重复代码
- 菜单项不一致风险

### 3.2 解决方案

统一使用 `defaultNavGroups` 配置，通过 `permission` 字段控制菜单可见性。

### 3.3 删除的文件

| 文件 | 原用途 |
|------|--------|
| `sidebarConfig/production.js` | 生产角色菜单 |
| `sidebarConfig/procurement.js` | 采购角色菜单 |
| `sidebarConfig/pmo.js` | PMO角色菜单 |
| `sidebarConfig/sales.js` | 销售角色菜单 |
| `sidebarConfig/engineer.js` | 工程师角色菜单 |
| `sidebarConfig/finance.js` | 财务角色菜单 |
| `sidebarConfig/customerService.js` | 客服角色菜单 |

**共删除 789 行代码**

### 3.4 简化后的配置结构

```
sidebarConfig/
├── default.js      # 统一菜单配置（保留）
└── index.js        # 仅导出 defaultNavGroups
```

**sidebarConfig.js**:
```javascript
export { defaultNavGroups } from "./sidebarConfig/default";
```

### 3.5 菜单权限控制机制

```
用户登录
    ↓
加载 defaultNavGroups（统一菜单）
    ↓
NavGroup 组件渲染时检查 permission 字段
    ↓
├── 有权限 → 正常显示
└── 无权限 → 灰显 + 提示"需要XX权限"
```

---

## 四、路由重定向汇总

以下旧路由已重定向到 `/dashboard`：

| 旧路由 | 说明 |
|--------|------|
| `/workstation` | 原通用工作台 |
| `/work-center` | 原工作中心 |
| `/sales-dashboard` | 原销售工作台 |
| `/engineer-workstation` | 原工程师工作台 |
| `/production-dashboard` | 原生产工作台 |
| `/procurement-dashboard` | 原采购工作台 |
| `/manufacturing-director-dashboard` | 原制造总监工作台 |
| `/production-manager-dashboard` | 原生产经理工作台 |
| `/worker-workstation` | 原工人工作台 |
| `/customer-service-dashboard` | 原客服工作台 |
| `/finance-manager-dashboard` | 原财务经理工作台 |
| `/hr-manager-dashboard` | 原HR经理工作台 |
| `/presales-dashboard` | 原售前工作台 |
| `/business-support` | 原商务支持工作台 |
| `/procurement-manager-dashboard` | 原采购经理工作台 |

---

## 五、架构改进总结

### 5.1 改进前

```
┌─────────────────────────────────────────────┐
│  Sidebar 配置                                │
├─────────────────────────────────────────────┤
│  default.js (管理员)                         │
│  production.js (生产角色)                    │
│  procurement.js (采购角色)                   │
│  pmo.js (PMO角色)                           │
│  sales.js (销售角色)                         │
│  engineer.js (工程师角色)                    │
│  finance.js (财务角色)                       │
│  customerService.js (客服角色)               │
├─────────────────────────────────────────────┤
│  问题：重复配置、维护困难、不一致风险         │
└─────────────────────────────────────────────┘
```

### 5.2 改进后

```
┌─────────────────────────────────────────────┐
│  Sidebar 配置                                │
├─────────────────────────────────────────────┤
│  default.js (统一菜单)                       │
│       ↓                                      │
│  permission 字段控制可见性                   │
│       ↓                                      │
│  NavGroup 组件权限检查                       │
├─────────────────────────────────────────────┤
│  优点：单一数据源、易维护、自动权限控制       │
└─────────────────────────────────────────────┘
```

### 5.3 Dashboard Widget 配置

```
┌─────────────────────────────────────────────┐
│  UnifiedDashboard                           │
├─────────────────────────────────────────────┤
│  widgetRegistry.js  →  所有可用组件注册      │
│  roleWidgetConfig.js → 每个角色的组件布局    │
├─────────────────────────────────────────────┤
│  新增 WelcomeCard 组件（整合自工作中心）     │
│  所有角色首个组件均为 welcome-card          │
└─────────────────────────────────────────────┘
```

---

## 六、代码变更统计

| 类型 | 数量 |
|------|------|
| 删除的菜单项 | ~33个 |
| 删除的配置文件 | 7个 |
| 删除的代码行数 | ~789行 |
| 新增的组件 | 1个 (WelcomeCard) |
| 更新的角色配置 | 27个 |

---

## 七、后续建议

1. **菜单项审查**: 定期审查 `default.js` 中的菜单项，确保没有冗余
2. **权限码规范**: 统一权限码命名规范，如 `module:resource:action`
3. **Widget 扩展**: 可继续将其他页面的特色功能整合为 Widget 组件
4. **文档维护**: 菜单变更时同步更新此文档

---

*文档生成时间: 2026-01-21*
*分支: claude/refactor-menu-duplication-l5vi8*

# Phase 2 剩余未迁移模块清单

> **创建日期**: 2026-01-24  
> **状态**: 📋 待迁移模块清单

---

## 📊 迁移进度总览

### ✅ 已迁移模块 (7/10)

| 模块 | 状态 | 代码行数 | 迁移日期 |
|------|------|----------|----------|
| **里程碑** | ✅ 完成 | 42行 | 2026-01-24 |
| **成本** | ✅ 完成 | 104行 (37+67) | 2026-01-24 |
| **机器** | ✅ 完成 | 436行 (220+184+32) | 2026-01-24 |
| **成员** | ✅ 完成 | 238行 | 2026-01-24 |
| **评价** | ✅ 完成 | 305行 (236+69) | 2026-01-24 |
| **资源计划** | ✅ 完成 | 268行 (170+98) | 2026-01-24 |
| **工时** | ✅ 完成 | 361行 (173+188) | 2026-01-24 |

### ⏭️ 不适合迁移的模块 (3/10)

| 模块 | 代码行数 | 复杂度 | 状态 | 说明 |
|------|----------|--------|------|------|
| **阶段** | 151行 | 简单 | ⏭️ 不适合 | 主要是自定义端点（初始化、清除、进度查询），无标准CRUD |
| **工作日志** | 132行 | 简单 | ⏭️ 不适合 | 只读查询，通过WorkLogMention关联查询，无标准CRUD |
| **工作量** | 333行 | 复杂 | ⏭️ 不适合 | 统计查询（团队负荷、甘特图、汇总），无标准CRUD |

**说明**: 这些模块主要是查询和统计功能，不适合使用标准CRUD基类，保持原样即可。

### ⚠️ 特殊模块（可能不需要迁移）

| 模块 | 代码行数 | 说明 |
|------|----------|------|
| **角色** | ~500行 | 管理项目角色配置，不是标准CRUD，可能需要特殊处理 |

---

## 一、未迁移模块详细分析

> **注意**: roles模块是管理项目角色配置的特殊模块，不是标准CRUD，可能需要特殊处理或保持原样。

### 1.1 评价模块 (Evaluations)

**文件**: `app/api/v1/endpoints/projects/evaluations/crud.py`  
**代码行数**: 246行  
**复杂度**: 🟡 中等

**功能分析**:
- ✅ 列表查询（支持分页、状态筛选）
- ✅ 创建评价
- ✅ 获取详情
- ✅ 更新评价
- ✅ 删除评价
- ✅ 确认评价（自定义端点）

**迁移难度**: 🟡 中等
- 有自定义端点（确认评价）
- 有状态筛选
- 可能需要填充关联数据

**预计时间**: 2天

---

### 1.2 阶段模块 (Stages)

**文件**: `app/api/v1/endpoints/projects/stages/crud.py`  
**代码行数**: 151行  
**复杂度**: 🟢 简单

**功能分析**:
- ✅ 列表查询（返回阶段实例列表）
- ✅ 获取进度（自定义端点）
- ✅ 初始化阶段（自定义端点）
- ✅ 推进阶段（自定义端点）

**迁移难度**: 🟢 简单
- 主要是自定义端点
- 列表查询较简单
- 可能需要特殊处理

**预计时间**: 1天

---

### 1.3 工时模块 (Timesheet)

**文件**: `app/api/v1/endpoints/projects/timesheet/crud.py`  
**代码行数**: 277行  
**复杂度**: 🟡 中等

**功能分析**:
- ✅ 列表查询（支持分页、日期筛选、用户筛选、状态筛选）
- ✅ 创建工时记录
- ✅ 获取详情
- ✅ 更新工时记录
- ✅ 删除工时记录
- ✅ 批量操作（自定义端点）

**迁移难度**: 🟡 中等
- 有多个筛选条件（日期、用户、状态）
- 有批量操作端点
- 可能需要特殊处理

**预计时间**: 2天

---

### 1.4 工作日志模块 (Work Logs)

**文件**: `app/api/v1/endpoints/projects/work_logs/crud.py`  
**代码行数**: 132行  
**复杂度**: 🟢 简单

**功能分析**:
- ✅ 列表查询（只读视图，查询提及项目的工作日志）
- ✅ 获取详情
- ⚠️ 无创建/更新/删除（工作日志属于用户）

**迁移难度**: 🟢 简单
- 主要是只读查询
- 无标准CRUD操作
- 可能需要特殊处理

**预计时间**: 1天

---

### 1.5 工作量模块 (Workload)

**文件**: `app/api/v1/endpoints/projects/workload/crud.py`  
**代码行数**: 333行  
**复杂度**: 🔴 复杂

**功能分析**:
- ✅ 团队负荷查询（自定义端点）
- ✅ 甘特图数据（自定义端点）
- ✅ 工作量摘要（自定义端点）
- ⚠️ 无标准CRUD操作（主要是统计和查询）

**迁移难度**: 🔴 复杂
- 主要是统计和查询端点
- 无标准CRUD操作
- 可能需要特殊处理或保持原样

**预计时间**: 3天

---

### 1.6 资源计划模块 (Resource Plan)

**文件**: `app/api/v1/endpoints/projects/resource_plan/crud.py`  
**代码行数**: 251行  
**复杂度**: 🟡 中等

**功能分析**:
- ✅ 列表查询（支持阶段筛选）
- ✅ 创建资源计划
- ✅ 获取详情
- ✅ 更新资源计划
- ✅ 删除资源计划
- ✅ 汇总查询（自定义端点）

**迁移难度**: 🟡 中等
- 有标准CRUD操作
- 有阶段筛选
- 有汇总端点

**预计时间**: 2天

---

## 二、迁移优先级建议

### 2.1 按复杂度排序

| 优先级 | 模块 | 原因 |
|--------|------|------|
| **1** | 阶段 | 最简单，快速见效 |
| **2** | 工作日志 | 简单，主要是只读查询 |
| **3** | 评价 | 中等复杂度，有标准CRUD |
| **4** | 资源计划 | 中等复杂度，有标准CRUD |
| **5** | 工时 | 中等复杂度，有多个筛选条件 |
| **6** | 工作量 | 最复杂，主要是统计查询 |

### 2.2 按业务重要性排序

| 优先级 | 模块 | 原因 |
|--------|------|------|
| **1** | 工时 | 业务核心功能，使用频繁 |
| **2** | 资源计划 | 业务核心功能，使用频繁 |
| **3** | 评价 | 业务重要功能 |
| **4** | 阶段 | 业务重要功能 |
| **5** | 工作日志 | 辅助功能 |
| **6** | 工作量 | 辅助功能，主要是统计 |

---

## 三、迁移策略建议

### 3.1 简单模块（阶段、工作日志）

**策略**: 直接使用基类或保持原样

- **阶段模块**: 主要是自定义端点，可能不需要迁移
- **工作日志模块**: 只读查询，可能不需要迁移

### 3.2 中等复杂度模块（评价、资源计划、工时）

**策略**: 使用基类 + 提取自定义端点

- **评价模块**: 标准CRUD + 确认评价端点
- **资源计划模块**: 标准CRUD + 汇总端点
- **工时模块**: 标准CRUD + 批量操作端点

### 3.3 复杂模块（工作量）

**策略**: 评估是否需要迁移

- **工作量模块**: 主要是统计和查询，无标准CRUD
- 可能需要保持原样或部分迁移

---

## 四、预计工作量

### 4.1 时间估算

| 模块 | 预计时间 | 累计时间 |
|------|----------|----------|
| 阶段 | 1天 | 1天 |
| 工作日志 | 1天 | 2天 |
| 评价 | 2天 | 4天 |
| 资源计划 | 2天 | 6天 |
| 工时 | 2天 | 8天 |
| 工作量 | 3天 | 11天 |

**总计**: 11天（约2周）

### 4.2 人员配置

- **开发人员**: 1人
- **测试人员**: 1人（兼职）
- **代码审查**: 1人（兼职）

---

## 五、迁移检查清单

### 5.1 迁移前准备

- [ ] 检查Schema定义
- [ ] 检查模型关系
- [ ] 检查自定义端点
- [ ] 检查业务逻辑
- [ ] 备份现有代码

### 5.2 迁移步骤

- [ ] 修改Schema（project_id改为可选）
- [ ] 使用基类重构CRUD端点
- [ ] 提取自定义端点
- [ ] 创建测试文件
- [ ] 运行测试验证

### 5.3 迁移后验证

- [ ] 所有测试通过
- [ ] 功能完整性验证
- [ ] 性能无退化
- [ ] 代码审查通过

---

## 六、下一步行动

### 6.1 立即可以开始

1. **迁移阶段模块** (预计1天)
   - 最简单，快速见效
   - 验证迁移策略

2. **迁移工作日志模块** (预计1天)
   - 简单，主要是只读查询
   - 验证只读模块的迁移方式

### 6.2 后续计划

3. **迁移评价模块** (预计2天)
4. **迁移资源计划模块** (预计2天)
5. **迁移工时模块** (预计2天)
6. **评估工作量模块** (预计3天)

---

## 七、总结

### 📊 当前状态

- ✅ **4个模块已迁移** - 里程碑、成本、机器、成员
- ⏳ **6个模块待迁移** - 评价、阶段、工时、工作日志、工作量、资源计划
- 📈 **进度**: 40% (4/10)

### 🎯 建议

1. **优先迁移简单模块** - 阶段、工作日志（快速见效）
2. **然后迁移中等复杂度模块** - 评价、资源计划、工时
3. **最后评估复杂模块** - 工作量（可能需要特殊处理）

### ✅ 迁移完成

- **已迁移**: 7个模块（所有可迁移模块）
- **不适合迁移**: 3个模块（阶段、工作日志、工作量）
- **测试通过率**: 100% (53/53)

---

**文档版本**: v1.0  
**创建日期**: 2026-01-24  
**状态**: 📋 待迁移模块清单

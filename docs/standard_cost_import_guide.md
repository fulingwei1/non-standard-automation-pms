# 标准成本批量导入指南

## 概述

本文档详细说明如何使用Excel或CSV文件批量导入标准成本数据。

## 准备工作

### 1. 下载导入模板

1. 登录系统
2. 进入"标准成本库"模块
3. 点击"批量导入"按钮
4. 点击"下载模板"
5. 保存Excel模板文件到本地

### 2. 了解模板结构

模板包含两个工作表（Sheet）：

- **标准成本导入模板**：用于填写数据的主表
- **导入说明**：字段说明和注意事项

## 模板字段说明

### 必填字段（带*标记）

| 字段名 | 数据类型 | 说明 | 示例 |
|--------|---------|------|------|
| 成本项编码* | 文本 | 唯一标识，不能重复 | MAT-001 |
| 成本项名称* | 文本 | 成本项的名称 | 钢板Q235 |
| 成本类别* | 文本 | MATERIAL/LABOR/OVERHEAD | MATERIAL |
| 单位* | 文本 | 计量单位 | kg |
| 标准成本* | 数值 | 成本金额，支持小数 | 4.50 |
| 成本来源* | 文本 | 见"成本来源说明" | HISTORICAL_AVG |
| 生效日期* | 日期 | 格式：YYYY-MM-DD | 2026-01-01 |

### 可选字段

| 字段名 | 数据类型 | 说明 | 示例 |
|--------|---------|------|------|
| 规格型号 | 文本 | 物料规格或人员等级 | 8mm厚度 |
| 币种 | 文本 | 默认CNY | CNY |
| 来源说明 | 文本 | 详细描述成本来源 | 基于过去6个月平均价格 |
| 失效日期 | 日期 | 格式：YYYY-MM-DD，为空表示长期有效 | 2026-12-31 |
| 成本说明 | 文本 | 成本项的详细说明 | 普通碳素结构钢板 |
| 备注 | 文本 | 其他补充信息 | 市场价格稳定 |

## 字段值说明

### 成本类别 (cost_category)

只能使用以下值之一：

| 值 | 中文说明 | 适用范围 |
|----|---------|---------|
| MATERIAL | 物料成本 | 原材料、零部件、辅料等 |
| LABOR | 人工成本 | 各级别人员的工资、工时费用 |
| OVERHEAD | 制造费用 | 设备折旧、水电费、管理费用等 |

**示例：**
```
MATERIAL  ✓ 正确
material  ✗ 错误（必须大写）
物料      ✗ 错误（不能使用中文）
MAT       ✗ 错误（不是有效值）
```

### 成本来源 (cost_source)

只能使用以下值之一：

| 值 | 中文说明 | 使用场景 |
|----|---------|---------|
| HISTORICAL_AVG | 历史平均 | 基于过去一段时间的实际成本平均值 |
| INDUSTRY_STANDARD | 行业标准 | 行业公开的标准成本数据 |
| EXPERT_ESTIMATE | 专家估计 | 由专业人员评估确定 |
| VENDOR_QUOTE | 供应商报价 | 供应商提供的报价 |

**示例：**
```
HISTORICAL_AVG      ✓ 正确
INDUSTRY_STANDARD   ✓ 正确
historical_avg      ✗ 错误（必须大写）
历史平均            ✗ 错误（不能使用中文）
MARKET_PRICE        ✗ 错误（不是有效值）
```

### 日期格式

所有日期字段必须使用 `YYYY-MM-DD` 格式：

**正确示例：**
```
2026-01-01  ✓
2026-12-31  ✓
```

**错误示例：**
```
2026/01/01    ✗ 错误（使用了/分隔符）
01-01-2026    ✗ 错误（顺序错误）
2026-1-1      ✗ 错误（月和日必须是两位）
2026年1月1日   ✗ 错误（包含中文）
```

### 数值格式

标准成本字段必须是数值：

**正确示例：**
```
4.50      ✓
1200      ✓
0.35      ✓
```

**错误示例：**
```
4.50元     ✗ 错误（包含文字）
1,200.00  ✗ 错误（包含逗号）
¥100      ✗ 错误（包含货币符号）
```

## 数据准备示例

### 物料成本示例

| 成本项编码* | 成本项名称* | 成本类别* | 规格型号 | 单位* | 标准成本* | 币种 | 成本来源* | 来源说明 | 生效日期* |
|------------|------------|----------|---------|-------|----------|------|-----------|---------|-----------|
| MAT-001 | 钢板Q235 | MATERIAL | 8mm厚度 | kg | 4.50 | CNY | HISTORICAL_AVG | 基于过去6个月平均价格 | 2026-01-01 |
| MAT-002 | 不锈钢304 | MATERIAL | 2mm厚度 | kg | 15.80 | CNY | VENDOR_QUOTE | 供应商报价 | 2026-01-01 |
| MAT-003 | M8螺栓 | MATERIAL | 304不锈钢 | 个 | 0.35 | CNY | HISTORICAL_AVG | 历史平均采购价 | 2026-01-01 |

### 人工成本示例

| 成本项编码* | 成本项名称* | 成本类别* | 规格型号 | 单位* | 标准成本* | 币种 | 成本来源* | 来源说明 | 生效日期* |
|------------|------------|----------|---------|-------|----------|------|-----------|---------|-----------|
| LAB-001 | 高级工程师 | LABOR | 5年以上经验 | 人天 | 1200.00 | CNY | EXPERT_ESTIMATE | 基于市场薪酬水平 | 2026-01-01 |
| LAB-002 | 中级工程师 | LABOR | 2-5年经验 | 人天 | 800.00 | CNY | EXPERT_ESTIMATE | 基于市场薪酬水平 | 2026-01-01 |
| LAB-003 | 初级工程师 | LABOR | 2年以下经验 | 人天 | 500.00 | CNY | EXPERT_ESTIMATE | 基于市场薪酬水平 | 2026-01-01 |

### 制造费用示例

| 成本项编码* | 成本项名称* | 成本类别* | 规格型号 | 单位* | 标准成本* | 币种 | 成本来源* | 来源说明 | 生效日期* |
|------------|------------|----------|---------|-------|----------|------|-----------|---------|-----------|
| OVH-001 | 设备折旧 | OVERHEAD | 按台时分摊 | 台时 | 50.00 | CNY | EXPERT_ESTIMATE | 基于设备原值和折旧年限 | 2026-01-01 |
| OVH-002 | 电费 | OVERHEAD | 工业用电 | 度 | 0.65 | CNY | HISTORICAL_AVG | 过去一年平均电价 | 2026-01-01 |
| OVH-003 | 车间管理费 | OVERHEAD | 按人工成本20% | % | 20.00 | CNY | INDUSTRY_STANDARD | 行业标准分摊率 | 2026-01-01 |

## 导入步骤

### 第1步：填写数据

1. 打开下载的模板文件
2. 在"标准成本导入模板"sheet中填写数据
3. 参考"导入说明"sheet了解字段要求
4. 确保所有必填字段（带*）都已填写

### 第2步：数据验证

导入前请检查：

**□ 成本编码检查**
- 所有编码唯一，没有重复
- 编码格式统一（如：MAT-XXX, LAB-XXX）
- 没有空白编码

**□ 成本类别检查**
- 只使用 MATERIAL/LABOR/OVERHEAD
- 大写格式正确
- 没有拼写错误

**□ 成本来源检查**
- 使用有效值
- 大写格式正确
- 下划线位置正确

**□ 日期格式检查**
- 格式为 YYYY-MM-DD
- 生效日期 < 失效日期（如果有失效日期）
- 日期有效（如：月份1-12，日期1-31）

**□ 数值检查**
- 标准成本为正数
- 没有文字或特殊符号
- 小数点格式正确

**□ 必填字段检查**
- 所有带*的字段都已填写
- 没有空白单元格

### 第3步：保存文件

- **Excel格式**：保存为 .xlsx 或 .xls 文件
- **CSV格式**：保存为 .csv 文件（编码：UTF-8）

### 第4步：执行导入

1. 登录系统
2. 进入"标准成本库"模块
3. 点击"批量导入"
4. 点击"选择文件"，选择准备好的文件
5. 点击"开始导入"
6. 等待导入完成

### 第5步：查看结果

导入完成后，系统会显示：

- **成功导入数量**：成功创建的成本项数量
- **失败数量**：导入失败的行数
- **错误详情**：每个错误的具体信息（行号、字段、错误原因）
- **警告信息**：需要注意的问题（如重复编码）

## 常见错误及解决方法

### 错误1：成本编码已存在

**错误信息：**
```
行5: 成本编码 MAT-001 已存在且有效
```

**原因：** 系统中已经存在相同编码的活动成本项

**解决方法：**
1. 更改Excel中的成本编码为新编码
2. 或者先在系统中停用已存在的成本项
3. 或者使用更新功能而不是导入

### 错误2：成本类别无效

**错误信息：**
```
行3: 无效的成本类别：material
```

**原因：** 成本类别必须大写

**解决方法：**
- 将 `material` 改为 `MATERIAL`
- 确保使用 MATERIAL/LABOR/OVERHEAD 之一

### 错误3：成本来源无效

**错误信息：**
```
行8: 无效的成本来源：MARKET_PRICE
```

**原因：** 使用了不存在的成本来源值

**解决方法：**
- 使用有效值：HISTORICAL_AVG、INDUSTRY_STANDARD、EXPERT_ESTIMATE、VENDOR_QUOTE
- 检查拼写和大写

### 错误4：日期格式错误

**错误信息：**
```
行10: 无效的生效日期格式：2026/01/01
```

**原因：** 日期格式不正确

**解决方法：**
- 使用 YYYY-MM-DD 格式
- 将 `2026/01/01` 改为 `2026-01-01`

### 错误5：必填字段为空

**错误信息：**
```
行12: 成本项编码不能为空
```

**原因：** 必填字段未填写

**解决方法：**
- 检查所有带*的字段
- 确保没有空白单元格

### 错误6：数值格式错误

**错误信息：**
```
行15: 标准成本格式错误：4.50元
```

**原因：** 数值字段包含非数字字符

**解决方法：**
- 移除文字、符号
- 只保留数字和小数点
- 将 `4.50元` 改为 `4.50`

## 性能提示

### 建议批量大小

- **小批量**：100条以内 - 导入速度快，错误定位容易
- **中批量**：100-500条 - 平衡速度和管理
- **大批量**：500-1000条 - 适合初始化数据
- **超大批量**：1000条以上 - 建议分批导入

### 导入最佳实践

1. **先小后大**：先导入少量数据测试，确认无误后再批量导入
2. **分类导入**：按成本类别分批导入（物料、人工、费用）
3. **备份检查**：导入前备份现有数据
4. **错误处理**：有错误时只修复错误行，不需要重新导入全部

## 导入后检查

导入完成后，建议进行以下检查：

**□ 数量检查**
- 导入的数量是否正确
- 成功+失败数量 = Excel总行数

**□ 数据抽查**
- 随机抽查几条记录
- 验证数据是否正确录入
- 检查金额、日期等关键字段

**□ 分类统计**
- 按成本类别统计数量
- 验证各类别数据完整性

**□ 版本确认**
- 新导入的成本项版本为1
- is_active状态为true

## 常见问题

### Q1: 可以更新已存在的成本项吗？

**答：** 批量导入功能主要用于创建新成本项。如果需要更新已存在的成本项，建议：
1. 使用更新API接口
2. 或者先停用旧成本项，再导入新数据

### Q2: CSV和Excel有什么区别？

**答：**
- **Excel**：支持多sheet，可以包含导入说明
- **CSV**：纯文本，文件小，导入速度快
- 两种格式功能相同，可根据习惯选择

### Q3: 导入失败的数据会保存吗？

**答：** 不会。导入采用事务处理：
- 如果某行数据有错误，该行不会导入
- 其他正确的行会正常导入
- 可以修复错误后重新导入失败的数据

### Q4: 可以导入历史数据吗？

**答：** 可以。通过设置effective_date字段：
- 设置为过去的日期可导入历史数据
- 设置expiry_date可标记已失效的成本

### Q5: 导入的数据可以修改吗？

**答：** 可以。导入后的数据和手工创建的数据完全相同，可以：
- 查看详情
- 更新（创建新版本）
- 停用
- 查看历史记录

## 技术支持

如遇到问题，请联系：
- 技术支持邮箱：support@company.com
- 培训咨询：training@company.com

提供问题反馈时，请包含：
- 错误信息截图
- 导入的Excel文件（去敏后）
- 导入结果的错误详情

# 非标自动化项目管理系统 - 数据字典

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | 1.0 |
| 更新日期 | 2026-01-02 |
| 文档状态 | 初稿 |

---

## 一、枚举值定义

### 1.1 项目管理相关

#### 项目阶段 (Stage)

| 编码 | 名称 | 说明 |
|------|------|------|
| S1 | 需求进入 | 项目需求确认阶段 |
| S2 | 方案设计 | 技术方案设计阶段 |
| S3 | 采购备料 | 物料采购准备阶段 |
| S4 | 加工制造 | 零部件加工制造阶段 |
| S5 | 装配调试 | 设备装配调试阶段 |
| S6 | 出厂验收(FAT) | 工厂验收测试阶段 |
| S7 | 包装发运 | 设备包装发运阶段 |
| S8 | 现场安装(SAT) | 现场安装调试阶段 |
| S9 | 质保结项 | 质保期及项目结项 |

#### 项目健康度 (Health)

| 编码 | 名称 | 颜色 | 说明 |
|------|------|------|------|
| H1 | 正常 | 绿色 | 项目进展正常,无风险 |
| H2 | 有风险 | 黄色 | 存在潜在风险,需关注 |
| H3 | 阻塞 | 红色 | 存在阻塞问题,需立即处理 |
| H4 | 已完结 | 灰色 | 项目已完成或终止 |

#### 项目状态 (Status)

| 编码 | 名称 | 适用阶段 | 说明 |
|------|------|----------|------|
| DRAFT | 草稿 | 通用 | 初始创建状态 |
| PENDING | 待处理 | 通用 | 等待处理 |
| IN_PROGRESS | 进行中 | 通用 | 正在执行 |
| COMPLETED | 已完成 | 通用 | 执行完成 |
| CANCELLED | 已取消 | 通用 | 已取消 |
| ON_HOLD | 暂停 | 通用 | 暂时搁置 |

#### 设备状态

| 编码 | 名称 | 说明 |
|------|------|------|
| PLANNING | 规划中 | 设备正在规划设计 |
| IN_PRODUCTION | 生产中 | 设备正在制造 |
| TESTING | 测试中 | 设备正在测试调试 |
| SHIPPED | 已发运 | 设备已发运 |
| INSTALLED | 已安装 | 设备已完成安装 |
| ACCEPTED | 已验收 | 设备已通过验收 |
| IN_WARRANTY | 质保中 | 设备在质保期内 |

#### 里程碑类型

| 编码 | 名称 | 说明 |
|------|------|------|
| CONTRACT | 合同签订 | 合同签订里程碑 |
| DESIGN_COMPLETE | 设计完成 | 方案设计完成 |
| PURCHASE_COMPLETE | 采购完成 | 物料采购到齐 |
| ASSEMBLY_COMPLETE | 装配完成 | 设备装配完成 |
| FAT_PASS | FAT通过 | 工厂验收通过 |
| SHIPMENT | 发运 | 设备发运 |
| SAT_PASS | SAT通过 | 现场验收通过 |
| FINAL_ACCEPTANCE | 终验 | 最终验收通过 |
| WARRANTY_END | 质保结束 | 质保期结束 |

### 1.2 采购与物料相关

#### 物料类型

| 编码 | 名称 | 说明 |
|------|------|------|
| STANDARD | 标准件 | 通用标准件 |
| MECHANICAL | 机械件 | 机械加工件 |
| ELECTRICAL | 电气件 | 电气元器件 |
| PNEUMATIC | 气动件 | 气动元件 |
| HYDRAULIC | 液压件 | 液压元件 |
| SENSOR | 传感器 | 各类传感器 |
| MOTOR | 电机 | 各类电机 |
| PLC | PLC | 控制器及模块 |
| HMI | 触摸屏 | 人机界面 |
| SAFETY | 安全器件 | 安全相关器件 |
| CONSUMABLE | 耗材 | 消耗性物料 |
| OTHER | 其他 | 其他类型 |

#### 物料来源

| 编码 | 名称 | 说明 |
|------|------|------|
| PURCHASE | 采购 | 外部采购 |
| OUTSOURCE | 外协 | 外协加工 |
| SELF_MADE | 自制 | 自行加工 |
| CUSTOMER | 客供 | 客户提供 |

#### 采购订单状态

| 编码 | 名称 | 说明 |
|------|------|------|
| DRAFT | 草稿 | 订单创建中 |
| PENDING_APPROVAL | 待审批 | 等待审批 |
| APPROVED | 已审批 | 审批通过 |
| REJECTED | 已驳回 | 审批驳回 |
| ORDERED | 已下单 | 已向供应商下单 |
| PARTIAL_RECEIVED | 部分到货 | 部分物料已到货 |
| RECEIVED | 已到货 | 全部物料已到货 |
| COMPLETED | 已完成 | 订单完成 |
| CANCELLED | 已取消 | 订单取消 |

#### 供应商等级

| 编码 | 名称 | 说明 |
|------|------|------|
| A | 优选供应商 | 质量、交期、服务均优秀 |
| B | 合格供应商 | 满足基本要求 |
| C | 待改进供应商 | 需要改进提升 |
| D | 淘汰供应商 | 不推荐使用 |

#### 付款状态

| 编码 | 名称 | 说明 |
|------|------|------|
| UNPAID | 未付款 | 尚未付款 |
| PARTIAL | 部分付款 | 已支付部分款项 |
| PAID | 已付清 | 全部付清 |

### 1.3 变更管理相关

#### ECN类型

| 编码 | 名称 | 说明 |
|------|------|------|
| DESIGN | 设计变更 | 设计方案变更 |
| MATERIAL | 物料变更 | 物料替换或规格变更 |
| PROCESS | 工艺变更 | 加工工艺变更 |
| SPECIFICATION | 规格变更 | 产品规格变更 |
| SCHEDULE | 计划变更 | 进度计划变更 |
| OTHER | 其他变更 | 其他类型变更 |

#### ECN来源类型

| 编码 | 名称 | 说明 |
|------|------|------|
| CUSTOMER | 客户要求 | 客户提出的变更要求 |
| INTERNAL | 内部发起 | 公司内部发起的变更 |
| SUPPLIER | 供应商 | 供应商原因导致的变更 |
| QUALITY | 质量问题 | 质量问题引发的变更 |
| COST | 成本优化 | 成本优化驱动的变更 |

#### ECN状态

| 编码 | 名称 | 说明 |
|------|------|------|
| DRAFT | 草稿 | ECN创建中 |
| SUBMITTED | 已提交 | 已提交待评估 |
| EVALUATING | 评估中 | 各部门评估中 |
| PENDING_APPROVAL | 待审批 | 等待审批 |
| APPROVED | 已批准 | 审批通过 |
| REJECTED | 已驳回 | 审批驳回 |
| EXECUTING | 执行中 | 变更执行中 |
| COMPLETED | 已完成 | 变更执行完成 |
| CLOSED | 已关闭 | ECN已关闭 |
| CANCELLED | 已取消 | ECN已取消 |

#### ECN优先级

| 编码 | 名称 | 说明 |
|------|------|------|
| LOW | 低 | 不紧急,可延后处理 |
| NORMAL | 普通 | 正常优先级 |
| HIGH | 高 | 需优先处理 |
| URGENT | 紧急 | 需立即处理 |

#### 变更范围

| 编码 | 名称 | 说明 |
|------|------|------|
| PARTIAL | 局部 | 仅影响部分设备/组件 |
| SINGLE_MACHINE | 单台设备 | 影响单台设备 |
| ALL_MACHINES | 所有设备 | 影响项目所有设备 |
| MULTI_PROJECT | 跨项目 | 影响多个项目 |

### 1.4 验收管理相关

#### 验收类型

| 编码 | 名称 | 说明 |
|------|------|------|
| FAT | 工厂验收 | Factory Acceptance Test |
| SAT | 现场验收 | Site Acceptance Test |
| FINAL | 终验 | 最终验收 |

#### 验收单状态

| 编码 | 名称 | 说明 |
|------|------|------|
| DRAFT | 草稿 | 验收单创建中 |
| READY | 待验收 | 准备进行验收 |
| IN_PROGRESS | 验收中 | 正在进行验收 |
| PENDING_SIGN | 待签字 | 等待签字确认 |
| COMPLETED | 已完成 | 验收完成 |
| CANCELLED | 已取消 | 验收取消 |

#### 验收结果

| 编码 | 名称 | 说明 |
|------|------|------|
| PASSED | 通过 | 验收通过 |
| FAILED | 不通过 | 验收不通过 |
| CONDITIONAL | 有条件通过 | 在满足条件后通过 |

#### 检查项结果

| 编码 | 名称 | 说明 |
|------|------|------|
| PENDING | 待检 | 尚未检查 |
| PASSED | 通过 | 检查通过 |
| FAILED | 不通过 | 检查不通过 |
| NA | 不适用 | 该项不适用 |
| CONDITIONAL | 有条件通过 | 有条件通过 |

#### 验收问题类型

| 编码 | 名称 | 说明 |
|------|------|------|
| DEFECT | 缺陷 | 产品缺陷 |
| DEVIATION | 偏差 | 与标准存在偏差 |
| SUGGESTION | 建议 | 改进建议 |

#### 问题严重程度

| 编码 | 名称 | 说明 |
|------|------|------|
| CRITICAL | 严重 | 阻塞验收,必须解决 |
| MAJOR | 主要 | 重要问题,需要解决 |
| MINOR | 次要 | 小问题,可延后解决 |

### 1.5 外协管理相关

#### 外协商类型

| 编码 | 名称 | 说明 |
|------|------|------|
| MACHINING | 机加工 | 机械加工 |
| ASSEMBLY | 装配 | 组件装配 |
| SURFACE | 表面处理 | 喷涂、电镀等 |
| ELECTRICAL | 电气 | 电气组装、布线 |
| OTHER | 其他 | 其他类型 |

#### 外协订单状态

| 编码 | 名称 | 说明 |
|------|------|------|
| DRAFT | 草稿 | 订单创建中 |
| CONFIRMED | 已确认 | 订单已确认 |
| IN_PROGRESS | 加工中 | 外协商加工中 |
| DELIVERED | 已交付 | 外协商已交付 |
| INSPECTED | 已检验 | 已完成来料检验 |
| COMPLETED | 已完成 | 订单完成 |
| CANCELLED | 已取消 | 订单取消 |

#### 质检结果

| 编码 | 名称 | 说明 |
|------|------|------|
| PASSED | 合格 | 检验合格 |
| REJECTED | 不合格 | 检验不合格 |
| CONDITIONAL | 让步接收 | 有条件接收 |

#### 不合格品处置

| 编码 | 名称 | 说明 |
|------|------|------|
| ACCEPT | 接收 | 让步接收 |
| REWORK | 返工 | 返回外协商返工 |
| RETURN | 退货 | 退货 |
| SCRAP | 报废 | 报废处理 |

### 1.6 预警与异常相关

#### 预警级别

| 编码 | 名称 | 颜色 | 说明 |
|------|------|------|------|
| INFO | 提示 | 蓝色 | 一般性提示信息 |
| WARNING | 警告 | 黄色 | 需要关注的警告 |
| CRITICAL | 严重 | 橙色 | 严重问题,需要处理 |
| URGENT | 紧急 | 红色 | 紧急问题,需立即处理 |

#### 预警规则类型

| 编码 | 名称 | 说明 |
|------|------|------|
| SCHEDULE_DELAY | 进度延期 | 进度延期预警 |
| COST_OVERRUN | 成本超支 | 成本超预算预警 |
| MILESTONE_DUE | 里程碑到期 | 里程碑即将到期 |
| DELIVERY_DUE | 交期预警 | 交货日期预警 |
| MATERIAL_SHORTAGE | 物料短缺 | 物料短缺预警 |
| QUALITY_ISSUE | 质量问题 | 质量问题预警 |
| PAYMENT_DUE | 付款到期 | 付款日期预警 |
| CUSTOM | 自定义 | 自定义规则 |

#### 预警状态

| 编码 | 名称 | 说明 |
|------|------|------|
| PENDING | 待处理 | 预警待处理 |
| ACKNOWLEDGED | 已确认 | 已确认收到 |
| PROCESSING | 处理中 | 正在处理 |
| RESOLVED | 已解决 | 问题已解决 |
| IGNORED | 已忽略 | 预警已忽略 |
| EXPIRED | 已过期 | 预警已过期 |

#### 异常事件类型

| 编码 | 名称 | 说明 |
|------|------|------|
| SCHEDULE | 进度异常 | 进度相关异常 |
| QUALITY | 质量异常 | 质量相关异常 |
| COST | 成本异常 | 成本相关异常 |
| RESOURCE | 资源异常 | 资源相关异常 |
| SAFETY | 安全异常 | 安全相关异常 |
| OTHER | 其他 | 其他类型异常 |

#### 异常严重程度

| 编码 | 名称 | 说明 |
|------|------|------|
| MINOR | 轻微 | 轻微异常,影响较小 |
| MAJOR | 重大 | 重大异常,影响较大 |
| CRITICAL | 严重 | 严重异常,需立即处理 |
| BLOCKER | 阻塞 | 阻塞性异常,项目无法继续 |

#### 异常状态

| 编码 | 名称 | 说明 |
|------|------|------|
| OPEN | 开放 | 异常已记录 |
| ANALYZING | 分析中 | 正在分析原因 |
| RESOLVING | 解决中 | 正在解决 |
| RESOLVED | 已解决 | 问题已解决 |
| CLOSED | 已关闭 | 异常已关闭 |
| DEFERRED | 已延期 | 异常处理延期 |

### 1.7 通用状态枚举

#### 启用状态

| 编码 | 名称 | 说明 |
|------|------|------|
| ACTIVE | 启用 | 启用状态 |
| INACTIVE | 停用 | 停用状态 |

#### 审批结果

| 编码 | 名称 | 说明 |
|------|------|------|
| APPROVED | 批准 | 审批通过 |
| REJECTED | 驳回 | 审批驳回 |
| RETURNED | 退回 | 退回修改 |

#### 通知渠道

| 编码 | 名称 | 说明 |
|------|------|------|
| SYSTEM | 系统消息 | 站内消息 |
| EMAIL | 邮件 | 电子邮件 |
| SMS | 短信 | 手机短信 |
| WECHAT | 微信 | 企业微信/微信 |

---

## 二、角色与权限定义

### 2.1 系统角色

| 角色编码 | 角色名称 | 说明 |
|----------|----------|------|
| SUPER_ADMIN | 超级管理员 | 系统最高权限 |
| ADMIN | 系统管理员 | 系统管理权限 |
| PROJECT_MANAGER | 项目经理 | 项目管理权限 |
| ENGINEER | 工程师 | 工程执行权限 |
| PURCHASER | 采购员 | 采购相关权限 |
| QA | 质量工程师 | 质量管理权限 |
| FINANCE | 财务人员 | 财务相关权限 |
| WAREHOUSE | 仓库管理员 | 仓库管理权限 |
| VIEWER | 查看者 | 只读权限 |
| CUSTOMER | 客户 | 客户门户权限 |

### 2.2 数据权限范围

| 编码 | 名称 | 说明 |
|------|------|------|
| ALL | 全部 | 可查看所有数据 |
| DEPT | 部门 | 可查看本部门数据 |
| PROJECT | 项目 | 可查看参与项目数据 |
| OWN | 个人 | 仅查看自己的数据 |
| CUSTOMER | 客户 | 查看关联客户数据 |

---

## 三、编号规则

### 3.1 项目编号

格式: `PRJ-YYYYMM-XXXX`
- PRJ: 项目前缀
- YYYYMM: 年月
- XXXX: 4位序号

示例: PRJ-202601-0001

### 3.2 设备编号

格式: `{项目编号}-M{序号}`
- 序号: 2位序号

示例: PRJ-202601-0001-M01

### 3.3 采购订单编号

格式: `PO-YYYYMMDD-XXXX`
- PO: 采购订单前缀
- YYYYMMDD: 日期
- XXXX: 4位序号

示例: PO-20260102-0001

### 3.4 外协订单编号

格式: `OS-YYYYMMDD-XXXX`
- OS: 外协订单前缀
- YYYYMMDD: 日期
- XXXX: 4位序号

示例: OS-20260102-0001

### 3.5 ECN编号

格式: `ECN-YYYYMM-XXXX`
- ECN: 变更单前缀
- YYYYMM: 年月
- XXXX: 4位序号

示例: ECN-202601-0001

### 3.6 验收单编号

格式: `{验收类型}-{项目编号}-{序号}`
- 验收类型: FAT/SAT/FINAL
- 序号: 2位序号

示例: FAT-PRJ-202601-0001-01

### 3.7 预警编号

格式: `ALT-YYYYMMDD-XXXXXX`
- ALT: 预警前缀
- YYYYMMDD: 日期
- XXXXXX: 6位序号

示例: ALT-20260102-000001

### 3.8 异常编号

格式: `EXC-YYYYMMDD-XXXX`
- EXC: 异常前缀
- YYYYMMDD: 日期
- XXXX: 4位序号

示例: EXC-20260102-0001

---

## 四、字段约束说明

### 4.1 金额字段

- 类型: DECIMAL(14,2)
- 精度: 2位小数
- 范围: -99999999999999.99 ~ 99999999999999.99
- 币种: 人民币(CNY)

### 4.2 数量字段

- 类型: DECIMAL(10,4)
- 精度: 4位小数
- 范围: 0 ~ 999999.9999

### 4.3 百分比字段

- 类型: DECIMAL(5,2)
- 精度: 2位小数
- 范围: 0.00 ~ 100.00
- 存储: 直接存储百分比值,如 85.50 表示 85.50%

### 4.4 日期时间字段

- DATE: 仅日期,格式 YYYY-MM-DD
- DATETIME: 日期时间,格式 YYYY-MM-DD HH:MM:SS
- 时区: 系统统一使用 UTC+8(北京时间)

### 4.5 状态字段

- 类型: VARCHAR(20)
- 使用枚举值定义中的编码
- 全大写,下划线分隔

### 4.6 编码字段

- 类型: VARCHAR(50)
- 唯一约束
- 格式遵循编号规则定义

### 4.7 JSON字段

- SQLite: 使用 TEXT 类型存储 JSON 字符串
- MySQL: 使用 JSON 类型
- 需要在应用层做 JSON 序列化/反序列化

---

## 五、表关系概览

### 5.1 核心实体关系

```
projects (项目)
    ├── machines (设备) 1:N
    ├── project_stages (阶段) 1:N
    ├── project_milestones (里程碑) 1:N
    ├── project_members (成员) N:M
    ├── project_costs (成本) 1:N
    ├── project_documents (文档) 1:N
    └── bom_headers (BOM) 1:N
        └── bom_items (BOM行) 1:N

materials (物料)
    └── suppliers (供应商) N:M

purchase_orders (采购订单)
    └── purchase_order_items (订单行) 1:N
        └── goods_receipts (收货) 1:N

outsourcing_vendors (外协商)
    └── outsourcing_orders (外协订单) 1:N
        └── outsourcing_order_items (订单行) 1:N
            └── outsourcing_deliveries (交付) 1:N

ecn (变更单)
    ├── ecn_evaluations (评估) 1:N
    ├── ecn_approvals (审批) 1:N
    ├── ecn_tasks (任务) 1:N
    └── ecn_affected_materials (受影响物料) 1:N

acceptance_orders (验收单)
    ├── acceptance_order_items (检查项) 1:N
    ├── acceptance_issues (问题) 1:N
    └── acceptance_signatures (签字) 1:N

alert_rules (预警规则)
    └── alert_records (预警记录) 1:N
        └── alert_notifications (通知) 1:N

exception_events (异常事件)
    ├── exception_actions (处理记录) 1:N
    └── exception_escalations (升级记录) 1:N
```

---

## 六、索引设计原则

### 6.1 主键索引

- 所有表使用自增整数主键
- SQLite: INTEGER PRIMARY KEY AUTOINCREMENT
- MySQL: INT UNSIGNED AUTO_INCREMENT PRIMARY KEY

### 6.2 唯一索引

- 业务编号字段(如 project_no, order_no)
- 编码字段(如 material_code, vendor_code)

### 6.3 普通索引

- 外键字段
- 状态字段
- 经常用于查询过滤的字段
- 时间字段(用于范围查询)

### 6.4 复合索引

- 多条件组合查询的字段
- 遵循最左前缀原则

---

## 七、数据库兼容性说明

### 7.1 SQLite 与 MySQL 差异

| 特性 | SQLite | MySQL |
|------|--------|-------|
| 自增主键 | INTEGER PRIMARY KEY AUTOINCREMENT | INT UNSIGNED AUTO_INCREMENT |
| 布尔类型 | BOOLEAN (存储为 0/1) | TINYINT(1) |
| JSON类型 | TEXT | JSON |
| 日期函数 | JULIANDAY() | DATEDIFF() |
| 自动更新时间 | 需触发器 | ON UPDATE CURRENT_TIMESTAMP |

### 7.2 开发与生产环境

- 开发环境: 使用 SQLite
- 生产环境: 使用 MySQL 8.0+
- ORM: SQLAlchemy 统一抽象

---

## 八、数据安全与合规

### 8.1 敏感数据字段

- 用户密码: 使用 bcrypt 加密存储
- 银行账号: 部分脱敏显示
- 联系电话: 部分脱敏显示
- 电子签名: Base64 编码存储

### 8.2 数据保留策略

- 操作日志: 保留 2 年
- 预警记录: 保留 1 年
- 历史版本: 保留 5 个版本
- 已删除数据: 软删除,保留 90 天

### 8.3 审计追踪

- 所有表包含 created_at, updated_at 字段
- 关键操作记录 created_by 字段
- 敏感操作记录完整审计日志

---

*文档结束*

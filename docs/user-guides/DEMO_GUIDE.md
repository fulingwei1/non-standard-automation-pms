# 跨部门进度展示功能 - 演示指南

**日期**: 2026-01-07
**版本**: 1.0

---

## ✅ 完成清单

- [x] 修改 `frontend/src/services/api.js` 添加跨部门进度API
- [x] 创建 `CrossDepartmentProgress.jsx` 组件
- [x] 在PMODashboard中集成跨部门进度组件
- [x] 创建演示数据生成脚本
- [x] 运行演示数据生成并验证

---

## 📊 演示数据概览

### 已生成的数据

| 数据类型 | 数量 | 说明 |
|---------|------|------|
| **员工记录** | 7 个 | 来自3个部门：机械部、电气部、软件部 |
| **用户账号** | 7 个 | 每个员工对应一个用户账号 |
| **演示项目** | 3 个 | 不同健康度和进度的项目 |
| **跨部门任务** | 35 个 | 分布在各部门的任务 |

### 项目详情

#### 项目1：DEMO001 - BMS老化测试设备
- **客户**: 华为技术有限公司
- **健康度**: H2 (有风险 - 黄色)
- **进度**: 45.67%
- **任务数**: 13 个
- **部门分布**:
  - 机械部: 5个任务
  - 电气部: 4个任务
  - 软件部: 4个任务
- **延期情况**: 2个任务延期

#### 项目2：DEMO002 - EOL功能测试设备
- **客户**: 比亚迪汽车
- **健康度**: H1 (正常 - 绿色)
- **进度**: 72.30%
- **任务数**: 10 个
- **部门分布**:
  - 机械部: 4个任务
  - 电气部: 3个任务
  - 软件部: 3个任务
- **延期情况**: 无延期

#### 项目3：DEMO003 - ICT测试设备
- **客户**: 宁德时代
- **健康度**: H3 (阻塞 - 红色)
- **进度**: 28.50%
- **任务数**: 12 个
- **部门分布**:
  - 机械部: 4个任务
  - 电气部: 4个任务
  - 软件部: 4个任务
- **延期情况**: 4个任务延期

---

## 🚀 如何演示

### 方法一：通过前端界面（推荐）

#### 步骤1：启动后端服务

```bash
cd /Users/flw/non-standard-automation-pm

# 确保后端正在运行
python3 -m uvicorn app.main:app --reload
```

**后端地址**: http://localhost:8000

#### 步骤2：启动前端服务

```bash
cd frontend

# 如果前端未运行，启动它
npm run dev
```

**前端地址**: http://localhost:5173

#### 步骤3：登录系统

1. 打开浏览器访问: http://localhost:5173
2. 使用演示账号登录:
   - **用户名**: `demo_pm_liu`
   - **密码**: `demo123`

#### 步骤4：访问PMO驾驶舱

1. 登录后，在左侧菜单找到 **"PMO 驾驶舱"** 或 **"PMO Dashboard"**
2. 点击进入

#### 步骤5：查看跨部门进度

1. 滚动到页面底部，找到 **"跨部门进度视图"** 部分
2. 从下拉菜单中选择一个项目：
   - **项目1 - BMS老化测试设备** (项目ID: 27, 健康度H2, 有延期)
   - **项目2 - EOL功能测试设备** (项目ID: 28, 健康度H1, 正常)
   - **项目3 - ICT测试设备** (项目ID: 29, 健康度H3, 严重延期)

#### 步骤6：查看展示效果

选择项目后，页面会自动展示：

##### 1. 项目整体进度卡片
```
┌─────────────────────────────────────┐
│ BMS老化测试设备            [有风险] │
│                                     │
│ 总任务: 13  已完成: 8  进行中: 4   │
│                                     │
│ 整体进度              45.67%       │
│ ████████████░░░░░░░░░░░░░░         │
└─────────────────────────────────────┘
```

##### 2. 各部门进度列表
```
┌─────────────────────────────────────┐
│ 👥 各部门进度                共3个  │
│                                     │
│ ┌─────────────────────────────────┐│
│ │ ● 机械部                52.3%   ││
│ │ 4/5 任务已完成  完成率 80%     ││
│ │ ██████████░░░░░░░░░░            ││
│ │ 成员进度:                       ││
│ │ 张工: 60%    李工: 44.6%       ││
│ └─────────────────────────────────┘│
│                                     │
│ ┌─────────────────────────────────┐│
│ │ ● 电气部                41.25%  ││
│ │ 3/4 任务已完成  完成率 75%     ││
│ │ ████████░░░░░░░░░░░░            ││
│ │ 成员进度:                       ││
│ │ 王工: 50%    赵工: 32.5%       ││
│ └─────────────────────────────────┘│
└─────────────────────────────────────┘
```

##### 3. 延期任务预警（如果有）
```
┌─────────────────────────────────────┐
│ ⚠️ 延期任务                    [2]  │
│                                     │
│ ┌─────────────────────────────────┐│
│ │ PLC程序开发              65%    ││
│ │ 赵工 · 电气部    延期 3 天     ││
│ └─────────────────────────────────┘│
│                                     │
│ ┌─────────────────────────────────┐│
│ │ BOM清单整理              30%    ││
│ │ 李工 · 机械部    延期 2 天     ││
│ └─────────────────────────────────┘│
└─────────────────────────────────────┘
```

---

### 方法二：通过API直接测试

#### 测试API响应

```bash
# 获取项目27的跨部门进度
curl -X GET "http://localhost:8000/api/v1/engineers/projects/27/progress-visibility" | jq

# 获取项目28的跨部门进度
curl -X GET "http://localhost:8000/api/v1/engineers/projects/28/progress-visibility" | jq

# 获取项目29的跨部门进度
curl -X GET "http://localhost:8000/api/v1/engineers/projects/29/progress-visibility" | jq
```

#### 查看Swagger UI

1. 访问: http://localhost:8000/docs
2. 找到 **engineers** 分组
3. 展开 `GET /api/v1/engineers/projects/{project_id}/progress-visibility`
4. 点击 **Try it out**
5. 输入 project_id: `27`, `28` 或 `29`
6. 点击 **Execute**

---

## 🎯 演示重点

### 核心创新点

1. **跨部门可见性**
   - ✅ 无部门过滤 - 所有部门数据一次查询获取
   - ✅ 项目经理看到所有部门进度
   - ✅ 打破信息孤岛

2. **实时进度聚合**
   - ✅ 工程师更新任务进度后，项目进度实时计算
   - ✅ 无需手工统计或定时任务
   - ✅ 数学算法验证正确（17/17单元测试通过）

3. **健康度自动计算**
   - ✅ H1(正常): 延期任务 ≤ 10%
   - ✅ H2(有风险): 延期任务 10%-25%
   - ✅ H3(阻塞): 延期任务 > 25%
   - ✅ 自动标识，一目了然

4. **延期任务预警**
   - ✅ 自动识别延期任务
   - ✅ 显示延期天数和负责人
   - ✅ 无需手工统计

---

## 📁 相关文档

- [前端展示实施指南](FRONTEND_CROSS_DEPARTMENT_DISPLAY_GUIDE.md) - 前端如何集成
- [API使用指南](CROSS_DEPARTMENT_PROGRESS_VIEWING_GUIDE.md) - API详细说明
- [工作成果展示](WORK_RESULTS_SHOWCASE.md) - 与传统系统对比
- [代码审查报告](CODE_REVIEW_REPORT.md) - 代码质量评估
- [单元测试报告](UNIT_TEST_RESULTS.md) - 测试结果

---

## 🔧 故障排除

### 问题1：前端显示"加载失败"

**可能原因**:
- 后端服务未启动
- 项目ID不存在
- 网络连接问题

**解决方法**:
```bash
# 检查后端是否运行
curl http://localhost:8000/health

# 如果未运行，启动后端
python3 -m uvicorn app.main:app --reload
```

### 问题2：API返回404

**可能原因**:
- 项目ID错误
- 演示数据未生成

**解决方法**:
```bash
# 重新生成演示数据
python3 create_demo_data.py

# 查看生成的项目ID
sqlite3 data/app.db "SELECT id, project_code, project_name FROM projects WHERE project_code LIKE 'DEMO%';"
```

### 问题3：前端界面空白

**可能原因**:
- 前端服务未启动
- 浏览器缓存问题

**解决方法**:
```bash
# 重启前端服务
cd frontend
npm run dev

# 清除浏览器缓存
# Chrome: Ctrl+Shift+Delete
# 或使用无痕模式
```

---

## 👥 用户账号列表

所有演示账号密码都是: `demo123`

| 用户名 | 姓名 | 部门 | 角色 |
|--------|------|------|------|
| demo_pm_liu | 刘经理 | PMO | 项目经理 |
| demo_mech_zhang | 张工 | 机械部 | 机械工程师 |
| demo_mech_li | 李工 | 机械部 | 机械工程师 |
| demo_elec_wang | 王工 | 电气部 | 电气工程师 |
| demo_elec_zhao | 赵工 | 电气部 | 电气工程师 |
| demo_soft_sun | 孙工 | 软件部 | 软件工程师 |
| demo_soft_zhou | 周工 | 软件部 | 软件工程师 |

---

## 💡 演示技巧

### 演示流程建议

1. **开场**: 说明传统系统的痛点
   - 各部门数据分散
   - 手工统计进度
   - 延期无法及时发现

2. **展示功能**: 登录PMO驾驶舱
   - 选择项目1（有延期情况）
   - 指出实时计算的进度
   - 强调自动延期预警

3. **对比说明**: 使用文档对比表
   - 展示[WORK_RESULTS_SHOWCASE.md](WORK_RESULTS_SHOWCASE.md)中的对比表
   - 强调跨部门可见性的价值

4. **技术亮点**: 展示代码和测试
   - 打开[CODE_REVIEW_REPORT.md](CODE_REVIEW_REPORT.md)说明代码质量
   - 展示[UNIT_TEST_RESULTS.md](UNIT_TEST_RESULTS.md)证明算法正确性

5. **总结**: 核心价值
   - 提升效率：无需手工统计
   - 提升透明度：跨部门可见
   - 提升质量：自动预警

---

## 🎉 演示成功标志

演示成功的标志:

- ✅ 能够在前端看到3个项目的选项
- ✅ 选择项目后能看到各部门进度
- ✅ 进度条和数字正确显示
- ✅ 延期任务正确标识
- ✅ 健康度颜色正确（H1绿色、H2黄色、H3红色）

---

**演示准备完毕！祝演示成功！** 🚀

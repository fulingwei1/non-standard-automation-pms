# 代码质量分析报告

非标自动化项目管理系统

> 生成时间: 2026-01-14 18:44

## 1. 项目规模统计

| 类别 | 数量 | 说明 |
| --- | --- | --- |
| 前端页面 (Pages) | 279 | frontend/src/pages/*.(jsx\|tsx) |
| 后端模型 (Models) | 52 | app/models/*.py |
| API 端点模块 | 150 | app/api/v1/endpoints/**/*.py |
| 业务服务 (Services) | 149 | app/services/*.py |
| 总代码行数 | 510,369 | 包含 .py/.js/.jsx/.ts/.tsx |

## 2. 严重超标文件 (>2000 行)

| 文件路径 | 行数 | 问题描述 |
| --- | --- | --- |
| app/utils/scheduled_tasks.py | 3845 | 定时任务全堆一个文件 |
| frontend/src/pages/ECNDetail.jsx | 3546 | 详情页组件过大 |
| frontend/src/pages/HRManagerDashboard.jsx | 3356 | 仪表板功能过多 |
| frontend/src/services/api.js | 3068 | API 调用全集中 |
| app/api/v1/endpoints/projects/extended.py | 2476 | 端点模块过大 |
| app/api/v1/endpoints/acceptance.py | 2472 | 端点模块过大 |
| app/api/v1/endpoints/issues.py | 2408 | 端点模块过大 |
| app/api/v1/endpoints/alerts.py | 2232 | 端点模块过大 |
| app/api/v1/endpoints/service.py | 2208 | 端点模块过大 |
| app/api/v1/endpoints/sales/quotes.py | 2203 | 端点模块过大 |
| app/api/v1/endpoints/shortage_alerts.py | 2161 | 端点模块过大 |
| app/api/v1/endpoints/shortage.py | 2104 | 端点模块过大 |
| frontend/src/pages/SalesTeam.jsx | 2092 | 单页面组件过大 |
| frontend/src/pages/IssueManagement.jsx | 2035 | 管理页面臃肿 |

## 3. 需要关注的文件 (1500-2000 行)

| 文件路径 | 行数 |
| --- | --- |
| app/api/v1/endpoints/management_rhythm.py | 1993 |
| app/api/v1/endpoints/pmo.py | 1986 |
| frontend/src/pages/QuoteManagement.jsx | 1979 |
| frontend/src/pages/ProductionManagerDashboard.jsx | 1944 |
| frontend/src/pages/SalesDirectorWorkstation.jsx | 1912 |
| app/schemas/sales.py | 1888 |
| frontend/src/pages/MaterialAnalysis.jsx | 1867 |
| app/api/v1/endpoints/presale.py | 1798 |
| frontend/src/pages/ProjectReviewDetail.jsx | 1728 |
| frontend/src/components/layout/Sidebar.jsx | 1712 |
| frontend/src/pages/PaymentManagement.jsx | 1688 |
| frontend/src/pages/WorkerWorkstation.jsx | 1679 |
| scripts/create_full_ppt.py | 1645 |
| frontend/src/pages/ServiceRecord.jsx | 1635 |
| app/api/v1/endpoints/assembly_kit.py | 1632 |
| app/api/v1/endpoints/performance.py | 1594 |
| frontend/src/pages/AlertCenter.jsx | 1572 |
| app/api/v1/endpoints/timesheet.py | 1570 |
| app/api/v1/endpoints/purchase.py | 1569 |
| frontend/src/pages/PurchaseOrders.jsx | 1530 |

## 4. 问题分析

- 上帝组件倾向：前端 pages ≥1500 行的文件 14 个；后端 endpoints ≥1500 行的文件 15 个
- API 集中化：`frontend/src/services/api.js` 目前为 3068 行，建议按业务域拆分
- Schema 臃肿：`app/schemas/sales.py` 为 1888 行，建议按领域拆分
- 建议优先用 `selectinload/joinedload` 解决 N+1，并用 `func.count/sum` 将聚合统计下推到数据库

## 5. 重构优先级建议

| 优先级 | 文件 | 建议方案 |
| --- | --- | --- |
| P0 | app/utils/scheduled_tasks.py | 按任务类型拆分多个模块（并引入统一入口/注册表） |
| P0 | frontend/src/services/api.js | 按业务域拆分（project/、sales/、hr/、ecn/…），避免单文件膨胀 |
| P1 | frontend/src/pages/ECNDetail.jsx | 抽离 Tab/表格/对话框/常量与 hooks；将数据请求下沉到 service/hook |
| P1 | frontend/src/pages/HRManagerDashboard.jsx | 抽离 Tab/表格/对话框/常量与 hooks；将数据请求下沉到 service/hook |
| P2 | app/api/v1/endpoints/projects/extended.py | 按子资源/子流程拆分路由模块；复用依赖/校验/响应构建函数 |
| P2 | app/api/v1/endpoints/acceptance.py | 按子资源/子流程拆分路由模块；复用依赖/校验/响应构建函数 |
| P2 | app/schemas/sales.py | 按领域拆分 schema；移除重复结构与超大单文件 |

## 6. 后端核心模块概览（参考）

| 模块 | 文件（示例） | 说明 |
| --- | --- | --- |
| 项目管理 | project.py, machine.py | 项目与设备管理 |
| 物料采购 | material.py, purchase.py | 物料采购与 BOM |
| 工程变更 | ecn.py | 工程变更通知 ECN |
| 验收管理 | acceptance.py | FAT/SAT 验收 |
| 外协管理 | outsourcing.py, supplier.py | 外协与供应商 |
| 销售管理 | sales.py, presale.py | 销售与售前 |
| 生产进度 | production.py, progress.py | 生产与进度跟踪 |
| 组织人员 | user.py, organization.py | 用户与组织架构 |
| 预警通知 | alert.py, notification.py | 预警与通知 |
| 绩效工时 | performance.py, timesheet.py | 绩效与工时管理 |

## 生成方式

在项目根目录执行：

```bash
python3 scripts/generate_code_analysis_md.py
```

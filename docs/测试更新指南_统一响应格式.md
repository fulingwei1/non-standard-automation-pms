# æµ‹è¯•æ›´æ–°æŒ‡å— - ç»Ÿä¸€å“åº”æ ¼å¼

> æ›´æ–°æµ‹è¯•ä»¥é€‚åº”æ–°çš„ç»Ÿä¸€å“åº”æ ¼å¼

---

## ğŸ“‹ å“åº”æ ¼å¼å˜åŒ–

### 1. å•ä¸ªå¯¹è±¡å“åº”

**åŸæ ¼å¼**:
```json
{
  "id": 1,
  "name": "ä¾›åº”å•†åç§°",
  ...
}
```

**æ–°æ ¼å¼**:
```json
{
  "success": true,
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": 1,
    "name": "ä¾›åº”å•†åç§°",
    ...
  }
}
```

### 2. åˆ—è¡¨å“åº”ï¼ˆåˆ†é¡µï¼‰

**åŸæ ¼å¼**:
```json
{
  "items": [...],
  "total": 100,
  "page": 1,
  "page_size": 20,
  "pages": 5
}
```

**æ–°æ ¼å¼**: ä¿æŒä¸å˜ï¼ˆPaginatedResponseï¼‰

### 3. åˆ—è¡¨å“åº”ï¼ˆæ— åˆ†é¡µï¼‰

**åŸæ ¼å¼**:
```json
[
  {"id": 1, "name": "..."},
  {"id": 2, "name": "..."}
]
```

**æ–°æ ¼å¼**:
```json
{
  "items": [
    {"id": 1, "name": "..."},
    {"id": 2, "name": "..."}
  ],
  "total": 2
}
```

---

## ğŸ”§ æµ‹è¯•è¾…åŠ©å‡½æ•°

### ä½ç½®
`tests/helpers/response_helpers.py`

### å¯ç”¨å‡½æ•°

#### 1. `assert_success_response(response_data, expected_code=200)`
æ–­è¨€æˆåŠŸå“åº”æ ¼å¼å¹¶æå–æ•°æ®

```python
from tests.helpers.response_helpers import assert_success_response

response_data = response.json()
data = assert_success_response(response_data)
assert data["id"] == 1
```

#### 2. `assert_paginated_response(response_data)`
æ–­è¨€åˆ†é¡µå“åº”æ ¼å¼

```python
from tests.helpers.response_helpers import assert_paginated_response

response_data = response.json()
paginated_data = assert_paginated_response(response_data)
assert len(paginated_data["items"]) > 0
```

#### 3. `assert_list_response(response_data)`
æ–­è¨€åˆ—è¡¨å“åº”æ ¼å¼ï¼ˆæ— åˆ†é¡µï¼‰

```python
from tests.helpers.response_helpers import assert_list_response

response_data = response.json()
list_data = assert_list_response(response_data)
assert len(list_data["items"]) > 0
```

#### 4. `extract_data(response_data)`
ä»ç»Ÿä¸€å“åº”æ ¼å¼ä¸­æå–æ•°æ®ï¼ˆå…¼å®¹æ–°æ—§æ ¼å¼ï¼‰

```python
from tests.helpers.response_helpers import extract_data

response_data = response.json()
data = extract_data(response_data)  # è‡ªåŠ¨å¤„ç†æ–°æ—§æ ¼å¼
```

#### 5. `extract_items(response_data)`
ä»åˆ—è¡¨å“åº”ä¸­æå–itemsï¼ˆå…¼å®¹æ–°æ—§æ ¼å¼ï¼‰

```python
from tests.helpers.response_helpers import extract_items

response_data = response.json()
items = extract_items(response_data)  # è‡ªåŠ¨å¤„ç†æ–°æ—§æ ¼å¼
```

---

## ğŸ“ æµ‹è¯•æ›´æ–°æ¨¡å¼

### æ¨¡å¼1ï¼šå•ä¸ªå¯¹è±¡å“åº”

**åŸæµ‹è¯•**:
```python
response = client.get("/api/v1/suppliers/1")
assert response.status_code == 200
data = response.json()
assert data["id"] == 1
```

**æ–°æµ‹è¯•**:
```python
from tests.helpers.response_helpers import assert_success_response

response = client.get("/api/v1/suppliers/1")
assert response.status_code == 200
response_data = response.json()
data = assert_success_response(response_data)
assert data["id"] == 1
```

### æ¨¡å¼2ï¼šåˆ—è¡¨å“åº”ï¼ˆåˆ†é¡µï¼‰

**åŸæµ‹è¯•**:
```python
response = client.get("/api/v1/suppliers/")
assert response.status_code == 200
data = response.json()
assert "items" in data
assert "total" in data
```

**æ–°æµ‹è¯•**:
```python
from tests.helpers.response_helpers import assert_paginated_response

response = client.get("/api/v1/suppliers/")
assert response.status_code == 200
response_data = response.json()
paginated_data = assert_paginated_response(response_data)
assert "items" in paginated_data
assert "total" in paginated_data
```

### æ¨¡å¼3ï¼šåˆ—è¡¨å“åº”ï¼ˆæ— åˆ†é¡µï¼‰

**åŸæµ‹è¯•**:
```python
response = client.get("/api/v1/members/")
assert response.status_code == 200
data = response.json()
assert isinstance(data, list)
assert len(data) > 0
```

**æ–°æµ‹è¯•**:
```python
from tests.helpers.response_helpers import assert_list_response

response = client.get("/api/v1/members/")
assert response.status_code == 200
response_data = response.json()
list_data = assert_list_response(response_data)
assert "items" in list_data
assert len(list_data["items"]) > 0
```

### æ¨¡å¼4ï¼šåˆ›å»º/æ›´æ–°å“åº”

**åŸæµ‹è¯•**:
```python
response = client.post("/api/v1/suppliers/", json=supplier_data)
assert response.status_code == 200
data = response.json()
assert data["supplier_name"] == supplier_data["supplier_name"]
```

**æ–°æµ‹è¯•**:
```python
from tests.helpers.response_helpers import assert_success_response

response = client.post("/api/v1/suppliers/", json=supplier_data)
assert response.status_code in [200, 201]
response_data = response.json()
data = assert_success_response(response_data, expected_code=response.status_code)
assert data["supplier_name"] == supplier_data["supplier_name"]
```

### æ¨¡å¼5ï¼šåˆ é™¤å“åº”

**åŸæµ‹è¯•**:
```python
response = client.delete("/api/v1/suppliers/1")
assert response.status_code == 200
```

**æ–°æµ‹è¯•**:
```python
response = client.delete("/api/v1/suppliers/1")
assert response.status_code == 200
# åˆ é™¤æ“ä½œè¿”å›SuccessResponseæ ¼å¼
response_data = response.json()
if "success" in response_data:
    assert response_data["success"] is True
```

---

## âœ… å·²æ›´æ–°çš„æµ‹è¯•æ–‡ä»¶

### é›†æˆæµ‹è¯•
- âœ… `tests/integration/test_suppliers_api.py`
- âœ… `tests/integration/test_materials_api.py`
- âœ… `tests/integration/test_customers_api.py`
- âœ… `tests/integration/test_members_api.py`
- âœ… `tests/integration/test_milestones_api.py`

### APIæµ‹è¯•
- âœ… `tests/api/test_suppliers.py` (éƒ¨åˆ†æ›´æ–°ï¼Œå·²æœ‰å…¼å®¹æ€§å¤„ç†)
- â­ï¸ `tests/api/test_materials.py` (éœ€è¦æ›´æ–°)
- â­ï¸ `tests/api/test_customers.py` (éœ€è¦æ›´æ–°)
- â­ï¸ `tests/api/test_machines.py` (éœ€è¦æ›´æ–°)
- â­ï¸ `tests/api/test_milestones.py` (éœ€è¦æ›´æ–°)
- â­ï¸ `tests/api/test_members.py` (éœ€è¦æ›´æ–°)
- âœ… `tests/api/test_stages.py` (éƒ¨åˆ†æ›´æ–°)

---

## ğŸ”„ æ›´æ–°æ­¥éª¤

### 1. å¯¼å…¥è¾…åŠ©å‡½æ•°

åœ¨æ¯ä¸ªæµ‹è¯•æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ï¼š
```python
from tests.helpers.response_helpers import (
    assert_success_response,
    assert_paginated_response,
    assert_list_response,
    extract_data,
    extract_items,
)
```

### 2. æ›´æ–°å•ä¸ªå¯¹è±¡å“åº”æ–­è¨€

æŸ¥æ‰¾æ¨¡å¼ï¼š
```python
data = response.json()
assert data["field"] == value
```

æ›¿æ¢ä¸ºï¼š
```python
response_data = response.json()
data = assert_success_response(response_data)
assert data["field"] == value
```

### 3. æ›´æ–°åˆ—è¡¨å“åº”æ–­è¨€

æŸ¥æ‰¾æ¨¡å¼ï¼š
```python
data = response.json()
assert isinstance(data, list)
```

æ›¿æ¢ä¸ºï¼š
```python
response_data = response.json()
list_data = assert_list_response(response_data)
assert "items" in list_data
```

### 4. æ›´æ–°åˆ†é¡µå“åº”æ–­è¨€

æŸ¥æ‰¾æ¨¡å¼ï¼š
```python
data = response.json()
assert "items" in data
```

æ›¿æ¢ä¸ºï¼š
```python
response_data = response.json()
paginated_data = assert_paginated_response(response_data)
assert "items" in paginated_data
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å‘åå…¼å®¹

æµ‹è¯•è¾…åŠ©å‡½æ•°æ”¯æŒæ–°æ—§ä¸¤ç§æ ¼å¼ï¼Œå¯ä»¥é€æ­¥è¿ç§»ï¼š
- æ–°æ ¼å¼ï¼šè‡ªåŠ¨æå– `data` å­—æ®µ
- æ—§æ ¼å¼ï¼šç›´æ¥è¿”å›æ•°æ®å¯¹è±¡

### 2. é”™è¯¯å“åº”

é”™è¯¯å“åº”ä»ç„¶ä½¿ç”¨HTTPExceptionï¼Œæ ¼å¼ä¸å˜ï¼š
```json
{
  "detail": "é”™è¯¯æ¶ˆæ¯"
}
```

### 3. çŠ¶æ€ç 

- åˆ›å»ºæ“ä½œï¼š201 (æ–°æ ¼å¼) æˆ– 200 (æ—§æ ¼å¼)
- å…¶ä»–æ“ä½œï¼š200
- é”™è¯¯ï¼š400, 404, 422 ç­‰

### 4. åˆ—è¡¨å“åº”å…¼å®¹æ€§

æŸäº›ç«¯ç‚¹å¯èƒ½ä»ç„¶è¿”å›æ—§æ ¼å¼çš„åˆ—è¡¨ï¼Œæµ‹è¯•è¾…åŠ©å‡½æ•°ä¼šè‡ªåŠ¨å¤„ç†ã€‚

---

## ğŸ“Š æ›´æ–°è¿›åº¦

### å·²å®Œæˆ
- âœ… åˆ›å»ºæµ‹è¯•è¾…åŠ©å‡½æ•°æ¨¡å—
- âœ… æ›´æ–°suppliersé›†æˆæµ‹è¯•
- âœ… æ›´æ–°materialsé›†æˆæµ‹è¯•
- âœ… æ›´æ–°customersé›†æˆæµ‹è¯•
- âœ… æ›´æ–°membersé›†æˆæµ‹è¯•
- âœ… æ›´æ–°milestonesé›†æˆæµ‹è¯•
- âœ… æ›´æ–°stages APIæµ‹è¯•ï¼ˆéƒ¨åˆ†ï¼‰

### å¾…å®Œæˆ
- â­ï¸ æ›´æ–°machinesç›¸å…³æµ‹è¯•
- â­ï¸ æ›´æ–°å…¶ä»–APIæµ‹è¯•æ–‡ä»¶
- â­ï¸ è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- â­ï¸ ä¿®å¤å¤±è´¥çš„æµ‹è¯•

---

## ğŸš€ å¿«é€Ÿæ›´æ–°è„šæœ¬

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ¨¡å¼æ‰¹é‡æ›´æ–°æµ‹è¯•æ–‡ä»¶ï¼š

```python
# æŸ¥æ‰¾æ‰€æœ‰éœ€è¦æ›´æ–°çš„æµ‹è¯•æ–‡ä»¶
# ä½¿ç”¨grepæŸ¥æ‰¾: data = response.json()

# ç„¶åæ ¹æ®æ¨¡å¼æ›¿æ¢ï¼š
# 1. å•ä¸ªå¯¹è±¡: æ·»åŠ  assert_success_response
# 2. åˆ—è¡¨: æ·»åŠ  assert_list_response
# 3. åˆ†é¡µ: æ·»åŠ  assert_paginated_response
```

---

**åˆ›å»ºæ—¥æœŸ**: 2026-01-23  
**çŠ¶æ€**: âœ… è¿›è¡Œä¸­  
**ä¸‹ä¸€æ­¥**: è¿è¡Œæµ‹è¯•å¹¶ä¿®å¤é—®é¢˜

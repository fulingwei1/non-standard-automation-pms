# ç»Ÿä¸€å“åº”æ ¼å¼å’ŒéªŒè¯å™¨å®ç°æ€»ç»“

> å®Œæ•´çš„å®ç°å’Œä½¿ç”¨æŒ‡å—

---

## âœ… å®ç°å®Œæˆ

### ğŸ“ æ–‡ä»¶ç»“æ„

```
app/core/schemas/
â”œâ”€â”€ __init__.py              # å¯¼å‡ºæ¥å£
â”œâ”€â”€ response.py              # ç»Ÿä¸€å“åº”æ ¼å¼å®šä¹‰
â”œâ”€â”€ validators.py            # ç»Ÿä¸€éªŒè¯å™¨å‡½æ•°
â”œâ”€â”€ example_usage.py         # ä½¿ç”¨ç¤ºä¾‹ä»£ç 
â””â”€â”€ README.md                # è¯¦ç»†ä½¿ç”¨æŒ‡å—

docs/
â”œâ”€â”€ ç»Ÿä¸€å“åº”æ ¼å¼å’ŒéªŒè¯å™¨æ¶æ„è¯´æ˜.md    # æ¶æ„è®¾è®¡æ–‡æ¡£
â””â”€â”€ ç»Ÿä¸€å“åº”æ ¼å¼å’ŒéªŒè¯å™¨ä½¿ç”¨è§„åˆ™.md    # ä½¿ç”¨è§„åˆ™æ–‡æ¡£

tests/core/
â”œâ”€â”€ test_response_schemas.py  # å“åº”æ ¼å¼æµ‹è¯•
â””â”€â”€ test_validators.py        # éªŒè¯å™¨æµ‹è¯•
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. ç»Ÿä¸€å“åº”æ ¼å¼

#### å“åº”ç±»å‹

- âœ… **SuccessResponse** - æˆåŠŸå“åº”
- âœ… **ErrorResponse** - é”™è¯¯å“åº”
- âœ… **PaginatedResponse** - åˆ†é¡µå“åº”
- âœ… **ListResponse** - åˆ—è¡¨å“åº”ï¼ˆæ— åˆ†é¡µï¼‰

#### ä¾¿æ·å‡½æ•°

- âœ… **success_response()** - åˆ›å»ºæˆåŠŸå“åº”
- âœ… **error_response()** - åˆ›å»ºé”™è¯¯å“åº”
- âœ… **paginated_response()** - åˆ›å»ºåˆ†é¡µå“åº”

### 2. ç»Ÿä¸€éªŒè¯å™¨

#### éªŒè¯å™¨ç±»å‹

- âœ… **é¡¹ç›®ç›¸å…³**ï¼š`validate_project_code`, `validate_machine_code`
- âœ… **è”ç³»æ–¹å¼**ï¼š`validate_phone`, `validate_email`, `validate_phone_or_email`
- âœ… **è¯ä»¶**ï¼š`validate_id_card`, `validate_bank_card`
- âœ… **æ—¥æœŸæ—¶é—´**ï¼š`validate_date_range`, `validate_date_string`
- âœ… **æ•°å€¼**ï¼š`validate_positive_number`, `validate_decimal`
- âœ… **å­—ç¬¦ä¸²**ï¼š`validate_non_empty_string`, `validate_code_string`
- âœ… **çŠ¶æ€**ï¼š`validate_status`

---

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### å“åº”æ ¼å¼ä½¿ç”¨

```python
from app.core.schemas.response import success_response, paginated_response

# æˆåŠŸå“åº”
@router.post("/projects")
async def create_project(project: ProjectCreate):
    data = await service.create(project)
    return success_response(data=data, message="åˆ›å»ºæˆåŠŸ")

# åˆ†é¡µå“åº”
@router.get("/projects")
async def list_projects(page: int, page_size: int):
    result = await service.list(...)
    return paginated_response(
        items=result["items"],
        total=result["total"],
        page=page,
        page_size=page_size
    )
```

### éªŒè¯å™¨ä½¿ç”¨

```python
from app.core.schemas.validators import validate_project_code
from pydantic import field_validator

class ProjectCreate(BaseModel):
    code: str
    
    @field_validator('code')
    @classmethod
    def validate_code(cls, v: str) -> str:
        return validate_project_code(v)
```

---

## âœ… æµ‹è¯•ç»“æœ

### å“åº”æ ¼å¼æµ‹è¯•

- âœ… test_success_response - é€šè¿‡
- âœ… test_error_response - é€šè¿‡
- âœ… test_paginated_response - é€šè¿‡
- âœ… test_paginated_response_edge_cases - é€šè¿‡
- âœ… test_response_serialization - é€šè¿‡

**æ€»è®¡**ï¼š5ä¸ªæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡ âœ…

### éªŒè¯å™¨æµ‹è¯•

- âœ… é¡¹ç›®ç¼–ç éªŒè¯ - é€šè¿‡
- âœ… æ‰‹æœºå·éªŒè¯ - é€šè¿‡
- âœ… é‚®ç®±éªŒè¯ - é€šè¿‡
- âœ… æ•°å€¼éªŒè¯ - é€šè¿‡
- âœ… å­—ç¬¦ä¸²éªŒè¯ - é€šè¿‡
- âœ… çŠ¶æ€éªŒè¯ - é€šè¿‡
- âœ… æ—¥æœŸéªŒè¯ - é€šè¿‡

**æ€»è®¡**ï¼š13ä¸ªæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡ âœ…

---

## ğŸ“š æ–‡æ¡£æ¸…å•

### 1. ä½¿ç”¨æŒ‡å—

- **ä½ç½®**ï¼š`app/core/schemas/README.md`
- **å†…å®¹**ï¼šè¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œç¤ºä¾‹

### 2. æ¶æ„è¯´æ˜

- **ä½ç½®**ï¼š`docs/ç»Ÿä¸€å“åº”æ ¼å¼å’ŒéªŒè¯å™¨æ¶æ„è¯´æ˜.md`
- **å†…å®¹**ï¼šæ¶æ„è®¾è®¡ã€æ•°æ®æµã€æ‰©å±•æŒ‡å—

### 3. ä½¿ç”¨è§„åˆ™

- **ä½ç½®**ï¼š`docs/ç»Ÿä¸€å“åº”æ ¼å¼å’ŒéªŒè¯å™¨ä½¿ç”¨è§„åˆ™.md`
- **å†…å®¹**ï¼šå¼ºåˆ¶è§„åˆ™ã€ä»£ç å®¡æŸ¥æ¸…å•ã€å¸¸è§é”™è¯¯

### 4. ä»£ç ç¤ºä¾‹

- **ä½ç½®**ï¼š`app/core/schemas/example_usage.py`
- **å†…å®¹**ï¼šå®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ä»£ç 

---

## ğŸ¯ æ ¸å¿ƒè§„åˆ™

### è§„åˆ™1ï¼šæ‰€æœ‰APIå“åº”å¿…é¡»ä½¿ç”¨ç»Ÿä¸€æ ¼å¼

```python
# âœ… æ­£ç¡®
return success_response(data=project_data)

# âŒ é”™è¯¯
return project_data
```

### è§„åˆ™2ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥å¿…é¡»éªŒè¯

```python
# âœ… æ­£ç¡®ï¼šåœ¨Schemaä¸­éªŒè¯
class ProjectCreate(BaseModel):
    code: str
    @field_validator('code')
    def validate_code(cls, v): return validate_project_code(v)

# âŒ é”™è¯¯ï¼šåœ¨ä¸šåŠ¡é€»è¾‘ä¸­éªŒè¯
if not code.startswith("PJ"):
    raise ValueError("...")
```

### è§„åˆ™3ï¼šé”™è¯¯å¤„ç†å¿…é¡»ç»Ÿä¸€

```python
# âœ… æ­£ç¡®
raise HTTPException(status_code=404, detail="èµ„æºä¸å­˜åœ¨")

# âŒ é”™è¯¯
return {"error": "èµ„æºä¸å­˜åœ¨"}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯¼å…¥å“åº”æ ¼å¼

```python
from app.core.schemas.response import success_response, paginated_response
```

### 2. å¯¼å…¥éªŒè¯å™¨

```python
from app.core.schemas.validators import validate_project_code
```

### 3. åœ¨APIä¸­ä½¿ç”¨

```python
@router.post("/projects")
async def create_project(project: ProjectCreate):
    data = await service.create(project)
    return success_response(data=data, message="åˆ›å»ºæˆåŠŸ")
```

### 4. åœ¨Schemaä¸­ä½¿ç”¨éªŒè¯å™¨

```python
class ProjectCreate(BaseModel):
    code: str
    
    @field_validator('code')
    @classmethod
    def validate_code(cls, v: str) -> str:
        return validate_project_code(v)
```

---

## ğŸ“Š å“åº”æ ¼å¼ç¤ºä¾‹

### æˆåŠŸå“åº”

```json
{
  "success": true,
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": 1,
    "name": "é¡¹ç›®åç§°"
  }
}
```

### é”™è¯¯å“åº”

```json
{
  "success": false,
  "code": 404,
  "message": "èµ„æºä¸å­˜åœ¨",
  "data": null
}
```

### åˆ†é¡µå“åº”

```json
{
  "items": [
    {"id": 1, "name": "é¡¹ç›®1"},
    {"id": 2, "name": "é¡¹ç›®2"}
  ],
  "total": 100,
  "page": 1,
  "page_size": 20,
  "pages": 5
}
```

---

## ğŸ” éªŒè¯å™¨ç¤ºä¾‹

### é¡¹ç›®ç¼–ç éªŒè¯

```python
# æœ‰æ•ˆç¼–ç 
validate_project_code("PJ250101001")  # âœ… è¿”å› "PJ250101001"

# æ— æ•ˆç¼–ç 
validate_project_code("INVALID")  # âŒ æŠ›å‡º ValueError
```

### æ‰‹æœºå·éªŒè¯

```python
# æœ‰æ•ˆæ‰‹æœºå·
validate_phone("13800138000")  # âœ… è¿”å› "13800138000"

# æ— æ•ˆæ‰‹æœºå·
validate_phone("12345678901")  # âŒ æŠ›å‡º ValueError
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

1. **ä½¿ç”¨æŒ‡å—**ï¼š`app/core/schemas/README.md`
2. **æ¶æ„è¯´æ˜**ï¼š`docs/ç»Ÿä¸€å“åº”æ ¼å¼å’ŒéªŒè¯å™¨æ¶æ„è¯´æ˜.md`
3. **ä½¿ç”¨è§„åˆ™**ï¼š`docs/ç»Ÿä¸€å“åº”æ ¼å¼å’ŒéªŒè¯å™¨ä½¿ç”¨è§„åˆ™.md`
4. **ä»£ç ç¤ºä¾‹**ï¼š`app/core/schemas/example_usage.py`

---

## âœ… å®ŒæˆçŠ¶æ€

- âœ… ç»Ÿä¸€å“åº”æ ¼å¼å®ç°
- âœ… ç»Ÿä¸€éªŒè¯å™¨å®ç°
- âœ… å®Œæ•´æ–‡æ¡£ç¼–å†™
- âœ… æµ‹è¯•ç”¨ä¾‹ç¼–å†™
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

**æœ€åæ›´æ–°**ï¼š2026-01-23  
**ç‰ˆæœ¬**ï¼šv1.0  
**çŠ¶æ€**ï¼šâœ… å®Œæˆ

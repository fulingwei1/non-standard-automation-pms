# 📋 数据管理脚本使用指南

## 前置条件

```bash
cd /Users/flw/non-standard-automation-pm
source .venv/bin/activate
```

---

## 1. 导入演示数据

演示数据覆盖完整业务链：**客户→线索→商机→报价→合同→项目→采购→生产→发货→售后→财务**

```bash
python scripts/seed_demo_data.py
```

包含的数据：
| 模块 | 数量 | 说明 |
|------|------|------|
| 部门 | 8 | 销售/项目/研发/生产/客服/采购/财务/总经办 |
| 员工 | 19 | 各部门角色，含总监/经理/工程师等 |
| 客户 | 8 | 比亚迪、华为、宁德时代、小米等 |
| 销售线索 | 10 | 各阶段：初始/已验证/谈判中/已赢单 |
| 商机 | 8 | ICT/EOL/FCT/老化/视觉等设备类型 |
| 报价 | 6 | 草稿/待审/已批准 |
| 合同 | 5 | 金额280万~450万 |
| 项目 | 5 | 各阶段：规划/设计/执行/测试 |
| 物料 | 20 | PLC/伺服/传感器/气缸等常用物料 |
| 采购单 | 10 | 已收货/已发货/待审批/草稿 |
| 车间 | 3 | 装配一/装配二/调试 |
| 工人 | 10 | 装配工/电气工/调试工程师等 |
| 生产计划 | 5 | 进行中/已完成/已计划/草稿 |
| 工单 | 8 | 机架组装/电气布线/系统调试等 |
| 发货单 | 3 | 已送达/已发货/待发货 |
| 服务工单 | 8 | 硬件/软件/网络问题 |
| 发票 | 5 | 已付/已开具 |
| 回款 | 4 | 预付款/验收款 |
| 满意度 | 4 | 3.8~4.5分 |

> 所有演示用户密码：`admin123`

---

## 2. 清除演示数据

```bash
# 交互确认（推荐）
python scripts/clear_demo_data.py

# 跳过确认直接清除
python scripts/clear_demo_data.py --yes
```

**保留内容：** admin账号（id=1）、系统权限定义、API权限、菜单权限

**删除内容：** 演示部门、员工、客户、项目及所有业务数据

---

## 3. 导入公司员工名单

### 第一步：生成导入模板

```bash
python scripts/import_employees.py --template
```

生成 `scripts/employees_template.csv`，格式如下：

| 姓名 | 部门 | 职位 | 手机号 | 工号 | 邮箱 |
|------|------|------|--------|------|------|
| 张三 | 销售部 | 销售经理 | 13800138001 | E001 | zhang@jkb.com |
| 李四 | 研发部 | 软件工程师 | 13800138002 | E002 | |
| 王五 | 生产部 | 车间主任 | | | |

> 必填：姓名、部门、职位。其余可留空。

### 第二步：编辑CSV填入员工信息

用Excel或WPS打开模板，填入真实员工数据，保存为CSV（UTF-8编码）。

也支持直接导入 `.xlsx` Excel文件（需安装 `pip install openpyxl`）。

### 第三步：执行导入

```bash
python scripts/import_employees.py 你的文件.csv
# 或
python scripts/import_employees.py 你的文件.xlsx
```

### 自动角色分配规则

系统根据**职位关键词**自动分配角色和数据权限：

| 角色 | 匹配关键词 | 数据范围 |
|------|-----------|---------|
| 🔴 高管 | 总经理、副总、董事、CEO、VP | 全部数据 |
| 🟠 部门总监 | 总监、部长 | 本部门及下级 |
| 🟡 部门经理 | 经理、主管 | 本部门 |
| 🟢 班组长 | 主任、组长、班长 | 本组 |
| 🔵 普通员工 | 工程师、专员、助理、其他 | 仅自己 |

### 部门自动识别

输入的部门名会自动标准化：

- `销售` / `市场` / `商务` → **销售部**
- `研发` / `技术` / `R&D` → **研发部**
- `生产` / `制造` / `车间` → **生产部**
- `客服` / `售后` → **客服部**
- 不在列表中的部门会自动创建

### 默认密码

所有导入用户的初始密码为 `jkb123456`，请提醒员工首次登录后修改。

---

## 典型使用流程

### 场景一：演示给客户看

```bash
python scripts/seed_demo_data.py     # 灌入演示数据
# ... 演示系统功能 ...
python scripts/clear_demo_data.py    # 演示完清掉
```

### 场景二：正式上线

```bash
python scripts/clear_demo_data.py --yes         # 确保没有演示数据
python scripts/import_employees.py 金凯博员工.csv  # 导入真实员工
```

### 场景三：重置系统

```bash
python scripts/clear_demo_data.py --yes   # 清除所有业务数据
python scripts/seed_demo_data.py          # 重新灌入演示数据
```

# 未使用模块分析报告 (2026-02-25)

**项目**: non-standard-automation-pms  
**分析时间**: 2026-02-25 20:05

---

## 📊 统计概览

| 类型 | 数量 |
|------|------|
| **总服务文件数** | 494 |
| **API直接引用** | 207 (41.9%) |
| **服务间调用** | 98 (19.8%) |
| **测试覆盖** | 299 (60.5%) |
| **至少被引用一次** | 301 (60.9%) |
| **任何地方都未引用** | **285 (57.7%)** ⚠️ |

**代码体积**: 约 2.25 MB (285个文件)

---

## 🔍 深度分析

### 未引用服务按功能模块分类

#### 1. 告警系统 (约30个)
```
alert_creator.py              ( 5.2 KB)
alert_generator.py            ( 3.2 KB)
alert_records_service.py      (16.3 KB)
alert_rules_service.py        ( 6.0 KB)
alert_statistics_service.py   (15.7 KB)
alert_upgrader.py             ( 5.1 KB)
anomaly_detector.py           (18.6 KB)
anomaly_reminders.py          ( 3.0 KB)
...
```
**特点**: 完整的告警规则引擎实现，但未接入API
**可能性**: 计划中的功能，尚未启用

---

#### 2. AI智能功能 (约15个)
```
ai_cost_estimation_service.py (21.7 KB) - AI成本估算
ai_predictor.py               (17.6 KB) - AI预测器
ai_analysis.py                ( 4.2 KB) - AI分析
ai_prompt.py                  ( 4.7 KB) - AI提示词
...
```
**特点**: 有完整的模型、Schema定义
**示例代码**:
```python
class AICostEstimationService:
    """AI成本估算服务"""
    # 完整的AI成本估算实现
```
**可能性**: 功能已开发，等待接入或测试

---

#### 3. 审批引擎内部模块 (约20个)
```
actions.py                    ( 9.2 KB) - 审批动作
approve.py                    (11.9 KB) - 审批逻辑
approval_notifications.py     ( 9.3 KB) - 审批通知
approval_reminders.py         ( 3.9 KB) - 审批提醒
basic_notifications.py        ( 3.7 KB) - 基础通知
...
```
**特点**: 审批引擎的子模块，可能被父模块内部调用
**风险**: ⚠️ 不能轻易删除，可能被引擎内部使用

---

#### 4. 报表与分析 (约25个)
```
analysis_reports.py           ( 7.2 KB)
analytics_service.py          ( 3.6 KB)
analysis.py                   ( 3.5 KB)
...
```
**特点**: 数据分析和报表生成功能
**可能性**: 数据看板功能，可能未启用

---

#### 5. 资源管理 (约15个)
```
allocation.py                 ( 2.0 KB) - 资源分配
assembly_kit.py               ( 8.8 KB) - 装配套件
...
```

#### 6. 时间跟踪与工时 (约10个)
```
anomaly_detector.py           (18.6 KB) - 异常检测
anomaly_reminders.py          ( 3.0 KB) - 异常提醒
approval_reminders.py         ( 3.9 KB) - 审批提醒
...
```

#### 7. 基础工具类 (约20个)
```
base.py                       ( 2.4 KB)
base_builder.py               ( 5.3 KB)
auto_fix.py                   ( 4.5 KB)
...
```
**特点**: 可能是辅助类，被子类继承
**风险**: ⚠️ 删除前需确认继承关系

---

## ⚠️ 风险评估

### 高风险（不建议删除）

**1. 基础类和抽象类**
- `base.py`, `base_builder.py` 等
- 可能被其他类继承，静态分析难以发现

**2. 审批引擎子模块**
- `actions.py`, `approve.py` 等
- 可能被引擎内部动态调用

**3. 插件式模块**
- 可能通过配置文件动态加载

### 中风险（需确认后删除）

**1. AI功能模块**
- 有完整实现，可能是未启用的功能
- 建议: 确认是否计划启用

**2. 告警系统**
- 完整的规则引擎，但未接入
- 建议: 确认告警功能是否在产品规划中

### 低风险（可以考虑删除）

**1. 重复功能**
- 如果已有替代实现

**2. 实验性代码**
- 概念验证代码，未投入生产

**3. 过时功能**
- 已被新版本替代

---

## 🎯 建议行动

### 方案1: 保守清理（推荐）
**只删除明确废弃的模块**

1. ✅ 检查 Git 提交记录，找出长期未修改的文件
2. ✅ 搜索注释中包含"废弃"、"deprecated"的代码
3. ✅ 删除示例代码和测试桩

**预计清理**: 50-100个文件 (~500KB)

---

### 方案2: 激进清理（慎用）
**删除所有未引用的服务**

1. ⚠️ 备份当前代码
2. ⚠️ 删除285个未引用文件
3. ⚠️ 运行全量测试
4. ⚠️ 如果出问题，从备份恢复

**风险**: 可能破坏动态调用的功能

---

### 方案3: 标记管理（最安全）
**先标记，观察一段时间后再删除**

1. ✅ 在文件顶部添加 `# DEPRECATED: 未使用，计划删除`
2. ✅ 在代码审查时讨论是否真的需要删除
3. ✅ 1个月后如无人反对再删除

---

## 📋 立即可清理的模块

基于分析，以下模块**可能**可以安全删除：

### 1. 示例代码
```python
# 检查是否有 "example" 或 "demo" 字样
```

### 2. 测试桩
```python
# 检查是否有 "stub" 或 "mock" 字样
```

### 3. 注释说明已废弃的
```python
# 检查注释中是否有 "deprecated", "废弃", "不再使用"
```

---

## 🔬 详细分析命令

### 检查某个服务是否被动态调用
```bash
cd /Users/fulingwei/.openclaw/workspace/non-standard-automation-pms
grep -r "acceptance_service" app/ --include="*.py"
```

### 检查文件最后修改时间
```bash
git log --follow --format="%ai %s" -- app/services/sales/ai_cost_estimation_service.py | head -1
```

### 查找废弃注释
```bash
grep -r "deprecated\|废弃\|不再使用" app/services/ --include="*.py" | wc -l
```

---

## 💡 下一步行动

1. **今天**: 标记明确废弃的模块（如融资管理，已删除）
2. **本周**: 与团队讨论未启用功能的规划
3. **下周**: 执行保守清理（删除50-100个确认废弃的文件）
4. **下月**: 重新评估，考虑更大规模清理

---

## 📞 需要确认的问题

请符哥回答以下问题，帮助决策：

1. **告警系统** 是否在产品规划中？
   - 如果是 → 保留
   - 如果否 → 可删除（节省50KB+）

2. **AI成本估算** 是否计划启用？
   - 如果是 → 保留并接入API
   - 如果否 → 可删除（节省50KB+）

3. **审批引擎未使用模块** 是否实际在用？
   - 需要审查 `approval_engine` 目录结构

4. **基础类** 是否有继承使用？
   - 需要检查 `base.py`, `base_builder.py` 等

---

**报告生成**: 2026-02-25 20:06  
**分析工具**: Python静态代码分析  
**置信度**: 80% (需人工确认动态调用)

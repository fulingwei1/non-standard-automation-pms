# é‡‡è´­ä¸ç‰©æ–™ç®¡ç†æ¨¡å— - è¯¦ç»†è®¾è®¡æ–‡æ¡£

> é€‚ç”¨èŒƒå›´ï¼šéæ ‡è‡ªåŠ¨åŒ–æµ‹è¯•è®¾å¤‡/çº¿ä½“é¡¹ç›®çš„ç‰©æ–™é‡‡è´­ç®¡ç†
> ç›®æ ‡ï¼šå®ç°BOMç®¡ç†ã€é‡‡è´­å…¨æµç¨‹ã€åˆ°è´§è·Ÿè¸ªã€é½å¥—ç‡è®¡ç®—ã€ç¼ºæ–™é¢„è­¦ã€‚

---

## ä¸€ã€æ¨¡å—å®šä½ä¸è¾¹ç•Œ

### 1.1 æ¨¡å—èŒƒå›´

**åŒ…å«åŠŸèƒ½**ï¼š
- ç‰©æ–™ä¸»æ•°æ®ç®¡ç†
- ä¾›åº”å•†ç®¡ç†
- BOMç¼–åˆ¶ä¸ç‰ˆæœ¬ç®¡ç†
- é‡‡è´­ç”³è¯·ä¸å®¡æ‰¹
- é‡‡è´­è®¢å•ç®¡ç†
- åˆ°è´§ä¸å…¥åº“ç®¡ç†
- é½å¥—ç‡è®¡ç®—
- ç¼ºæ–™é¢„è­¦

**ä¸åŒ…å«**ï¼ˆç”±å…¶ä»–æ¨¡å—è´Ÿè´£ï¼‰ï¼š
- å¤–ååŠ å·¥ç®¡ç† â†’ å¤–åç®¡ç†æ¨¡å—
- ä»“åº“åº“å­˜ç®¡ç† â†’ ERP/WMSç³»ç»Ÿ
- è´¢åŠ¡ä»˜æ¬¾ â†’ è´¢åŠ¡ç³»ç»Ÿ
- ä¾›åº”å•†è¯„ä»·è¯¦ç»†æµç¨‹ â†’ ç‹¬ç«‹æ¨¡å—ï¼ˆå¯åæœŸæ‰©å±•ï¼‰

### 1.2 ä¸šåŠ¡æµç¨‹æ¦‚è§ˆ

```
BOMå‘å¸ƒ â†’ é‡‡è´­ç”³è¯· â†’ é‡‡è´­å®¡æ‰¹ â†’ é‡‡è´­ä¸‹å• â†’ åˆ°è´§ç¡®è®¤ â†’ å…¥åº“ â†’ é½å¥—æ£€æŸ¥
                                    â”‚
                                    â–¼
                              ç¼ºæ–™é¢„è­¦ â”€â”€â–º é¡¹ç›®å¥åº·åº¦æ›´æ–°
```

### 1.3 ä¸ç°æœ‰ç³»ç»Ÿå…³ç³»

```
é¡¹ç›®ç®¡ç† â”€â”€æœºå°BOMâ”€â”€â–º é‡‡è´­ç‰©æ–™ â”€â”€ç¼ºæ–™é¢„è­¦â”€â”€â–º é¢„è­¦å¼‚å¸¸
    â”‚                    â”‚
    â”‚                    â”œâ”€â”€ é½å¥—ç‡ â”€â”€â–º é˜¶æ®µé—¨æ ¡éªŒ
    â”‚                    â”‚
    â–¼                    â–¼
å˜æ›´ç®¡ç† â”€â”€BOMå˜æ›´â”€â”€â–º é‡‡è´­è°ƒæ•´
```

---

## äºŒã€æ ¸å¿ƒä¸šåŠ¡å¯¹è±¡

### 2.1 å¯¹è±¡å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰©æ–™ä¸»æ•°æ®  â”‚     â”‚   ä¾›åº”å•†    â”‚     â”‚   é¡¹ç›®      â”‚
â”‚  materials  â”‚     â”‚  suppliers  â”‚     â”‚  projects   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
       â”‚         â–¼                   â–¼         â”‚
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
       â””â”€â”€â–ºâ”‚    BOM      â”‚     â”‚   æœºå°      â”‚â—„â”˜
           â”‚  bom_items  â”‚     â”‚  machines   â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   é‡‡è´­å•    â”‚
                    â”‚  purchases  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼            â–¼            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ é‡‡è´­æ˜ç»† â”‚ â”‚ åˆ°è´§è®°å½• â”‚ â”‚ ç¼ºæ–™é¢„è­¦ â”‚
        â”‚  items   â”‚ â”‚ receipts â”‚ â”‚  alerts  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç‰©æ–™åˆ†ç±»ä½“ç³»

```
ç‰©æ–™åˆ†ç±»ï¼ˆä¸‰çº§ï¼‰
â”œâ”€â”€ ME æœºæ¢°ä»¶
â”‚   â”œâ”€â”€ ME-01 æœºåŠ å·¥ä»¶
â”‚   â”œâ”€â”€ ME-02 é’£é‡‘ä»¶
â”‚   â”œâ”€â”€ ME-03 æ ‡å‡†ä»¶ï¼ˆèºä¸èºæ¯ç­‰ï¼‰
â”‚   â””â”€â”€ ME-04 å‹æ
â”œâ”€â”€ EL ç”µæ°”ä»¶
â”‚   â”œâ”€â”€ EL-01 PLC/æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ EL-02 ä¼ºæœ/ç”µæœº
â”‚   â”œâ”€â”€ EL-03 ä¼ æ„Ÿå™¨
â”‚   â”œâ”€â”€ EL-04 æ°”åŠ¨å…ƒä»¶
â”‚   â””â”€â”€ EL-05 çº¿ç¼†/æ¥æ’ä»¶
â”œâ”€â”€ PN æ°”åŠ¨ä»¶
â”‚   â”œâ”€â”€ PN-01 æ°”ç¼¸
â”‚   â”œâ”€â”€ PN-02 é˜€ç±»
â”‚   â””â”€â”€ PN-03 æ°”åŠ¨é™„ä»¶
â”œâ”€â”€ ST æ ‡å‡†ä»¶/é€šç”¨ä»¶
â”‚   â”œâ”€â”€ ST-01 è½´æ‰¿/å¯¼è½¨
â”‚   â”œâ”€â”€ ST-02 è”è½´å™¨
â”‚   â””â”€â”€ ST-03 å…¶ä»–æ ‡å‡†ä»¶
â””â”€â”€ OT å…¶ä»–
    â”œâ”€â”€ OT-01 å¤–è´­æ•´æœº
    â”œâ”€â”€ OT-02 è½¯ä»¶/æˆæƒ
    â””â”€â”€ OT-03 è€—æ
```

---

## ä¸‰ã€ç‰©æ–™ä¸»æ•°æ®ç®¡ç†

### 3.1 ç‰©æ–™ç¼–ç è§„åˆ™

```
ç‰©æ–™ç¼–ç  = å¤§ç±» + "-" + ä¸­ç±» + "-" + å°ç±» + "-" + æµæ°´å·
ç¤ºä¾‹ï¼šME-01-01-0001ï¼ˆæœºåŠ å·¥ä»¶-è½´ç±»-ä¼ åŠ¨è½´-0001ï¼‰
      EL-02-01-0015ï¼ˆç”µæ°”ä»¶-ä¼ºæœç”µæœº-æ¾ä¸‹A6-0015ï¼‰
```

### 3.2 ç‰©æ–™ä¸»æ•°æ®è¡¨

```sql
CREATE TABLE materials (
    id INTEGER PRIMARY KEY AUTOINCREMENT,

    -- ç¼–ç ä¸åç§°
    material_code VARCHAR(30) UNIQUE NOT NULL,     -- ME-01-01-0001
    material_name VARCHAR(100) NOT NULL,
    short_name VARCHAR(50),                        -- ç®€ç§°

    -- åˆ†ç±»
    category_l1 VARCHAR(20) NOT NULL,              -- å¤§ç±»ï¼šME/EL/PN/ST/OT
    category_l2 VARCHAR(20),                       -- ä¸­ç±»
    category_l3 VARCHAR(20),                       -- å°ç±»

    -- è§„æ ¼å‚æ•°
    specification TEXT,                            -- è§„æ ¼æè¿°
    model VARCHAR(100),                            -- å‹å·
    brand VARCHAR(50),                             -- å“ç‰Œ
    unit VARCHAR(10) DEFAULT 'ä¸ª',                 -- å•ä½

    -- é‡‡è´­å±æ€§
    is_standard BOOLEAN DEFAULT FALSE,             -- æ˜¯å¦æ ‡å‡†ä»¶
    is_critical BOOLEAN DEFAULT FALSE,             -- æ˜¯å¦å…³é”®ä»¶
    standard_lead_time INTEGER,                    -- æ ‡å‡†äº¤æœŸ(å¤©)
    min_order_qty DECIMAL(10,2),                   -- æœ€å°èµ·è®¢é‡
    reference_price DECIMAL(12,2),                 -- å‚è€ƒå•ä»·

    -- ä¾›åº”å•†
    default_supplier_id INTEGER,                   -- é»˜è®¤ä¾›åº”å•†
    alt_supplier_ids TEXT,                         -- å¤‡é€‰ä¾›åº”å•†(JSON)

    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'ACTIVE',           -- ACTIVE/INACTIVE/OBSOLETE
    obsolete_reason TEXT,

    -- å®¡è®¡
    created_by INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (default_supplier_id) REFERENCES suppliers(id)
);

-- ç´¢å¼•
CREATE INDEX idx_materials_code ON materials(material_code);
CREATE INDEX idx_materials_category ON materials(category_l1, category_l2);
CREATE INDEX idx_materials_status ON materials(status);
CREATE INDEX idx_materials_critical ON materials(is_critical);
```

### 3.3 ç‰©æ–™æ›¿ä»£å…³ç³»

```sql
-- ç‰©æ–™æ›¿ä»£å…³ç³»è¡¨
CREATE TABLE material_alternatives (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    material_id INTEGER NOT NULL,                  -- åŸç‰©æ–™
    alt_material_id INTEGER NOT NULL,              -- æ›¿ä»£ç‰©æ–™
    priority INTEGER DEFAULT 1,                    -- ä¼˜å…ˆçº§(1æœ€é«˜)
    alt_type VARCHAR(20) DEFAULT 'EQUIVALENT',     -- EQUIVALENT/UPGRADE/DOWNGRADE
    remark TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (material_id) REFERENCES materials(id),
    FOREIGN KEY (alt_material_id) REFERENCES materials(id)
);
```

---

## å››ã€ä¾›åº”å•†ç®¡ç†

### 4.1 ä¾›åº”å•†æ•°æ®è¡¨

```sql
CREATE TABLE suppliers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,

    -- åŸºæœ¬ä¿¡æ¯
    supplier_code VARCHAR(20) UNIQUE NOT NULL,     -- V00001
    supplier_name VARCHAR(100) NOT NULL,
    short_name VARCHAR(50),

    -- åˆ†ç±»
    supplier_type VARCHAR(20),                     -- ç”Ÿäº§å•†/è´¸æ˜“å•†/ä»£ç†å•†
    category VARCHAR(50),                          -- æœºåŠ å·¥/é’£é‡‘/ç”µæ°”/æ ‡å‡†ä»¶

    -- è”ç³»ä¿¡æ¯
    contact_name VARCHAR(50),
    contact_phone VARCHAR(20),
    contact_email VARCHAR(100),
    address TEXT,

    -- å•†åŠ¡ä¿¡æ¯
    payment_terms VARCHAR(50),                     -- ä»˜æ¬¾æ¡æ¬¾
    tax_rate DECIMAL(5,2),                         -- ç¨ç‡
    bank_account TEXT,                             -- é“¶è¡Œè´¦æˆ·ä¿¡æ¯

    -- è¯„ä»·ï¼ˆç®€åŒ–ç‰ˆï¼‰
    delivery_rating DECIMAL(3,2) DEFAULT 3.0,      -- äº¤æœŸè¯„åˆ† 1-5
    quality_rating DECIMAL(3,2) DEFAULT 3.0,       -- è´¨é‡è¯„åˆ† 1-5
    service_rating DECIMAL(3,2) DEFAULT 3.0,       -- æœåŠ¡è¯„åˆ† 1-5
    overall_rating DECIMAL(3,2) DEFAULT 3.0,       -- ç»¼åˆè¯„åˆ†

    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'ACTIVE',           -- ACTIVE/INACTIVE/BLACKLIST
    cooperation_start DATE,
    blacklist_reason TEXT,

    -- å®¡è®¡
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_suppliers_code ON suppliers(supplier_code);
CREATE INDEX idx_suppliers_category ON suppliers(category);
CREATE INDEX idx_suppliers_status ON suppliers(status);
CREATE INDEX idx_suppliers_rating ON suppliers(overall_rating);
```

### 4.2 ä¾›åº”å•†ç‰©æ–™å…³è”

```sql
-- ä¾›åº”å•†å¯ä¾›ç‰©æ–™
CREATE TABLE supplier_materials (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    supplier_id INTEGER NOT NULL,
    material_id INTEGER NOT NULL,
    supplier_part_no VARCHAR(50),                  -- ä¾›åº”å•†æ–™å·
    unit_price DECIMAL(12,2),                      -- å•ä»·
    currency VARCHAR(10) DEFAULT 'CNY',
    lead_time INTEGER,                             -- äº¤æœŸ(å¤©)
    min_order_qty DECIMAL(10,2),                   -- æœ€å°èµ·è®¢é‡
    is_preferred BOOLEAN DEFAULT FALSE,            -- æ˜¯å¦é¦–é€‰
    last_purchase_date DATE,
    last_purchase_price DECIMAL(12,2),
    remark TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    FOREIGN KEY (material_id) REFERENCES materials(id),
    UNIQUE(supplier_id, material_id)
);
```

---

## äº”ã€BOMç®¡ç†

### 5.1 BOMç‰ˆæœ¬ç®¡ç†

```sql
-- BOMç‰ˆæœ¬è¡¨
CREATE TABLE bom_versions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    machine_id INTEGER NOT NULL,
    version_no VARCHAR(10) NOT NULL,               -- V1/V2/V3
    version_name VARCHAR(100),
    status VARCHAR(20) DEFAULT 'DRAFT',            -- DRAFT/RELEASED/OBSOLETE
    released_by INTEGER,
    released_at DATETIME,
    obsolete_reason TEXT,
    ecn_id INTEGER,                                -- å…³è”çš„å˜æ›´å•
    item_count INTEGER DEFAULT 0,                  -- ç‰©æ–™è¡Œæ•°
    total_cost DECIMAL(12,2),                      -- æ€»æˆæœ¬(é¢„ä¼°)
    remark TEXT,
    created_by INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (machine_id) REFERENCES machines(id),
    FOREIGN KEY (ecn_id) REFERENCES ecn(id),
    UNIQUE(machine_id, version_no)
);

CREATE INDEX idx_bom_versions_machine ON bom_versions(machine_id);
CREATE INDEX idx_bom_versions_status ON bom_versions(status);
```

### 5.2 BOMæ˜ç»†è¡¨

```sql
-- BOMæ˜ç»†è¡¨
CREATE TABLE bom_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    bom_version_id INTEGER NOT NULL,

    -- ç‰©æ–™ä¿¡æ¯
    material_id INTEGER,                           -- å…³è”ç‰©æ–™ä¸»æ•°æ®(å¯ç©º)
    material_code VARCHAR(30),
    material_name VARCHAR(100) NOT NULL,
    specification TEXT,
    brand VARCHAR(50),

    -- æ•°é‡ä¸å•ä½
    quantity DECIMAL(10,2) NOT NULL,
    unit VARCHAR(10) DEFAULT 'ä¸ª',
    unit_price DECIMAL(12,2),                      -- å•ä»·(é¢„ä¼°)
    total_price DECIMAL(12,2),                     -- æ€»ä»·(é¢„ä¼°)

    -- åˆ†ç±»ä¸æ ‡è¯†
    category VARCHAR(20),                          -- ç‰©æ–™ç±»åˆ«
    is_critical BOOLEAN DEFAULT FALSE,             -- æ˜¯å¦å…³é”®ä»¶
    is_long_lead BOOLEAN DEFAULT FALSE,            -- æ˜¯å¦é•¿äº¤æœŸ
    lead_time INTEGER,                             -- é¢„è®¡äº¤æœŸ(å¤©)

    -- æ¥æº
    source_type VARCHAR(20) DEFAULT 'PURCHASE',    -- PURCHASE/OUTSOURCE/STOCK
    supplier_id INTEGER,                           -- æŒ‡å®šä¾›åº”å•†

    -- å¤‡æ³¨
    remark TEXT,
    design_remark TEXT,                            -- è®¾è®¡å¤‡æ³¨

    -- å®¡è®¡
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (bom_version_id) REFERENCES bom_versions(id) ON DELETE CASCADE,
    FOREIGN KEY (material_id) REFERENCES materials(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

CREATE INDEX idx_bom_items_version ON bom_items(bom_version_id);
CREATE INDEX idx_bom_items_material ON bom_items(material_id);
CREATE INDEX idx_bom_items_critical ON bom_items(is_critical);
```

### 5.3 BOMçŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    å‘å¸ƒ     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    åºŸå¼ƒ     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DRAFT  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ RELEASED â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ OBSOLETE â”‚
â”‚  è‰ç¨¿  â”‚             â”‚  å·²å‘å¸ƒ  â”‚             â”‚  å·²åºŸå¼ƒ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚
     â”‚                      â”‚ ECNå˜æ›´
     â”‚                      â–¼
     â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ æ–°ç‰ˆæœ¬   â”‚
                     â”‚  DRAFT   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€é‡‡è´­æµç¨‹

### 6.1 é‡‡è´­æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           é‡‡è´­å…¨æµç¨‹                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  BOMå‘å¸ƒ        é‡‡è´­ç”³è¯·        å®¡æ‰¹         ä¸‹å•         åˆ°è´§         å…¥åº“  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚BOM  â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ç”³è¯· â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚å®¡æ‰¹ â”‚â”€â”€â”€â”€â”€â–ºâ”‚ä¸‹å• â”‚â”€â”€â”€â”€â”€â–ºâ”‚åˆ°è´§ â”‚â”€â”€â”€â”€â”€â–ºâ”‚å…¥åº“ â”‚â”‚
â”‚  â”‚å‘å¸ƒ â”‚       â”‚ç”Ÿæˆ â”‚       â”‚æµç¨‹ â”‚      â”‚æ‰§è¡Œ â”‚      â”‚ç¡®è®¤ â”‚      â”‚å®Œæˆ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜â”‚
â”‚     â”‚             â”‚             â”‚            â”‚            â”‚            â”‚    â”‚
â”‚     â”‚             â–¼             â”‚            â–¼            â–¼            â”‚    â”‚
â”‚     â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚     â”‚        â”‚è‡ªåŠ¨æ±‡æ€» â”‚       â”‚       â”‚ä¾›åº”å•†   â”‚  â”‚åˆ°è´§æ£€éªŒ â”‚       â”‚    â”‚
â”‚     â”‚        â”‚é‡‡è´­éœ€æ±‚ â”‚       â”‚       â”‚å‘è´§è·Ÿè¸ª â”‚  â”‚è´¨é‡è®°å½• â”‚       â”‚    â”‚
â”‚     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚     â”‚                          â”‚                                       â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                              â”‚  é½å¥—ç‡è®¡ç®—  â”‚                                â”‚
â”‚                              â”‚  ç¼ºæ–™é¢„è­¦    â”‚                                â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 é‡‡è´­çŠ¶æ€å®šä¹‰

```python
PURCHASE_STATUS = {
    # ç”³è¯·é˜¶æ®µ
    "DRAFT": "è‰ç¨¿",
    "PENDING_APPROVAL": "å¾…å®¡æ‰¹",
    "APPROVED": "å·²å®¡æ‰¹",
    "REJECTED": "å·²é©³å›",

    # æ‰§è¡Œé˜¶æ®µ
    "TO_ORDER": "å¾…ä¸‹å•",
    "ORDERED": "å·²ä¸‹å•",
    "PARTIAL_RECEIVED": "éƒ¨åˆ†åˆ°è´§",
    "RECEIVED": "å·²åˆ°è´§",
    "CLOSED": "å·²å…³é—­",

    # å¼‚å¸¸
    "CANCELLED": "å·²å–æ¶ˆ",
}
```

### 6.3 é‡‡è´­å•æ•°æ®æ¨¡å‹

```sql
-- é‡‡è´­å•ä¸»è¡¨
CREATE TABLE purchase_orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,

    -- ç¼–ç 
    po_code VARCHAR(20) UNIQUE NOT NULL,           -- PO-250712-001
    po_type VARCHAR(20) DEFAULT 'NORMAL',          -- NORMAL/URGENT/SAMPLE

    -- å…³è”
    project_id INTEGER NOT NULL,
    machine_id INTEGER,
    bom_version_id INTEGER,
    supplier_id INTEGER,

    -- é‡‘é¢
    total_amount DECIMAL(12,2),
    currency VARCHAR(10) DEFAULT 'CNY',
    tax_rate DECIMAL(5,2),
    tax_amount DECIMAL(12,2),

    -- æ—¶é—´
    order_date DATE,                               -- ä¸‹å•æ—¥æœŸ
    require_date DATE,                             -- è¦æ±‚äº¤æœŸ
    expect_date DATE,                              -- é¢„è®¡åˆ°è´§
    actual_date DATE,                              -- å®é™…åˆ°è´§

    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'DRAFT',
    approval_status VARCHAR(20),
    approved_by INTEGER,
    approved_at DATETIME,

    -- æ”¶è´§
    received_amount DECIMAL(12,2) DEFAULT 0,
    received_rate INTEGER DEFAULT 0,               -- åˆ°è´§ç‡%

    -- å¤‡æ³¨
    remark TEXT,
    buyer_id INTEGER,                              -- é‡‡è´­å‘˜

    -- å®¡è®¡
    created_by INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (project_id) REFERENCES projects(id),
    FOREIGN KEY (machine_id) REFERENCES machines(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    FOREIGN KEY (buyer_id) REFERENCES employees(id)
);

-- é‡‡è´­å•æ˜ç»†
CREATE TABLE purchase_order_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    po_id INTEGER NOT NULL,

    -- ç‰©æ–™
    bom_item_id INTEGER,                           -- å…³è”BOMè¡Œ
    material_id INTEGER,
    material_code VARCHAR(30),
    material_name VARCHAR(100) NOT NULL,
    specification TEXT,

    -- æ•°é‡ä¸ä»·æ ¼
    quantity DECIMAL(10,2) NOT NULL,               -- é‡‡è´­æ•°é‡
    unit VARCHAR(10),
    unit_price DECIMAL(12,2),
    total_price DECIMAL(12,2),

    -- äº¤æœŸ
    require_date DATE,
    expect_date DATE,
    actual_date DATE,

    -- æ”¶è´§
    received_qty DECIMAL(10,2) DEFAULT 0,
    pending_qty DECIMAL(10,2),                     -- å¾…æ”¶æ•°é‡

    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'PENDING',          -- PENDING/PARTIAL/RECEIVED/CANCELLED
    is_critical BOOLEAN DEFAULT FALSE,

    -- å¤‡æ³¨
    remark TEXT,

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (po_id) REFERENCES purchase_orders(id) ON DELETE CASCADE,
    FOREIGN KEY (bom_item_id) REFERENCES bom_items(id),
    FOREIGN KEY (material_id) REFERENCES materials(id)
);

-- ç´¢å¼•
CREATE INDEX idx_po_code ON purchase_orders(po_code);
CREATE INDEX idx_po_project ON purchase_orders(project_id);
CREATE INDEX idx_po_supplier ON purchase_orders(supplier_id);
CREATE INDEX idx_po_status ON purchase_orders(status);
CREATE INDEX idx_po_items_po ON purchase_order_items(po_id);
CREATE INDEX idx_po_items_material ON purchase_order_items(material_id);
```

### 6.4 åˆ°è´§è®°å½•

```sql
-- åˆ°è´§è®°å½•è¡¨
CREATE TABLE purchase_receipts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,

    -- ç¼–ç 
    receipt_code VARCHAR(20) UNIQUE NOT NULL,      -- RCV-250712-001

    -- å…³è”
    po_id INTEGER NOT NULL,
    po_item_id INTEGER NOT NULL,
    project_id INTEGER,
    machine_id INTEGER,

    -- åˆ°è´§ä¿¡æ¯
    received_qty DECIMAL(10,2) NOT NULL,
    received_date DATE NOT NULL,
    warehouse VARCHAR(50),                         -- å…¥åº“ä»“åº“
    location VARCHAR(50),                          -- åº“ä½

    -- è´¨é‡
    quality_status VARCHAR(20) DEFAULT 'PENDING',  -- PENDING/PASSED/FAILED
    inspection_date DATE,
    inspector_id INTEGER,
    reject_qty DECIMAL(10,2) DEFAULT 0,
    reject_reason TEXT,

    -- å•æ®
    delivery_note VARCHAR(50),                     -- é€è´§å•å·
    invoice_no VARCHAR(50),                        -- å‘ç¥¨å·

    -- å¤‡æ³¨
    remark TEXT,
    receiver_id INTEGER,                           -- æ”¶è´§äºº

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (po_id) REFERENCES purchase_orders(id),
    FOREIGN KEY (po_item_id) REFERENCES purchase_order_items(id),
    FOREIGN KEY (receiver_id) REFERENCES employees(id)
);

CREATE INDEX idx_receipts_po ON purchase_receipts(po_id);
CREATE INDEX idx_receipts_date ON purchase_receipts(received_date);
CREATE INDEX idx_receipts_quality ON purchase_receipts(quality_status);
```

---

## ä¸ƒã€é½å¥—ç‡è®¡ç®—

### 7.1 é½å¥—ç‡å®šä¹‰

```
é½å¥—ç‡ = å·²åˆ°è´§ç‰©æ–™è¡Œæ•° / BOMæ€»ç‰©æ–™è¡Œæ•° Ã— 100%

æˆ–æŒ‰é‡‘é¢åŠ æƒï¼š
åŠ æƒé½å¥—ç‡ = Î£(å·²åˆ°è´§è¡Œé‡‘é¢) / Î£(BOMè¡Œé‡‘é¢) Ã— 100%
```

### 7.2 é½å¥—ç‡è®¡ç®—é€»è¾‘

```python
def calculate_material_ready_rate(machine_id, method='count'):
    """
    è®¡ç®—æœºå°ç‰©æ–™é½å¥—ç‡

    Args:
        machine_id: æœºå°ID
        method: è®¡ç®—æ–¹æ³• 'count'æŒ‰è¡Œæ•° / 'amount'æŒ‰é‡‘é¢

    Returns:
        ready_rate: é½å¥—ç‡(0-100)
        details: è¯¦ç»†ä¿¡æ¯
    """
    # è·å–å·²å‘å¸ƒBOM
    bom = get_released_bom(machine_id)
    if not bom:
        return 0, {"error": "BOMæœªå‘å¸ƒ"}

    bom_items = get_bom_items(bom.id)
    if not bom_items:
        return 100, {"message": "BOMæ— ç‰©æ–™"}

    ready_items = []
    pending_items = []

    for item in bom_items:
        received = get_received_quantity(machine_id, item.material_code)
        required = item.quantity

        if received >= required:
            ready_items.append(item)
        else:
            pending_items.append({
                "item": item,
                "required": required,
                "received": received,
                "shortage": required - received
            })

    if method == 'count':
        ready_rate = len(ready_items) / len(bom_items) * 100
    else:  # amount
        total_amount = sum(i.total_price or 0 for i in bom_items)
        ready_amount = sum(i.total_price or 0 for i in ready_items)
        ready_rate = ready_amount / total_amount * 100 if total_amount > 0 else 0

    return round(ready_rate, 1), {
        "total_items": len(bom_items),
        "ready_items": len(ready_items),
        "pending_items": pending_items
    }
```

### 7.3 é½å¥—çŠ¶æ€è§†å›¾

```sql
-- æœºå°é½å¥—çŠ¶æ€è§†å›¾
CREATE VIEW v_machine_material_status AS
SELECT
    m.id AS machine_id,
    m.machine_code,
    m.project_id,
    bv.id AS bom_version_id,
    bv.version_no,
    COUNT(bi.id) AS total_items,
    SUM(CASE WHEN COALESCE(pr.received_qty, 0) >= bi.quantity THEN 1 ELSE 0 END) AS ready_items,
    ROUND(
        SUM(CASE WHEN COALESCE(pr.received_qty, 0) >= bi.quantity THEN 1 ELSE 0 END) * 100.0 / COUNT(bi.id),
        1
    ) AS ready_rate,
    SUM(CASE WHEN bi.is_critical = 1 AND COALESCE(pr.received_qty, 0) < bi.quantity THEN 1 ELSE 0 END) AS critical_shortage
FROM machines m
JOIN bom_versions bv ON bv.machine_id = m.id AND bv.status = 'RELEASED'
JOIN bom_items bi ON bi.bom_version_id = bv.id
LEFT JOIN (
    SELECT po_item_id, SUM(received_qty) AS received_qty
    FROM purchase_receipts
    WHERE quality_status = 'PASSED'
    GROUP BY po_item_id
) pr ON pr.po_item_id = bi.id
GROUP BY m.id, bv.id;
```

---

## å…«ã€ç¼ºæ–™é¢„è­¦

### 8.1 é¢„è­¦è§„åˆ™

| é¢„è­¦çº§åˆ« | æ¡ä»¶ | é¢œè‰² | å“åº” |
|:--------:|------|:----:|------|
| ğŸ”´ ä¸¥é‡ | å…³é”®ç‰©æ–™ç¼ºè´§ä¸”å½±å“è£…é… | çº¢è‰² | ç«‹å³å¤„ç†ï¼Œé€šçŸ¥PM/PMC |
| ğŸŸ  ç´§æ€¥ | ç‰©æ–™äº¤æœŸå»¶è¿Ÿ>3å¤© | æ©™è‰² | 24å°æ—¶å†…å¤„ç† |
| ğŸŸ¡ æ³¨æ„ | é½å¥—ç‡<80%ä¸”ä¸´è¿‘è£…é… | é»„è‰² | å…³æ³¨è·Ÿè¿› |
| ğŸ”µ æç¤º | ç‰©æ–™äº¤æœŸä¸´è¿‘ | è“è‰² | æ­£å¸¸è·Ÿè¸ª |

### 8.2 é¢„è­¦æ•°æ®æ¨¡å‹

```sql
-- ç¼ºæ–™é¢„è­¦è¡¨
CREATE TABLE shortage_alerts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,

    -- å…³è”
    project_id INTEGER NOT NULL,
    machine_id INTEGER,
    bom_item_id INTEGER,
    po_item_id INTEGER,

    -- ç‰©æ–™ä¿¡æ¯
    material_code VARCHAR(30),
    material_name VARCHAR(100),

    -- é¢„è­¦ä¿¡æ¯
    alert_level VARCHAR(20) NOT NULL,              -- CRITICAL/URGENT/WARNING/INFO
    alert_type VARCHAR(20),                        -- SHORTAGE/DELAY/LOW_STOCK
    shortage_qty DECIMAL(10,2),                    -- ç¼ºå£æ•°é‡
    delay_days INTEGER,                            -- å»¶æœŸå¤©æ•°

    -- å½±å“è¯„ä¼°
    affect_stage VARCHAR(10),                      -- å½±å“çš„é¡¹ç›®é˜¶æ®µ
    affect_date DATE,                              -- å½±å“æ—¥æœŸï¼ˆå¦‚è£…é…æ—¥æœŸï¼‰
    impact_description TEXT,

    -- å¤„ç†
    status VARCHAR(20) DEFAULT 'OPEN',             -- OPEN/HANDLING/RESOLVED/CLOSED
    handler_id INTEGER,
    handle_time DATETIME,
    handle_result TEXT,
    resolve_plan TEXT,

    -- é€šçŸ¥
    notified_users TEXT,                           -- å·²é€šçŸ¥äººå‘˜(JSON)
    last_notify_time DATETIME,

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (project_id) REFERENCES projects(id),
    FOREIGN KEY (machine_id) REFERENCES machines(id),
    FOREIGN KEY (handler_id) REFERENCES employees(id)
);

CREATE INDEX idx_shortage_project ON shortage_alerts(project_id);
CREATE INDEX idx_shortage_level ON shortage_alerts(alert_level);
CREATE INDEX idx_shortage_status ON shortage_alerts(status);
```

### 8.3 é¢„è­¦ç”Ÿæˆé€»è¾‘

```python
def generate_shortage_alerts():
    """
    å®šæ—¶ä»»åŠ¡ï¼šç”Ÿæˆç¼ºæ–™é¢„è­¦
    å»ºè®®æ‰§è¡Œé¢‘ç‡ï¼šæ¯å¤©æ—©ä¸Š8:00
    """
    alerts = []

    # è·å–æ‰€æœ‰è¿›è¡Œä¸­çš„é¡¹ç›®
    projects = get_active_projects()

    for project in projects:
        for machine in project.machines:
            # è·³è¿‡å·²å‡ºè´§æœºå°
            if machine.actual_ship_date:
                continue

            # è·å–é½å¥—çŠ¶æ€
            ready_rate, details = calculate_material_ready_rate(machine.id)

            # è§„åˆ™1ï¼šå…³é”®ç‰©æ–™ç¼ºè´§
            for item in details.get('pending_items', []):
                if item['item'].is_critical:
                    alerts.append({
                        'project_id': project.id,
                        'machine_id': machine.id,
                        'bom_item_id': item['item'].id,
                        'material_code': item['item'].material_code,
                        'material_name': item['item'].material_name,
                        'alert_level': 'CRITICAL',
                        'alert_type': 'SHORTAGE',
                        'shortage_qty': item['shortage'],
                        'affect_stage': 'S6',
                        'affect_date': machine.plan_assembly_date,
                        'impact_description': f"å…³é”®ç‰©æ–™ç¼ºè´§{item['shortage']}ï¼Œå½±å“è£…é…"
                    })

            # è§„åˆ™2ï¼šé½å¥—ç‡è¿‡ä½
            if ready_rate < 80 and is_approaching_assembly(machine, days=14):
                alerts.append({
                    'project_id': project.id,
                    'machine_id': machine.id,
                    'alert_level': 'WARNING',
                    'alert_type': 'LOW_STOCK',
                    'impact_description': f"é½å¥—ç‡{ready_rate}%ï¼Œè£…é…æ—¥æœŸä¸´è¿‘"
                })

            # è§„åˆ™3ï¼šäº¤æœŸå»¶è¿Ÿ
            delayed_items = get_delayed_po_items(machine.id)
            for item in delayed_items:
                alerts.append({
                    'project_id': project.id,
                    'machine_id': machine.id,
                    'po_item_id': item.id,
                    'material_code': item.material_code,
                    'material_name': item.material_name,
                    'alert_level': 'URGENT' if item.delay_days > 3 else 'INFO',
                    'alert_type': 'DELAY',
                    'delay_days': item.delay_days,
                    'impact_description': f"ç‰©æ–™å»¶æœŸ{item.delay_days}å¤©"
                })

    # ä¿å­˜é¢„è­¦å¹¶å‘é€é€šçŸ¥
    save_alerts_and_notify(alerts)
    return alerts
```

### 8.4 é¢„è­¦ä¸é¡¹ç›®è”åŠ¨

```python
def update_project_health_from_shortage(project_id):
    """
    æ ¹æ®ç¼ºæ–™é¢„è­¦æ›´æ–°é¡¹ç›®å¥åº·åº¦
    """
    # è·å–æœªè§£å†³çš„ä¸¥é‡é¢„è­¦
    critical_alerts = get_open_alerts(project_id, level='CRITICAL')

    if critical_alerts:
        # æœ‰ä¸¥é‡ç¼ºæ–™ â†’ å¥åº·åº¦H3é˜»å¡
        update_project_health(project_id, 'H3')
        update_project_status(project_id, 'ST14')  # ç¼ºæ–™é˜»å¡
        return

    # è·å–æœªè§£å†³çš„ç´§æ€¥é¢„è­¦
    urgent_alerts = get_open_alerts(project_id, level='URGENT')

    if urgent_alerts:
        # æœ‰ç´§æ€¥é¢„è­¦ â†’ å¥åº·åº¦H2æœ‰é£é™©
        update_project_health(project_id, 'H2')
        return
```

---

## ä¹ã€APIæ¥å£è®¾è®¡

### 9.1 ç‰©æ–™ç®¡ç†

```
GET    /materials                      # ç‰©æ–™åˆ—è¡¨
POST   /materials                      # åˆ›å»ºç‰©æ–™
GET    /materials/{id}                 # ç‰©æ–™è¯¦æƒ…
PATCH  /materials/{id}                 # æ›´æ–°ç‰©æ–™
GET    /materials/{id}/suppliers       # ç‰©æ–™ä¾›åº”å•†åˆ—è¡¨
GET    /materials/{id}/alternatives    # æ›¿ä»£ç‰©æ–™
```

### 9.2 ä¾›åº”å•†ç®¡ç†

```
GET    /suppliers                      # ä¾›åº”å•†åˆ—è¡¨
POST   /suppliers                      # åˆ›å»ºä¾›åº”å•†
GET    /suppliers/{id}                 # ä¾›åº”å•†è¯¦æƒ…
PATCH  /suppliers/{id}                 # æ›´æ–°ä¾›åº”å•†
GET    /suppliers/{id}/materials       # ä¾›åº”å•†ç‰©æ–™
GET    /suppliers/{id}/orders          # ä¾›åº”å•†è®¢å•å†å²
```

### 9.3 BOMç®¡ç†

```
GET    /machines/{id}/bom              # æœºå°BOMåˆ—è¡¨
POST   /machines/{id}/bom              # åˆ›å»ºBOMç‰ˆæœ¬
GET    /bom/{id}                       # BOMè¯¦æƒ…
PATCH  /bom/{id}                       # æ›´æ–°BOM
POST   /bom/{id}/release               # å‘å¸ƒBOM
POST   /bom/{id}/items                 # æ·»åŠ BOMè¡Œ
PATCH  /bom/{id}/items/{item_id}       # æ›´æ–°BOMè¡Œ
DELETE /bom/{id}/items/{item_id}       # åˆ é™¤BOMè¡Œ
POST   /bom/{id}/import                # å¯¼å…¥BOM(Excel)
GET    /bom/{id}/export                # å¯¼å‡ºBOM
```

### 9.4 é‡‡è´­ç®¡ç†

```
# é‡‡è´­å•
GET    /purchase-orders                # é‡‡è´­å•åˆ—è¡¨
POST   /purchase-orders                # åˆ›å»ºé‡‡è´­å•
GET    /purchase-orders/{id}           # é‡‡è´­å•è¯¦æƒ…
PATCH  /purchase-orders/{id}           # æ›´æ–°é‡‡è´­å•
POST   /purchase-orders/{id}/submit    # æäº¤å®¡æ‰¹
POST   /purchase-orders/{id}/approve   # å®¡æ‰¹
POST   /purchase-orders/{id}/order     # ç¡®è®¤ä¸‹å•
POST   /purchase-orders/{id}/cancel    # å–æ¶ˆ

# åˆ°è´§
POST   /purchase-orders/{id}/receive   # ç™»è®°åˆ°è´§
GET    /purchase-receipts              # åˆ°è´§è®°å½•åˆ—è¡¨
```

### 9.5 é½å¥—ä¸é¢„è­¦

```
GET    /machines/{id}/material-status  # æœºå°é½å¥—çŠ¶æ€
GET    /projects/{id}/material-status  # é¡¹ç›®é½å¥—æ±‡æ€»
GET    /shortage-alerts                # ç¼ºæ–™é¢„è­¦åˆ—è¡¨
PATCH  /shortage-alerts/{id}           # å¤„ç†é¢„è­¦
POST   /shortage-alerts/{id}/resolve   # è§£å†³é¢„è­¦
```

---

## åã€é¡µé¢è®¾è®¡

### 10.1 é¡µé¢æ¸…å•

| é¡µé¢ | åŠŸèƒ½ | è®¿é—®è§’è‰² |
|------|------|----------|
| ç‰©æ–™åˆ—è¡¨ | ç‰©æ–™ä¸»æ•°æ®ç®¡ç† | é‡‡è´­/PMC |
| ä¾›åº”å•†åˆ—è¡¨ | ä¾›åº”å•†ç®¡ç† | é‡‡è´­ |
| BOMç¼–è¾‘ | BOMç¼–åˆ¶ä¸ç»´æŠ¤ | å·¥ç¨‹å¸ˆ/PMC |
| é‡‡è´­å•åˆ—è¡¨ | é‡‡è´­å•ç®¡ç† | é‡‡è´­/PMC |
| é‡‡è´­å•è¯¦æƒ… | é‡‡è´­å•è¯¦ç»†ä¿¡æ¯ | é‡‡è´­/PMC |
| åˆ°è´§ç™»è®° | åˆ°è´§ç¡®è®¤ | é‡‡è´­/ä»“åº“ |
| é½å¥—çœ‹æ¿ | å„é¡¹ç›®é½å¥—çŠ¶æ€ | PMC/PM |
| ç¼ºæ–™é¢„è­¦ | é¢„è­¦å¤„ç† | PMC/é‡‡è´­ |

### 10.2 é½å¥—çœ‹æ¿é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é½å¥—çœ‹æ¿                                          [åˆ·æ–°] [å¯¼å‡º] [é¢„è­¦è®¾ç½®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€ é½å¥—ç‡åˆ†å¸ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€ é¢„è­¦æ±‡æ€» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  100%: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 8ä¸ª              â”‚  â”‚  ğŸ”´ ä¸¥é‡: 3    ğŸŸ  ç´§æ€¥: 5         â”‚â”‚
â”‚  â”‚  80-99%: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 6ä¸ª              â”‚  â”‚  ğŸŸ¡ æ³¨æ„: 8    ğŸ”µ æç¤º: 12        â”‚â”‚
â”‚  â”‚  60-79%: â–ˆâ–ˆâ–ˆâ–ˆ 4ä¸ª                â”‚  â”‚                                   â”‚â”‚
â”‚  â”‚  <60%: â–ˆâ–ˆ 2ä¸ª                    â”‚  â”‚  [æŸ¥çœ‹å…¨éƒ¨é¢„è­¦]                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”‚  é¡¹ç›®/æœºå°é½å¥—æ˜ç»†                               ç­›é€‰: [å…¨éƒ¨â–¼] [æœç´¢...]     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ é¡¹ç›®å·       æœºå°          é½å¥—ç‡    å…³é”®ç¼ºæ–™  è£…é…æ—¥æœŸ   çŠ¶æ€    æ“ä½œ   â”‚â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚â”‚
â”‚  â”‚ PJ250712001  PN001         ğŸ”´ 65%    2        08-15     ç¼ºæ–™    [è¯¦æƒ…] â”‚â”‚
â”‚  â”‚              PN002         ğŸŸ¡ 78%    1        09-01     è·Ÿè¸ª    [è¯¦æƒ…] â”‚â”‚
â”‚  â”‚ PJ250710002  PN001         ğŸŸ¢ 95%    0        08-20     æ­£å¸¸    [è¯¦æƒ…] â”‚â”‚
â”‚  â”‚ PJ250708003  PN001         ğŸŸ¢ 100%   0        å·²è£…é…    å®Œæˆ    [è¯¦æƒ…] â”‚â”‚
â”‚  â”‚              PN002         ğŸŸ¡ 82%    0        08-25     è·Ÿè¸ª    [è¯¦æƒ…] â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 ç¼ºæ–™é¢„è­¦é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼ºæ–™é¢„è­¦                                    [å…¨éƒ¨] [å¾…å¤„ç†] [å¤„ç†ä¸­] [å·²è§£å†³]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ”´ ä¸¥é‡ | PJ250712001-PN001 | ä¼ºæœç”µæœº MSMF042L1U2M                     â”‚â”‚
â”‚  â”‚ ç¼ºå£: 2å°  |  é¢„è®¡å»¶æœŸ: 7å¤©  |  å½±å“è£…é…: 2025-08-15                     â”‚â”‚
â”‚  â”‚ å½“å‰ä¾›åº”å•†: æ¾ä¸‹  |  é‡‡è´­å‘˜: ç‹é‡‡è´­                                      â”‚â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚â”‚
â”‚  â”‚ å¤„ç†æ–¹æ¡ˆ:                                                                â”‚â”‚
â”‚  â”‚ â—‹ å‚¬è´§åŠ æ€¥    â—‹ æ›´æ¢ä¾›åº”å•†    â—‹ ä½¿ç”¨æ›¿ä»£ç‰©æ–™    â—‹ è°ƒæ•´è®¡åˆ’              â”‚â”‚
â”‚  â”‚                                                               [å¤„ç†]    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸŸ  ç´§æ€¥ | PJ250712001-PN002 | PLC FX5U-32MT                             â”‚â”‚
â”‚  â”‚ ç¼ºå£: 1å°  |  é¢„è®¡å»¶æœŸ: 4å¤©  |  å½±å“è£…é…: 2025-09-01                     â”‚â”‚
â”‚  â”‚ å½“å‰ä¾›åº”å•†: ä¸‰è±ä»£ç†  |  é‡‡è´­å‘˜: æé‡‡è´­                                  â”‚â”‚
â”‚  â”‚                                                               [å¤„ç†]    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸŸ¡ æ³¨æ„ | PJ250710002-PN001 | æ°”ç¼¸ CDQ2B32-50DZ                         â”‚â”‚
â”‚  â”‚ é½å¥—ç‡: 78%  |  è£…é…ä¸´è¿‘: 14å¤©                                           â”‚â”‚
â”‚  â”‚                                                               [è·Ÿè¿›]    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åä¸€ã€æƒé™çŸ©é˜µ

| åŠŸèƒ½ | PMC | é‡‡è´­ | å·¥ç¨‹å¸ˆ | ä»“åº“ | PM | è´¢åŠ¡ | ç®¡ç†å‘˜ |
|------|:---:|:----:|:------:|:----:|:--:|:----:|:------:|
| ç‰©æ–™ä¸»æ•°æ® | R/W | R/W | R | R | R | R | R/W |
| ä¾›åº”å•†ç®¡ç† | R | R/W | R | R | R | R | R/W |
| BOMç¼–åˆ¶ | R/W | R | R/W | R | R | R | R/W |
| BOMå‘å¸ƒ | W | - | - | - | W | - | W |
| é‡‡è´­ç”³è¯· | W | W | - | - | R | R | W |
| é‡‡è´­å®¡æ‰¹ | A | - | - | - | A | A | A |
| é‡‡è´­ä¸‹å• | R | W | - | - | R | R | W |
| åˆ°è´§ç™»è®° | R | W | - | W | R | R | W |
| é½å¥—æŸ¥çœ‹ | R | R | R | R | R | R | R |
| é¢„è­¦å¤„ç† | W | W | - | - | R | - | W |

---

## åäºŒã€é…ç½®é¡¹

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| é‡‡è´­å•ç¼–ç å‰ç¼€ | PO | é‡‡è´­å•ç¼–ç æ ¼å¼ |
| åˆ°è´§å•ç¼–ç å‰ç¼€ | RCV | åˆ°è´§å•ç¼–ç æ ¼å¼ |
| é½å¥—ç‡é˜ˆå€¼ | 80% | ä½äºæ­¤å€¼è§¦å‘é¢„è­¦ |
| å…³é”®ç‰©æ–™é¢„è­¦å¤©æ•° | 7 | å…³é”®ç‰©æ–™ç¼ºè´§é¢„è­¦æå‰å¤©æ•° |
| äº¤æœŸé¢„è­¦å¤©æ•° | 3 | äº¤æœŸå»¶è¿Ÿé¢„è­¦é˜ˆå€¼ |
| è‡ªåŠ¨ç”Ÿæˆé‡‡è´­ç”³è¯· | å¼€å¯ | BOMå‘å¸ƒåæ˜¯å¦è‡ªåŠ¨ç”Ÿæˆé‡‡è´­ç”³è¯· |

---

## åä¸‰ã€ä¸å…¶ä»–æ¨¡å—è”åŠ¨

| è§¦å‘æ¨¡å— | äº‹ä»¶ | é‡‡è´­æ¨¡å—å“åº” |
|----------|------|--------------|
| é¡¹ç›®ç®¡ç† | æ–°å»ºæœºå° | - |
| è¿›åº¦è·Ÿè¸ª | BOMä»»åŠ¡å®Œæˆ | å¯è§¦å‘BOMå‘å¸ƒ |
| å˜æ›´ç®¡ç† | ECNå®¡æ‰¹é€šè¿‡ | ç”Ÿæˆæ–°BOMç‰ˆæœ¬ï¼Œè°ƒæ•´é‡‡è´­ |
| éªŒæ”¶ç®¡ç† | - | - |
| å¤–åç®¡ç† | å¤–åä»¶åˆ°è´§ | æ›´æ–°é½å¥—çŠ¶æ€ |

| é‡‡è´­æ¨¡å—äº‹ä»¶ | å“åº”æ¨¡å— |
|--------------|----------|
| å…³é”®ç‰©æ–™ç¼ºè´§ | é¡¹ç›®ç®¡ç†ï¼šå¥åº·åº¦â†’H3 |
| é½å¥—ç‡è¾¾æ ‡ | é¡¹ç›®ç®¡ç†ï¼šå¯æ¨è¿›è‡³S6 |
| ç‰©æ–™å»¶æœŸ | é¢„è­¦æ¨¡å—ï¼šç”Ÿæˆé¢„è­¦ |

---

*æœ¬æ–‡æ¡£ä¸é¡¹ç›®ç®¡ç†ã€å˜æ›´ç®¡ç†ã€å¤–åç®¡ç†æ¨¡å—é…å¥—ä½¿ç”¨ã€‚*

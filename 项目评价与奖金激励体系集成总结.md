# 项目评价与奖金激励体系集成总结

## 一、集成概述

项目评价体系已与奖金激励体系深度融合，项目评价结果直接影响各类奖金的计算，实现了**基于项目评价的智能奖金计算**。

---

## 二、集成点详解

### 2.1 项目奖金计算集成

**位置**: `app/services/bonus_calculator.py` - `calculate_project_bonus()`

**集成逻辑**:
```python
# 1. 计算基础奖金
base_amount = project_amount * bonus_ratio * contribution_ratio

# 2. 获取项目评价系数
eval_service = ProjectEvaluationService(self.db)
difficulty_coef = eval_service.get_difficulty_bonus_coefficient(project)  # 难度系数
new_tech_coef = eval_service.get_new_tech_bonus_coefficient(project)     # 新技术系数

# 3. 应用系数（取较高值）
bonus_coefficient = max(difficulty_coef, new_tech_coef)
calculated_amount = base_amount * bonus_coefficient
```

**影响**:
- 高难度项目：奖金系数 1.0-1.5倍
- 新技术项目：奖金系数 1.0-1.4倍
- 综合系数取较高值，确保高难度或新技术项目都能获得更高奖金

### 2.2 里程碑奖金计算集成

**位置**: `app/services/bonus_calculator.py` - `calculate_milestone_bonus()`

**集成逻辑**:
```python
# 获取项目评价系数
eval_service = ProjectEvaluationService(self.db)
project_coef = eval_service.get_bonus_coefficient(project)  # 基于评价等级的综合系数

# 应用系数
amount = base_amount * role_coefficient * project_coef
```

**影响**:
- S级项目：1.5倍
- A级项目：1.3倍
- B级项目：1.1倍
- C级项目：1.0倍
- D级项目：0.9倍

### 2.3 阶段奖金计算集成

**位置**: `app/services/bonus_calculator.py` - `calculate_stage_bonus()`

**集成逻辑**:
```python
# 应用项目评价系数
eval_service = ProjectEvaluationService(self.db)
project_coef = eval_service.get_bonus_coefficient(project)
final_amount = amount * project_coef
```

**影响**: 项目阶段推进奖金也会根据项目评价等级进行调整

---

## 三、奖金系数说明

### 3.1 难度系数（Difficulty Coefficient）

| 难度得分 | 等级 | 系数 | 说明 |
|---------|------|------|------|
| 1-3分 | 极高难度 | 1.5倍 | 技术挑战极大 |
| 4-6分 | 高难度 | 1.3倍 | 技术挑战大 |
| 7-8分 | 中等难度 | 1.1倍 | 技术挑战一般 |
| 9-10分 | 低难度 | 1.0倍 | 技术挑战小 |

**应用场景**: 项目奖金计算

### 3.2 新技术系数（New Tech Coefficient）

| 新技术得分 | 等级 | 系数 | 说明 |
|-----------|------|------|------|
| 1-3分 | 大量新技术 | 1.4倍 | 技术风险高 |
| 4-6分 | 部分新技术 | 1.2倍 | 有一定风险 |
| 7-10分 | 少量/无新技术 | 1.0倍 | 风险可控 |

**应用场景**: 项目奖金计算

### 3.3 综合系数（Overall Coefficient）

| 评价等级 | 得分范围 | 系数 | 说明 |
|---------|---------|------|------|
| S级 | 90-100分 | 1.5倍 | 战略项目/超高难度 |
| A级 | 80-89分 | 1.3倍 | 重点项目/高难度 |
| B级 | 70-79分 | 1.1倍 | 一般项目/中等难度 |
| C级 | 60-69分 | 1.0倍 | 普通项目/低难度 |
| D级 | <60分 | 0.9倍 | 简单项目 |

**应用场景**: 里程碑奖金、阶段奖金

---

## 四、计算示例

### 示例1：高难度项目奖金计算

**项目信息**:
- 合同金额：300万元
- 项目贡献占比：30%
- 奖金规则系数：5%
- 项目评价：
  - 难度得分：4分（高难度）
  - 新技术得分：3分（大量新技术）

**计算过程**:
```
1. 基础奖金 = 300万 × 5% × 30% = 4.5万元
2. 难度系数 = 1.3倍（高难度）
3. 新技术系数 = 1.4倍（大量新技术）
4. 综合系数 = max(1.3, 1.4) = 1.4倍
5. 最终奖金 = 4.5万 × 1.4 = 6.3万元
```

### 示例2：S级项目里程碑奖金

**项目信息**:
- 里程碑基础奖金：5000元
- 角色系数：1.2倍（项目经理）
- 项目评价等级：S级（综合得分95分）

**计算过程**:
```
1. 基础奖金 = 5000元 × 1.2 = 6000元
2. 项目系数 = 1.5倍（S级项目）
3. 最终奖金 = 6000元 × 1.5 = 9000元
```

---

## 五、数据流转

### 5.1 评价创建流程

```
1. 管理员/项目经理创建项目评价
   ↓
2. 系统计算综合得分和评价等级
   ↓
3. 评价状态：DRAFT → CONFIRMED
   ↓
4. 评价数据存储到 project_evaluations 表
```

### 5.2 奖金计算流程

```
1. 触发奖金计算（绩效定稿/里程碑完成/阶段推进）
   ↓
2. BonusCalculator 调用计算函数
   ↓
3. 查询项目最新评价（ProjectEvaluationService.get_latest_evaluation()）
   ↓
4. 获取奖金系数（难度系数/新技术系数/综合系数）
   ↓
5. 应用系数计算最终奖金
   ↓
6. 保存计算记录（包含系数信息）
```

---

## 六、API端点

### 6.1 项目评价相关

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/project-evaluation/evaluations` | 创建项目评价 |
| POST | `/project-evaluation/evaluations/auto` | 自动创建评价 |
| GET | `/project-evaluation/projects/{id}/evaluation` | 获取项目最新评价 |
| GET | `/project-evaluation/dimensions/weights/summary` | 获取权重配置摘要 |

### 6.2 奖金计算相关

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/bonus/calculate/project` | 计算项目奖金（自动应用评价系数） |
| POST | `/bonus/calculate/milestone` | 计算里程碑奖金（自动应用评价系数） |
| POST | `/bonus/calculate/stage` | 计算阶段奖金（自动应用评价系数） |

---

## 七、配置管理

### 7.1 评价维度配置

所有评价维度的配置都可以在后台管理：

- **权重配置**: 通过 `PUT /project-evaluation/dimensions/{id}` 修改 `default_weight`
- **评分规则**: 通过 `PUT /project-evaluation/dimensions/{id}` 修改 `scoring_rules`
- **启用/停用**: 通过 `POST /project-evaluation/dimensions/{id}/toggle`

### 7.2 奖金系数配置

奖金系数目前基于评价得分自动计算，未来可以扩展为可配置：

- 难度系数映射表
- 新技术系数映射表
- 评价等级系数映射表

---

## 八、优势总结

✅ **智能计算**: 项目评价自动影响奖金计算，无需手动调整

✅ **公平激励**: 高难度项目和新技术的项目获得更高奖金，体现价值

✅ **灵活配置**: 所有评价标准都可以在后台配置，无需修改代码

✅ **数据追溯**: 奖金计算记录中包含系数信息，可追溯计算依据

✅ **自动应用**: 评价确认后，后续奖金计算自动应用新系数

---

## 九、使用建议

1. **项目立项时**: 及时创建项目评价，确保后续奖金计算准确

2. **评价更新**: 如果项目难度或新技术使用情况发生变化，及时更新评价

3. **权重调整**: 根据公司战略调整评价维度权重，影响后续评价结果

4. **系数验证**: 定期检查奖金计算记录中的系数，确保计算正确

---

## 十、总结

项目评价体系与奖金激励体系已完全集成，实现了：

- ✅ 项目评价结果自动影响奖金计算
- ✅ 高难度和新技术的项目获得更高奖金
- ✅ 所有配置可在后台管理
- ✅ 完整的API支持
- ✅ 详细的计算记录和追溯

系统已准备好投入使用！






